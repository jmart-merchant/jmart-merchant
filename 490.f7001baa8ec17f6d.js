"use strict";(self.webpackChunkjysan=self.webpackChunkjysan||[]).push([[490],{12490:(io,W,l)=>{l.r(W),l.d(W,{DirectoryModule:()=>no});var m=l(69808),p=l(93075),G=l(23918),Q=l(46805),Rt=l(91995),Z=l(8491),t=l(5e3);let St=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[m.ez]]}),n})();var A=l(59516),b=l(70655),h=l(591),R=l(42654),x=l(36053),V=l(8929),K=l(61715),k=l(18583),z=l(31307),D=l(92198),f=l(24850),w=l(75778),C=l(2994),I=l(1059),M=l(7625),tt=l(72986);class et{constructor(r){this.removing$=new h.X(void 0),this.destroy$=new V.xQ,this.id=r.id,this.data=r}destroy(){this.destroy$.next(Date.now()),this.destroy$.complete(),this.removing$.complete(),this.cancelRemove$&&this.cancelRemove$.complete(),this.deleteWith=void 0}}var ot=l(21086),nt=l(68896),q=l(80013),it=l(87545),S=l(80457),P=l(11685),j=l(83485),y=l(40703),rt=l(61326),lt=l(26484),L=l(8295),jt=l(28706),u=l(89854),E=l(69544),Y=l(82699),st=l(86984),N=l(23601),at=l(67089),ct=l(32534),pt=l(85814),mt=l(61235),B=l(84685),U=l(43915),dt=l(36466),ut=l(89848),ht=l(11586),Ot=l(32902),T=l(88090);const kt=["formDirective"];function Dt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw().onDelete()}),t._UZ(1,"i",28),t.ALo(2,"svgPath"),t.qZA()}2&n&&(t.xp6(1),t.Q6J("inlineSVG",t.lcZ(2,1,"bucket")))}function wt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",35)(1,"button",36),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().index;return t.oxw().deleteAccount(i)}),t._UZ(2,"i",28),t.ALo(3,"svgPath"),t.qZA()()}2&n&&(t.xp6(2),t.Q6J("inlineSVG",t.lcZ(3,1,"bucket")))}function It(n,r){if(1&n&&(t.TgZ(0,"div",29)(1,"div",30)(2,"div",31)(3,"j-form-field"),t._UZ(4,"j-entity-logo",32),t.ALo(5,"bankFromAccount"),t.TgZ(6,"j-label"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t._UZ(9,"input",33)(10,"j-error",13),t.qZA()(),t.YNc(11,wt,4,3,"div",34),t.qZA()()),2&n){const e=r.index,o=t.oxw();t.xp6(4),t.Q6J("name",t.lcZ(5,9,"KZ"+o.fGroup.get("accounts").controls[e].value)),t.xp6(3),t.Oqu(t.lcZ(8,11,"COUNTERPARTY.IBAN")),t.xp6(2),t.Q6J("jShadow",o.masks.bankAccount.shadow)("dropSpecialCharacters",!0)("mask",o.masks.bankAccount.mask)("formControl",o.fGroup.get("accounts").controls[e]),t.xp6(1),t.Q6J("control",o.fGroup.get("accounts").controls[e])("errorMessages",o.errors.bankAccount),t.xp6(1),t.Q6J("ngIf",e)}}function Mt(n,r){if(1&n&&(t.TgZ(0,"div",37),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorText," ")}}function Pt(n,r){1&n&&t._UZ(0,"j-kbe-info")}var v=(()=>{return(n=v||(v={})).create="create",n.delete="delete",n.update="update",v;var n})();let Lt=(()=>{class n{constructor(e,o,i,a,s,c){this.modal=e,this.recipients=o,this.maskService=i,this.fb=a,this.bankFromAccount=s,this.paymentsService=c,this.checkingCounterParty$=new h.X(void 0),this.updateInProgress$=new h.X(void 0),this.masks={},this.errors=j.R0,this.subs=new R.w}ngOnInit(){if(this.getMaskConfig(),this.fGroup=this.createForm(this.item),!this.editMode){const{iinOrBin:e}=this.fGroup.controls;this.subs.add(e.valueChanges.pipe((0,q.b)(200),(0,it.w)(o=>e.valid?(this.checkingCounterParty$.next(o),(0,ot.of)(this.recipients.checkCounterParty(o)).pipe((0,M.R)(e.valueChanges))):(this.checkingCounterParty$.next(null),nt.E))).subscribe(o=>{o&&this.checkingCounterParty$.getValue()===o.bin&&(this.fGroup.patchValue({name:o.name}),this.checkingCounterParty$.next(null)),this.checkingCounterParty$.next(null)}))}}get editMode(){var e;return null===(e=this.item)||void 0===e?void 0:e.id}createForm(e){var o;return this.fb.group({iinOrBin:[{value:(null==e?void 0:e.iinOrBin)||"",disabled:this.editMode},[p.kI.required,p.kI.minLength(12)]],kbeCode:[null===(o=null==e?void 0:e.kbe)||void 0===o?void 0:o.code,[p.kI.required,j.hM.kbe]],name:[(null==e?void 0:e.name)||"",[p.kI.required,p.kI.maxLength(250)]],accounts:this.fb.array(((null==e?void 0:e.accounts)||[{iban:""}]).map(i=>this.getAccountControlConfig(i)))})}addAccount(){this.updateInProgress$.getValue()||this.fGroup.controls.accounts.push(this.fb.control("",this.getAccountControlConfig()[1]))}deleteAccount(e){this.updateInProgress$.getValue()||this.fGroup.controls.accounts.removeAt(e)}onCancel(){this.updateInProgress$.getValue()||this.modal.close()}onSubmit(){if(this.updateInProgress$.getValue())return;if(this.fGroup.invalid)return void this.emulateSubmit();const e=this.prepareBody();this.processRequest(e)}onDelete(){this.modal.close({payload:this.item,type:v.delete})}getAccountControlConfig(e={}){return[e.iban,[p.kI.required,o=>this.paymentsService.bankExist((0,Z.ibanPrefix)(o.value||"",S.w.KZT))]]}getMaskConfig(){Object.entries({iinOrBin:"iin",bankAccount:"tengeAccount",kbeCode:"kbe"}).forEach(([e,o])=>this.masks[e]=this.maskService.getConfig(o))}emulateSubmit(){this.form.submitted=!0,this.form.ngSubmit.emit(),this.fGroup.markAllAsTouched()}prepareBody(){let e={};const o=this.fGroup.controls.accounts.value;let i=(0,Z.getGroupRawValue)(this.fGroup);i.kbe={code:i.kbeCode,name:""},delete i.kbeCode,this.editMode&&(e=this.item.accounts.reduce((s,c)=>(s[c.iban]=c,s),{}),i=Object.assign(Object.assign({},this.item),i));const a=o.map(s=>{const c=(0,Z.ibanPrefix)(s,S.w.KZT);let d=e[c];return d||(d={bic:this.bankFromAccount.transform(c),iban:c}),d});return i.accounts=a,i}processRequest(e){return(0,b.mG)(this,void 0,void 0,function*(){try{let o,i;this.updateInProgress$.next(!0),this.editMode?(o=yield this.recipients.updateRecipient(e),i=v.update):(o=yield this.recipients.createRecipient(e),i=v.create),this.modal.close({payload:o,type:i})}catch(o){this.updateInProgress$.next(!1),this.errorText=o&&o.description||JSON.stringify(o)}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.Kz),t.Y36(rt.F),t.Y36(lt.O),t.Y36(Z.FormBuilderTypeSafe),t.Y36(L.vI),t.Y36(jt.cR))},n.\u0275cmp=t.Xpm({type:n,selectors:[["j-edit-counterparty"]],viewQuery:function(e,o){if(1&e&&t.Gf(kt,5),2&e){let i;t.iGM(i=t.CRH())&&(o.form=i.first)}},inputs:{item:"item"},features:[t._Bn([{provide:P.rD,useClass:P.hu}])],decls:55,vars:61,consts:[[1,"modal-header"],["translate",""],["type","button",1,"modal-back","mr-3","btn","btn-outline-primary","btn-sm","p-0",3,"click"],[3,"inlineSVG"],["class","edit-counterparty--delete btn btn-link btn-link-light-gray btn-as-text float-right mt-2",3,"click",4,"ngIf"],[1,"modal-body"],[1,"scrolled"],[1,"scrolled--content",3,"formGroup"],["formDirective","ngForm"],[1,"form-group"],["clearable","true"],["type","text","jFormInput","",1,"form-control",3,"dropSpecialCharacters","jShadow","mask","formControl"],["jSuffix","",1,"counterParty","p3",3,"jLoading","jLoadingInverted"],[3,"control","errorMessages"],[1,"row"],[1,"form-group","col-8","pr-2"],["type","text","jFormInput","",1,"form-control",3,"formControl"],[1,"form-group","col-4","pl-2"],["type","text","jFormInput","",1,"form-control",3,"mask","jShadow","dropSpecialCharacters","formControl"],["type","button","jSuffix","","tooltipClass","tooltip-light tooltip-large","container","body",1,"btn-link-gray","btn","btn-link","btn-as-text",3,"ngbTooltip","inlineSVG"],["formArrayName","accounts",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-link","text-info","p-0","ml-auto",3,"disabled","click"],["class","alert alert-danger","translate","",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"disabled","click"],["type","submit",1,"btn","btn-primary",3,"disabled","jLoading","click"],["kbeInfo",""],[1,"edit-counterparty--delete","btn","btn-link","btn-link-light-gray","btn-as-text","float-right","mt-2",3,"click"],[1,"d-inline",3,"inlineSVG"],["formArrayName","accounts"],[1,"row","form-group"],[1,"col"],["jPrefix","","hideEmpty","true",3,"name"],["type","text","jFormInput","","jReplaceOnPaste","KZ","jDynamicPrefix","KZ","jUppercase","",1,"form-control",3,"jShadow","dropSpecialCharacters","mask","formControl"],["class","col d-flex flex-grow-0 text-center",4,"ngIf"],[1,"col","d-flex","flex-grow-0","text-center"],[1,"btn","btn-link","btn-link-light-gray","btn-as-text","float-right",3,"click"],["translate","",1,"alert","alert-danger"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0)(1,"h4",1)(2,"button",2),t.NdJ("click",function(){return o.onCancel()}),t._UZ(3,"i",3),t.ALo(4,"svgPath"),t.qZA(),t._uU(5),t.qZA(),t.YNc(6,Dt,3,3,"button",4),t.qZA(),t.TgZ(7,"div",5)(8,"div",6)(9,"form",7,8)(11,"div",9)(12,"j-form-field",10)(13,"j-label"),t._uU(14),t.ALo(15,"translate"),t.qZA(),t._UZ(16,"input",11)(17,"div",12),t.ALo(18,"async"),t._UZ(19,"j-error",13),t.qZA()(),t.TgZ(20,"div",14)(21,"div",15)(22,"j-form-field",10)(23,"j-label"),t._uU(24),t.ALo(25,"translate"),t.qZA(),t._UZ(26,"input",16)(27,"div",12),t.ALo(28,"async"),t.qZA()(),t.TgZ(29,"div",17)(30,"j-form-field",10)(31,"j-label"),t._uU(32),t.ALo(33,"translate"),t.qZA(),t._UZ(34,"input",18)(35,"button",19)(36,"j-error",13),t.qZA()()(),t.YNc(37,It,12,13,"div",20),t.qZA()(),t.TgZ(38,"button",21),t.NdJ("click",function(){return o.addAccount()}),t.ALo(39,"async"),t._uU(40),t.ALo(41,"translate"),t.qZA(),t.YNc(42,Mt,2,1,"div",22),t.qZA(),t.TgZ(43,"div",23)(44,"button",24),t.NdJ("click",function(){return o.onCancel()}),t.ALo(45,"async"),t._uU(46),t.ALo(47,"translate"),t.qZA(),t.TgZ(48,"button",25),t.NdJ("click",function(){return o.onSubmit()}),t.ALo(49,"async"),t.ALo(50,"async"),t._uU(51),t.ALo(52,"translate"),t.qZA()(),t.YNc(53,Pt,1,0,"ng-template",null,26,t.W1O)),2&e){const i=t.MAs(54);t.xp6(3),t.Q6J("inlineSVG",t.lcZ(4,35,"chevron-left")),t.xp6(2),t.Oqu("COUNTERPARTY."+(o.editMode?"EDIT_COUNTERPARTY":"ADD_COUNTERPARTY")),t.xp6(1),t.Q6J("ngIf",o.editMode),t.xp6(3),t.Q6J("formGroup",o.fGroup),t.xp6(5),t.Oqu(t.lcZ(15,37,"COUNTERPARTY.IIN")),t.xp6(2),t.Q6J("dropSpecialCharacters",!0)("jShadow",o.masks.iinOrBin.shadow)("mask",o.masks.iinOrBin.mask)("formControl",o.fGroup.controls.iinOrBin),t.xp6(1),t.Q6J("jLoading",t.lcZ(18,39,o.checkingCounterParty$))("jLoadingInverted",!0),t.xp6(2),t.Q6J("control",o.fGroup.controls.iinOrBin)("errorMessages",o.errors.iinOrBin),t.xp6(5),t.Oqu(t.lcZ(25,41,"COUNTERPARTY.NAME")),t.xp6(2),t.Q6J("formControl",o.fGroup.controls.name),t.xp6(1),t.Q6J("jLoading",t.lcZ(28,43,o.checkingCounterParty$))("jLoadingInverted",!0),t.xp6(5),t.Oqu(t.lcZ(33,45,"COUNTERPARTY.KBE")),t.xp6(2),t.Q6J("mask",o.masks.kbeCode.mask)("jShadow",o.masks.kbeCode.shadow)("dropSpecialCharacters",!0)("formControl",o.fGroup.controls.kbeCode),t.xp6(1),t.Q6J("ngbTooltip",i)("inlineSVG","/assets/icons/payments/question.svg"),t.xp6(1),t.Q6J("control",o.fGroup.controls.kbeCode)("errorMessages",o.errors.kbeCode),t.xp6(1),t.Q6J("ngForOf",o.fGroup.get("accounts").controls),t.xp6(1),t.Q6J("disabled",t.lcZ(39,47,o.updateInProgress$)),t.xp6(2),t.hij("+ ",t.lcZ(41,49,"COUNTERPARTY.ADD_ACCOUNT"),""),t.xp6(2),t.Q6J("ngIf",o.errorText),t.xp6(2),t.Q6J("disabled",t.lcZ(45,51,o.updateInProgress$)),t.xp6(2),t.Oqu(t.lcZ(47,53,"SHARED.CANCEL")),t.xp6(2),t.Q6J("disabled",t.lcZ(49,55,o.updateInProgress$))("jLoading",t.lcZ(50,57,o.updateInProgress$)),t.xp6(3),t.Oqu(t.lcZ(52,59,"SHARED.SAVE"))}},directives:[u.Pi,E.d$,m.O5,p._Y,p.JL,p.sg,Y.O8,st.I,N.m,Q.hx,p.Fj,at.N,p.JJ,p.oH,ct.v,pt.T,mt.k,y._L,m.sg,p.CE,B.k,U.X,dt.w,ut.u,ht.q,Ot.s],pipes:[T.w,u.X$,m.Ov,L.vI],styles:[".modal-body[_ngcontent-%COMP%]{padding:.25rem 1.5rem .5rem;flex-grow:1}.modal-body[_ngcontent-%COMP%]   .counterParty[_ngcontent-%COMP%]{width:3em;position:relative}.modal-footer[_ngcontent-%COMP%]{padding:.25rem 1.5rem 1rem;flex-shrink:0}.modal-header[_ngcontent-%COMP%]{padding:1.5rem 1.5rem 1rem;flex-shrink:0}.scrolled[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;max-height:calc(100vh - 280px)}j-edit-counterparty[_ngcontent-%COMP%]{display:flex;flex-direction:row;max-height:calc(100vh - 80px)}"]}),n})();var ft=l(26164),gt=l(66013);let H=(()=>{class n{constructor(){}get value(){return this.control.value}patchValue(e,o){let i=this.control.value||[];o?i.push(e):i=i.filter(a=>a!==e),this.control.patchValue(i)}selectAll(){this.control.patchValue(this.rows.map(({id:e})=>e))}clearAll(){this.control.patchValue([])}get isAllSelected(){return this.control.value.length===this.rows.length&&this.rows.length>0}get valueChanges(){return this.control.valueChanges}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=t.lG2({type:n,selectors:[["","jSelectionContainer",""]],inputs:{control:["jSelectionContainer","control"],rows:"rows"}}),n})(),$=(()=>{class n{constructor(e,o){this.container=e,this.cd=o,this.subs=new R.w}change(e){this.masterSelect?this.container.isAllSelected?this.container.clearAll():this.container.selectAll():this.container.patchValue(this.id,e)}ngOnInit(){this.subs.add(this.container.valueChanges.pipe((0,q.b)(0)).subscribe(e=>{if(this.masterSelect)this.checked=this.container.isAllSelected,this.cd.detectChanges();else{const o=!!e.find(i=>i===this.id);o!==this.checked&&(this.checked=o,this.cd.detectChanges())}}))}ngAfterViewInit(){}ngOnDestroy(){this.subs.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(H),t.Y36(t.sBO))},n.\u0275dir=t.lG2({type:n,selectors:[["","jSelectionRow",""]],hostVars:1,hostBindings:function(e,o){1&e&&t.NdJ("change",function(a){return o.change(a.target.checked)}),2&e&&t.Ikx("checked",o.checked)},inputs:{id:["jSelectionRow","id"],masterSelect:"masterSelect"}}),n})();var Yt=l(53571);function Nt(n,r){if(1&n&&(t.TgZ(0,"p",17),t._UZ(1,"j-entity-logo",18),t.ALo(2,"bankFromAccount"),t._uU(3),t.ALo(4,"bankFromAccount"),t.qZA()),2&n){const e=r.$implicit;t.xp6(1),t.Q6J("name",t.lcZ(2,2,e.iban)),t.xp6(2),t.hij(" ",t.lcZ(4,4,e.iban)," ")}}function Ut(n,r){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"formatIban"),t.qZA()),2&n){const e=r.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e.iban)," ")}}function $t(n,r){if(1&n&&(t.ynx(0),t.TgZ(1,"div",3)(2,"div",4),t._UZ(3,"input",5)(4,"label",6),t.qZA()(),t.TgZ(5,"div",7)(6,"p",8),t._uU(7),t.qZA()(),t.TgZ(8,"div",9)(9,"p",8),t._uU(10),t.qZA()(),t.TgZ(11,"div",10)(12,"p",8),t._uU(13),t.qZA()(),t.TgZ(14,"div",11),t.YNc(15,Nt,5,6,"p",12),t.qZA(),t.TgZ(16,"div",13),t.YNc(17,Ut,3,3,"p",14),t.qZA(),t.TgZ(18,"div",15),t.GkF(19,16),t.qZA(),t.BQk()),2&n){const e=t.oxw(),o=t.MAs(2);t.xp6(3),t.Q6J("jSelectionRow",e.item.id),t.uIk("id",e.item.id),t.xp6(1),t.uIk("for",e.item.id),t.xp6(3),t.Oqu(e.item.iinOrBin),t.xp6(3),t.Oqu(e.item.name),t.xp6(3),t.Oqu(e.item.kbe.code),t.xp6(2),t.Q6J("ngForOf",e.item.accounts),t.xp6(2),t.Q6J("ngForOf",e.item.accounts),t.xp6(2),t.Q6J("ngTemplateOutlet",o)}}function Jt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"span",19)(1,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw().onEdit()}),t.ALo(2,"translate"),t._UZ(3,"i",21),t.ALo(4,"svgPath"),t.qZA()(),t.TgZ(5,"span")(6,"button",22),t.NdJ("click",function(){return t.CHM(e),t.oxw().onRemove()}),t.ALo(7,"translate"),t._UZ(8,"i",21),t.ALo(9,"svgPath"),t.qZA()()}2&n&&(t.xp6(1),t.Q6J("ngbTooltip",t.lcZ(2,4,"COUNTERPARTY.EDIT_COUNTERPARTY")),t.xp6(2),t.Q6J("inlineSVG",t.lcZ(4,6,"edit")),t.xp6(3),t.Q6J("ngbTooltip",t.lcZ(7,8,"COUNTERPARTY.DELETE_COUNTERPARTY")),t.xp6(2),t.Q6J("inlineSVG",t.lcZ(9,10,"bucket")))}function Ft(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",23)(1,"span",24),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"button",25),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCancelRemove()}),t._UZ(5,"i",21),t.ALo(6,"svgPath"),t.TgZ(7,"small",26),t._uU(8),t.ALo(9,"translate"),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,4,e.row.deleteWith?"COUNTERPARTY.DELETED_COUNTERPARTIES":"COUNTERPARTY.DELETED_COUNTERPARTY")),t.xp6(3),t.Q6J("inlineSVG",t.lcZ(6,6,"arrow-loop-left")),t.xp6(3),t.AsE("",t.lcZ(9,8,"SHARED.RETURN")," ",e.removing,"")}}let Gt=(()=>{class n{constructor(){this.remove=new t.vpe,this.cancelRemove=new t.vpe,this.edit=new t.vpe}ngOnInit(){}onEdit(){this.edit.emit(this.row)}onRemove(){this.remove.emit(this.row)}onCancelRemove(){this.cancelRemove.emit(this.row)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["j-counterparty-row"]],hostAttrs:[1,"j-table--row"],inputs:{item:"item",row:"row",removing:"removing"},outputs:{remove:"remove",cancelRemove:"cancelRemove",edit:"edit"},decls:5,vars:2,consts:[[4,"ngIf","ngIfElse"],["actionsTpl",""],["removingTpl",""],[1,"counterparty-list--select","p3","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"jSelectionRow"],[1,"custom-control-label"],[1,"counterparty-list--iin","p3","j-table--cell","j-table--cell_static"],[1,"m-0"],[1,"counterparty-list--name","p3","j-table--cell"],[1,"counterparty-list--kbe","p3","j-table--cell","j-table--cell_static"],[1,"counterparty-list--bank","p3","j-table--cell","j-table--cell_static"],["class","d-flex align-items-center",4,"ngFor","ngForOf"],[1,"counterparty-list--account","p3","j-table--cell","j-table--cell_static"],[4,"ngFor","ngForOf"],[1,"counterparty-list--tools","p3","j-table--cell"],[3,"ngTemplateOutlet"],[1,"d-flex","align-items-center"],["size","sm",1,"mr-1",3,"name"],[1,"mr-2"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray","ml-auto",3,"ngbTooltip","click"],[3,"inlineSVG"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[1,"p3","j-table--cell","counterparty-list--removing","d-flex"],[1,"text-muted"],["type","button",1,"ml-auto","btn","btn-link","text-info","p-0",3,"click"],[1,"ml-1"]],template:function(e,o){if(1&e&&(t.YNc(0,$t,20,9,"ng-container",0),t.YNc(1,Jt,10,12,"ng-template",null,1,t.W1O),t.YNc(3,Ft,10,10,"ng-template",null,2,t.W1O)),2&e){const i=t.MAs(4);t.Q6J("ngIf",!o.removing)("ngIfElse",i)}},directives:[m.O5,$,m.sg,B.k,m.tP,y._L,E.d$],pipes:[L.vI,Yt.O,u.X$,T.w],styles:[""],changeDetection:0}),n})();var yt=l(35803);let vt=(()=>{class n extends h.X{constructor(){super(null)}activate(e){this.next(e)}clearAll(){this.next(null)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),_t=(()=>{class n{constructor(e,o){this.teleport=e,this.template=o}ngOnChanges(e){const o=e.target;!o||(o.previousValue&&this.teleport.activate({[o.previousValue]:null}),o.currentValue&&this.teleport.activate({[o.currentValue]:this.template}))}ngOnDestroy(){this.target&&this.teleport.activate({[this.target]:null})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(vt),t.Y36(t.Rgc))},n.\u0275dir=t.lG2({type:n,selectors:[["ng-template","jPortalledTpl",""]],inputs:{target:["jPortalledTpl","target"]},features:[t.TTD]}),n})();var bt=l(4602);const Qt=["contentBody"],Vt=["emptyBody"],qt=["errorBody"];function Bt(n,r){1&n&&t.GkF(0)}function Ht(n,r){1&n&&t.GkF(0)}function Xt(n,r){if(1&n&&(t.TgZ(0,"div",13),t.YNc(1,Bt,1,0,"ng-container",14),t.YNc(2,Ht,1,0,"ng-container",14),t.qZA()),2&n){const e=t.oxw(),o=t.MAs(10);t.xp6(1),t.Q6J("ngTemplateOutlet",o),t.xp6(1),t.Q6J("ngTemplateOutlet",e.contentTpl)}}function Wt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onRemoveSelected()}),t.ALo(1,"translate"),t._UZ(2,"i",30),t.ALo(3,"svgPath"),t.qZA()}2&n&&(t.Q6J("ngbTooltip",t.lcZ(1,2,"COUNTERPARTY.DELETE_COUNTERPARTIES")),t.xp6(2),t.Q6J("inlineSVG",t.lcZ(3,4,"bucket")))}function Kt(n,r){if(1&n&&(t.TgZ(0,"div",15)(1,"div",16)(2,"div",17)(3,"div",18),t._UZ(4,"input",19)(5,"label",20),t.qZA()(),t.TgZ(6,"div",21),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"div",22),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"div",23),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"div",24),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"div",25),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"div",26)(22,"span",27),t.YNc(23,Wt,4,6,"button",28),t.qZA()()()()),2&n){const e=t.oxw();t.xp6(4),t.Q6J("masterSelect",!0),t.xp6(3),t.hij("",t.lcZ(8,7,"COUNTERPARTY.IIN")," "),t.xp6(3),t.Oqu(t.lcZ(11,9,"COUNTERPARTY.NAME")),t.xp6(3),t.hij("",t.lcZ(14,11,"COUNTERPARTY.KBE")," "),t.xp6(3),t.hij("",t.lcZ(17,13,"COUNTERPARTY.BANK")," "),t.xp6(3),t.Oqu(t.lcZ(20,15,"COUNTERPARTY.ACCOUNT_NUMBER")),t.xp6(4),t.Q6J("ngIf",e.selectionModel.value.length)}}function zt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"j-counterparty-row",33),t.NdJ("edit",function(){const a=t.CHM(e).$implicit;return t.oxw(2).onEdit(a)})("remove",function(){const a=t.CHM(e).$implicit;return t.oxw(2).onRemove(a)})("cancelRemove",function(){const a=t.CHM(e).$implicit;return t.oxw(2).onCancelRemove(a)}),t.ALo(1,"async"),t.qZA()}if(2&n){const e=r.$implicit;t.Q6J("hidden",e.hidden)("row",e)("item",e.data)("removing",t.lcZ(1,4,e.removing$))}}function te(n,r){if(1&n&&(t.TgZ(0,"div",31),t.YNc(1,zt,2,6,"ng-template",32),t.ALo(2,"async"),t.ALo(3,"trackByProperty"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",t.lcZ(2,2,e.composedRows$))("ngForTrackBy",t.lcZ(3,4,"id"))}}function ee(n,r){1&n&&t._UZ(0,"j-empty-placeholder",34)}function oe(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",35)(1,"p",36),t._uU(2,"SHARED.LIST_LOADING_ERR_REFRESH"),t.qZA(),t.TgZ(3,"button",37),t.NdJ("click",function(){return t.CHM(e),t.oxw().onRefresh()}),t._uU(4,"SHARED.REFRESH"),t.qZA()()}}function ne(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",38),t.NdJ("click",function(){return t.CHM(e),t.oxw().onEdit()}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij("+ ",t.lcZ(2,1,"COUNTERPARTY.ADD_COUNTERPARTY"),""))}function ie(n,r){1&n&&t.GkF(0)}function re(n,r){1&n&&t.GkF(0)}function le(n,r){if(1&n&&(t.TgZ(0,"div",39),t.YNc(1,ie,1,0,"ng-container",14),t.YNc(2,re,1,0,"ng-container",14),t.qZA()),2&n){t.oxw();const e=t.MAs(21);t.xp6(1),t.Q6J("ngTemplateOutlet",e),t.xp6(1),t.Q6J("ngTemplateOutlet",e)}}const se=function(){return{width:"200px",height:"25px","background-color":"#ECEEF1"}},xt=function(){return{height:"115px","background-color":"#ECEEF1"}};function ae(n,r){1&n&&t._UZ(0,"ngx-skeleton-loader",40)(1,"ngx-skeleton-loader",40)(2,"ngx-skeleton-loader",40),2&n&&(t.Q6J("theme",t.DdM(3,se)),t.xp6(1),t.Q6J("theme",t.DdM(4,xt)),t.xp6(1),t.Q6J("theme",t.DdM(5,xt)))}let Ct=(()=>{class n{constructor(e,o,i,a,s){this.company=e,this.recipients=o,this.modalService=i,this.notifierService=a,this.translateService=s,this.search=new p.NI(""),this.rows$=new h.X([]),this.composedRows$=new h.X([]),this.loadingErrors$=new h.X(void 0),this.selectionModel=new p.NI([]),this.subs=new R.w}ngOnInit(){this.store=this.recipients.store,this.subs.add(this.company.currentCompany$.pipe((0,k.g)(0),(0,z.T)(1)).subscribe(e=>{this.selectionModel.patchValue([]),this.rows$.getValue().forEach(o=>{o.cancelRemove$&&o.cancelRemove$.next(Date.now())})})),this.combineFilter(),this.watchForBodyTpl(),this.watchForItems(),this.onRefresh()}selectAll(){}ngOnDestroy(){this.subs.unsubscribe()}onEdit(e){const o=this.modalService.open(Lt,{backdropClass:"backdrop_light",windowClass:"modal_light modal-adaptive_sm modal_max-height modal-adaptive",centered:!0,backdrop:"static"});o.componentInstance.item=null==e?void 0:e.data,o.result.then(i=>this.handleEditResult(i,e))}onRemoveSelected(){let e=this.selectionModel.value;e=e[e.length-1];const o=this.rows$.getValue().find(i=>i.data.id===e);o&&this.startDeleteProcess(o,!0)}onRemove(e,o){this.startDeleteProcess(e,o)}onCancelRemove(e){e.cancelRemove$&&e.cancelRemove$.next(Date.now())}onRefresh(){return(0,b.mG)(this,void 0,void 0,function*(){try{yield this.recipients.getRecipients("",!0),this.selectionModel.patchValue([]),this.loadingErrors$.next(null)}catch(e){this.rows$.next([]),this.selectionModel.patchValue([]),this.loadingErrors$.next(e)}})}handleEditResult(e,o){e&&([v.create,v.update].some(i=>i===e.type)?(this.notifierService.notify("success",this.translateService.instant("COUNTERPARTY."+(v.create===e.type?"CREATED_COUNTERPARTY":"UPDATED_COUNTERPARTY"))),this.store.upsertItem(e.payload)):this.startDeleteProcess(o))}watchForItems(){this.subs.add((0,x.aj)([this.store.items$,this.store.fetching$,this.store.fetched$]).pipe((0,D.h)(([e,o,i])=>!o&&i),(0,f.U)(e=>e[0]),(0,w.x)(),(0,C.b)(e=>this.selectionModel.patchValue([])),(0,f.U)(e=>e.map(o=>new et(o)))).subscribe(e=>{this.rows$.next(e)}))}combineFilter(){this.subs.add((0,x.aj)([this.rows$,this.search.valueChanges.pipe((0,I.O)(""))]).pipe((0,f.U)(([e,o])=>e.filter(a=>!a.hidden&&this.recipients.filterRecipient(a.data,o)))).subscribe(this.composedRows$))}watchForBodyTpl(){this.subs.add((0,x.aj)([this.store.fetched$,this.search.valueChanges.pipe((0,I.O)("")),this.loadingErrors$,this.composedRows$]).pipe((0,k.g)(0),(0,f.U)(([e,o,i,a])=>i?this.errorBody:e&&!a.length?this.emptyBody:this.contentBody),(0,w.x)()).subscribe(e=>this.contentTpl=e))}startDeleteProcess(e,o){let i;if(o){const s=this.selectionModel.value.reduce((c,d)=>(c[d]=!0,c),{});delete s[e.data.id],i=this.rows$.getValue().filter(c=>s[c.data.id]),e.deleteWith=i,i.forEach(c=>c.hidden=!0)}e.cancelRemove$=new V.xQ,e.removing$.next("5"),this.rows$.next([...this.rows$.getValue()]);const a=(0,K.F)(1e3).pipe((0,M.R)(e.cancelRemove$.pipe((0,C.b)(()=>{e.removing$.next(""),e.deleteWith&&(e.deleteWith.forEach(s=>s.hidden=!1),e.deleteWith=null),e.cancelRemove$=null}))),(0,C.b)(s=>{e.removing$.next((+e.removing$.getValue()-1).toString())}),(0,tt.q)(5)).subscribe({next:s=>{4===s&&this.finishRemove(e,i)},complete:()=>a.unsubscribe(),error:()=>a.unsubscribe()})}finishRemove(e,o){return(0,b.mG)(this,void 0,void 0,function*(){!e.destroy$.closed&&e.removing$.next(null);let i=[];i=o?o.map(s=>s.data.id).concat(e.data.id):[e.data.id],this.store.removeItems(i);const a=i.reduce((s,c)=>(s[c]=!0,s),{});this.selectionModel.patchValue(this.selectionModel.value.filter(s=>!a[s])),[e,...o||[]].forEach(s=>s.destroy());try{yield this.recipients.deleteRecipient(i),this.notifierService.notify("success",this.translateService.instant("COUNTERPARTY."+(i.length>1?"DELETED_COUNTERPARTIES":"DELETED_COUNTERPARTY")))}catch(s){this.notifierService.notify("error",s)}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(ft.J),t.Y36(rt.F),t.Y36(y.FF),t.Y36(gt.lG),t.Y36(u.sK))},n.\u0275cmp=t.Xpm({type:n,selectors:[["j-counterparties"]],viewQuery:function(e,o){if(1&e&&(t.Gf(Qt,5),t.Gf(Vt,5),t.Gf(qt,5)),2&e){let i;t.iGM(i=t.CRH())&&(o.contentBody=i.first),t.iGM(i=t.CRH())&&(o.emptyBody=i.first),t.iGM(i=t.CRH())&&(o.errorBody=i.first)}},decls:22,vars:12,consts:[[1,"list-page--content","list-page--content_counterparties",3,"jSelectionContainer","rows"],[1,"list-page--filter"],["clearable","true"],["jPrefix","","inlineSVG","/assets/icons/search.svg",1,"text-primary","d-block","mt-n1"],["type","text","jFormInput","","autocomplete","off",1,"form-control",3,"placeholder","formControl"],["class","counterparty-list j-table",4,"ngIf","ngIfElse"],["tableHead",""],["contentBody",""],["emptyBody",""],["errorBody",""],["jPortalledTpl","DIRECTORY_TITLE"],["loading",""],["loaderPart",""],[1,"counterparty-list","j-table"],[4,"ngTemplateOutlet"],[1,"j-table--head"],[1,"j-table--row"],[1,"counterparty-list--select","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox","id","checkboxAll","jSelectionRow","",1,"custom-control-input",3,"masterSelect"],["for","checkboxAll",1,"custom-control-label"],[1,"counterparty-list--iin","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--name","j-table--cell","p4"],[1,"counterparty-list--kbe","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--bank","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--account","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--tools","j-table--cell"],[1,"ml-auto"],["type","button","tooltipClass","tooltip-light","placement","top","class","btn btn-link btn-as-text btn-link-light-gray",3,"ngbTooltip","click",4,"ngIf"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[3,"inlineSVG"],[1,"j-table--body"],["ngFor","",3,"ngForOf","ngForTrackBy"],[3,"hidden","row","item","removing","edit","remove","cancelRemove"],["label","COUNTERPARTY.NO_COUNTERPARTIES"],[1,"text-center","pt-5"],["translate","",1,"text-gray","text-gray"],["translate","","ng-disabled","store.fetching$ | async",1,"btn","btn-link","p-1",3,"click"],[1,"mt-n3","btn","btn-link","p-0",3,"click"],[1,"p-4"],[3,"theme"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0),t.ALo(1,"async"),t.TgZ(2,"div",1)(3,"j-form-field",2),t._UZ(4,"span",3)(5,"input",4),t.ALo(6,"translate"),t.qZA()(),t.YNc(7,Xt,3,2,"div",5),t.ALo(8,"async"),t.YNc(9,Kt,24,17,"ng-template",null,6,t.W1O),t.YNc(11,te,4,6,"ng-template",null,7,t.W1O),t.qZA(),t.YNc(13,ee,1,0,"ng-template",null,8,t.W1O),t.YNc(15,oe,5,0,"ng-template",null,9,t.W1O),t.YNc(17,ne,3,3,"ng-template",10),t.YNc(18,le,3,2,"ng-template",null,11,t.W1O),t.YNc(20,ae,3,6,"ng-template",null,12,t.W1O)),2&e){const i=t.MAs(19);t.Q6J("jSelectionContainer",o.selectionModel)("rows",t.lcZ(1,6,o.composedRows$)),t.xp6(5),t.s9C("placeholder",t.lcZ(6,8,"FILTER.SEARCH.COUNTERPARTY")),t.Q6J("formControl",o.search),t.xp6(2),t.Q6J("ngIf",t.lcZ(8,10,o.store.fetched$))("ngIfElse",i)}},directives:[H,Y.O8,U.X,E.d$,N.m,p.Fj,p.JJ,p.oH,m.O5,m.tP,$,y._L,m.sg,Gt,yt.j,u.Pi,_t,G.xr],pipes:[m.Ov,u.X$,T.w,bt.$],styles:[".counterparty-list{min-height:200px;overflow:auto}.counterparty-list .j-table--head{min-width:760px;position:sticky;top:0}.counterparty-list .j-table--body{min-width:760px}.counterparty-list .counterparty-list--select{position:sticky;left:0;background:#fff}.counterparty-list--select{flex-basis:50px;max-width:50px}.counterparty-list--name{flex-basis:140px}.counterparty-list--iin{flex-basis:110px}.counterparty-list--bank{flex-basis:125px}.counterparty-list--bank>p{line-height:2em;margin-bottom:0}.counterparty-list--bank>p+p{margin-top:1em}.counterparty-list--account{flex-basis:210px}.counterparty-list--account>p{margin-bottom:0;line-height:2em}.counterparty-list--account>p+p{margin-top:1em}.counterparty-list--kbe{flex-basis:40px}.counterparty-list--tools{flex-basis:64px;margin-left:auto;text-align:right;padding-top:18px;padding-bottom:18px}.counterparty-list--tools .btn+.btn{margin-left:1em}.counterparty-list--removing{background-color:#f6f7f8}@media (min-width: 960px){.counterparty-list--bank{flex-basis:150px}.counterparty-list{overflow:initial}.counterparty-list .counterparty-list--select{position:static}.counterparty-list .j-table--head{min-width:none;position:static}.counterparty-list .j-table--body{min-width:none}}\n"],encapsulation:2}),n})();var ce=l(35958),pe=l(5254),me=l(27221),Et=l(12266),J=l(37212),Tt=l(6699),de=l(62994),ue=l(7500),he=l(64397),fe=l(15191),ge=l(81907);const ye=["formDirective"];function ve(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){return t.CHM(e),t.oxw().onDelete()}),t._UZ(1,"i",25),t.ALo(2,"svgPath"),t.qZA()}2&n&&(t.xp6(1),t.Q6J("inlineSVG",t.lcZ(2,1,"bucket")))}function _e(n,r){if(1&n&&(t.TgZ(0,"div",26),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorText," ")}}var _=(()=>{return(n=_||(_={})).create="create",n.delete="delete",n.update="update",_;var n})();let be=(()=>{class n{constructor(e,o,i,a,s,c){this.modal=e,this.employeesService=o,this.maskService=i,this.fb=a,this.paymentsService=s,this.translate=c,this.autocomplete$=new h.X(void 0),this.updateInProgress$=new h.X(void 0),this.masks={},this.errors=j.R0,this.minDate=new Date(1900,0,0),this.maxDate=new Date,this.minAmount=.01,this.maxAmount=212500,this.socialSumErr=[{error:"max",message:`${this.translate.instant("ERRORS.MAX_SUM")} ${this.maxAmount}`}],this.lockChildFields=["iin","firstName","lastName","birthDate"],this.subs=new R.w}ngOnInit(){var e,o,i,a,s,c,d,O;if(this.getMaskConfig(),this.fGroup=this.createForm(this.item),(null===(o=null===(e=this.item)||void 0===e?void 0:e.salarySum)||void 0===o?void 0:o.amount)&&this.fGroup.patchValue({salarySum:this.maskService.formatAmount(this.item.salarySum.amount)}),(null===(a=null===(i=this.item)||void 0===i?void 0:i.pensionSum)||void 0===a?void 0:a.amount)&&this.fGroup.patchValue({pensionSum:this.maskService.formatAmount(this.item.pensionSum.amount)}),(null===(c=null===(s=this.item)||void 0===s?void 0:s.socialSum)||void 0===c?void 0:c.amount)&&this.fGroup.patchValue({socialSum:this.maskService.formatAmount(this.item.socialSum.amount)}),(null===(O=null===(d=this.item)||void 0===d?void 0:d.ocmcSum)||void 0===O?void 0:O.amount)&&this.fGroup.patchValue({ocmcSum:this.maskService.formatAmount(this.item.ocmcSum.amount)}),!this.editMode){const{iin:F}=this.fGroup.controls;this.subs.add(F.valueChanges.pipe((0,D.h)(g=>F.valid),(0,q.b)(200),(0,it.w)(g=>F.valid?(this.autocomplete$.next(g),(0,pe.D)(this.employeesService.getNameByIin(g)).pipe((0,f.U)(X=>({bin:g,lastName:X.lastName,firstName:X.firstName,middleName:X.middleName})),(0,M.R)(F.valueChanges),(0,me.K)(()=>(0,ot.of)(null)))):(this.autocomplete$.next(null),nt.E))).subscribe(g=>{g&&this.autocomplete$.getValue()===g.bin&&(this.fGroup.patchValue({lastName:g.lastName.trim()}),this.fGroup.patchValue({firstName:g.firstName.trim()}),this.fGroup.patchValue({middleName:g.middleName.trim()})),this.autocomplete$.next(null)}))}}get isSubmitted(){return this.form.submitted}get editMode(){var e;return null===(e=this.item)||void 0===e?void 0:e.id}createForm(e={}){var o,i,a,s;const c=j.hM.SafeMaxAmount(this.maxAmount),d=j.hM.SafeMinAmount(this.minAmount);return this.fb.group({iin:[{value:e.iin||"",disabled:this.editMode},[p.kI.required,p.kI.minLength(12)]],lastName:[e.lastName||""],firstName:[e.firstName||""],middleName:[e.middleName||""],birthDate:[e.birthDate&&(0,Et.tA)(e.birthDate)||"",[p.kI.required]],iban:[e.iban||"",[O=>this.paymentsService.bankExist((0,J.Rv)(O.value||"",S.w.KZT))]],ocmcSum:[null===(o=e.ocmcSum)||void 0===o?void 0:o.amount,[d,c]],pensionSum:[null===(i=e.pensionSum)||void 0===i?void 0:i.amount,[d,c]],salarySum:[null===(a=e.salarySum)||void 0===a?void 0:a.amount,[d]],socialSum:[null===(s=e.socialSum)||void 0===s?void 0:s.amount,[d,c]]})}onCancel(){this.updateInProgress$.getValue()||this.modal.close()}onSubmit(){if(this.updateInProgress$.getValue())return;if(this.fGroup.invalid)return void this.emulateSubmit();const e=this.prepareBody();this.processRequest(e)}onDelete(){this.modal.close({payload:this.item,type:_.delete})}getMaskConfig(){Object.entries({iin:"iin",iban:"tengeAccount"}).forEach(([e,o])=>this.masks[e]=this.maskService.getConfig(o))}emulateSubmit(){this.form.submitted=!0,this.form.ngSubmit.emit(),this.fGroup.markAllAsTouched()}prepareBody(){const e=(0,J.lm)(this.fGroup);return["ocmcSum","pensionSum","salarySum","socialSum"].forEach(o=>{const i=(0,J.Hy)(e[o]);e[o]=i?{amount:i,currency:S.w.KZT}:null}),e.lastName=e.lastName.trim(),e.firstName=e.firstName.trim(),e.middleName=e.middleName.trim(),e.birthDate=(0,Et.I6)(e.birthDate),e.iban=e.iban&&(0,J.Rv)(e.iban,S.w.KZT)||null,e}processRequest(e){return(0,b.mG)(this,void 0,void 0,function*(){try{let o,i;this.updateInProgress$.next(!0),this.editMode?(o=yield this.employeesService.editEmployee(e),i=_.update):(o=yield this.employeesService.createEmployee(e),i=_.create),this.modal.close({payload:o,type:i})}catch(o){this.updateInProgress$.next(!1),this.errorText=o&&o.description||JSON.stringify(o)}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.Kz),t.Y36(Tt.GP),t.Y36(lt.O),t.Y36(de._0),t.Y36(ue.cR),t.Y36(u.sK))},n.\u0275cmp=t.Xpm({type:n,selectors:[["j-directory-edit-employee"]],viewQuery:function(e,o){if(1&e&&t.Gf(ye,7),2&e){let i;t.iGM(i=t.CRH())&&(o.form=i.first)}},inputs:{item:"item"},features:[t._Bn([{provide:P.rD,useClass:P.hu}])],decls:86,vars:78,consts:[[1,"modal-header"],["translate",""],["type","button",1,"modal-back","mr-3","btn","btn-outline-primary","btn-sm","p-0",3,"click"],[3,"inlineSVG"],["class","edit-counterparty--delete btn btn-link btn-link-light-gray btn-as-text float-right mt-2",3,"click",4,"ngIf"],[1,"modal-body"],[1,"scrolled"],[1,"scrolled--content",3,"formGroup"],["formDirective","ngForm"],[1,"form-group"],["clearable","true"],["type","text","jFormInput","",1,"form-control",3,"dropSpecialCharacters","jShadow","mask","formControl"],["jSuffix","",1,"p3",3,"jLoading","jLoadingInverted"],[3,"control","errorMessages"],["type","text","jFormInput","",1,"form-control",3,"formControl"],[3,"isCalendarShown","label","hasError","formControl","minDate","maxDate"],["jPrefix","","hideEmpty","true",3,"name"],["type","text","jFormInput","","jReplaceOnPaste","KZ","jDynamicPrefix","KZ","jUppercase","",1,"form-control",3,"dropSpecialCharacters","mask","jShadow","formControl"],["accountInput","jFormInput"],["type","text","jFormInput","","jCursorBound","","jReplaceDot","","suffix"," \u20b8","mask","separator.2","thousandSeparator"," ",1,"form-control",3,"dropSpecialCharacters","formControl"],["class","alert alert-danger","translate","",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"disabled","click"],["type","submit",1,"btn","btn-primary",3,"disabled","jLoading","click"],[1,"edit-counterparty--delete","btn","btn-link","btn-link-light-gray","btn-as-text","float-right","mt-2",3,"click"],[1,"d-inline",3,"inlineSVG"],["translate","",1,"alert","alert-danger"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h4",1)(2,"button",2),t.NdJ("click",function(){return o.onCancel()}),t._UZ(3,"i",3),t.ALo(4,"svgPath"),t.qZA(),t._uU(5),t.qZA(),t.YNc(6,ve,3,3,"button",4),t.qZA(),t.TgZ(7,"div",5)(8,"div",6)(9,"form",7,8)(11,"div",9)(12,"j-form-field",10)(13,"j-label",1),t._uU(14,"DIRECTORY.EMPLOYEES.IIN"),t.qZA(),t._UZ(15,"input",11)(16,"div",12),t.ALo(17,"async"),t._UZ(18,"j-error",13),t.qZA()(),t.TgZ(19,"div",9)(20,"j-form-field",10)(21,"j-label",1),t._uU(22,"DIRECTORY.EMPLOYEES.LASTNAME"),t.qZA(),t._UZ(23,"input",14)(24,"div",12),t.ALo(25,"async"),t.qZA()(),t.TgZ(26,"div",9)(27,"j-form-field",10)(28,"j-label",1),t._uU(29,"DIRECTORY.EMPLOYEES.FIRSTNAME"),t.qZA(),t._UZ(30,"input",14)(31,"div",12),t.ALo(32,"async"),t.qZA()(),t.TgZ(33,"div",9)(34,"j-form-field",10)(35,"j-label",1),t._uU(36,"DIRECTORY.EMPLOYEES.MIDDLENAME"),t.qZA(),t._UZ(37,"input",14)(38,"div",12),t.ALo(39,"async"),t.qZA()(),t.TgZ(40,"div",9),t._UZ(41,"j-date-input",15),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"div",9)(44,"j-form-field",10)(45,"j-label",1),t._uU(46,"DIRECTORY.EMPLOYEES.ACCOUNT_SALARY"),t.qZA(),t._UZ(47,"j-entity-logo",16),t.ALo(48,"bankFromAccount"),t._UZ(49,"input",17,18)(51,"j-error",13),t.qZA()(),t.TgZ(52,"div",9)(53,"j-form-field",10)(54,"j-label",1),t._uU(55,"DIRECTORY.EMPLOYEES.SUM_SALARY"),t.qZA(),t._UZ(56,"input",19),t.qZA()(),t.TgZ(57,"div",9)(58,"j-form-field",10)(59,"j-label",1),t._uU(60,"DIRECTORY.EMPLOYEES.SUM_PENSION"),t.qZA(),t._UZ(61,"input",19)(62,"j-error",13),t.qZA()(),t.TgZ(63,"div",9)(64,"j-form-field",10)(65,"j-label",1),t._uU(66,"DIRECTORY.EMPLOYEES.SUM_SOCIAL"),t.qZA(),t._UZ(67,"input",19)(68,"j-error",13),t.qZA()(),t.TgZ(69,"div",9)(70,"j-form-field",10)(71,"j-label",1),t._uU(72,"DIRECTORY.EMPLOYEES.SUM_MEDICAL"),t.qZA(),t._UZ(73,"input",19)(74,"j-error",13),t.qZA()()()(),t.YNc(75,_e,2,1,"div",20),t.qZA(),t.TgZ(76,"div",21)(77,"button",22),t.NdJ("click",function(){return o.onCancel()}),t.ALo(78,"async"),t._uU(79),t.ALo(80,"translate"),t.qZA(),t.TgZ(81,"button",23),t.NdJ("click",function(){return o.onSubmit()}),t.ALo(82,"async"),t.ALo(83,"async"),t._uU(84),t.ALo(85,"translate"),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("inlineSVG",t.lcZ(4,54,"chevron-left")),t.xp6(2),t.hij(" ","DIRECTORY.EMPLOYEES."+(o.editMode?"EDIT_EMPLOYEE":"ADD_EMPLOYEE")," "),t.xp6(1),t.Q6J("ngIf",o.editMode),t.xp6(3),t.Q6J("formGroup",o.fGroup),t.xp6(6),t.Q6J("dropSpecialCharacters",!0)("jShadow",o.masks.iin.shadow)("mask",o.masks.iin.mask)("formControl",o.fGroup.controls.iin),t.xp6(1),t.Q6J("jLoading",t.lcZ(17,56,o.autocomplete$))("jLoadingInverted",!0),t.xp6(2),t.Q6J("control",o.fGroup.controls.iin)("errorMessages",o.errors.iinOrBin),t.xp6(5),t.Q6J("formControl",o.fGroup.controls.lastName),t.xp6(1),t.Q6J("jLoading",t.lcZ(25,58,o.autocomplete$))("jLoadingInverted",!0),t.xp6(6),t.Q6J("formControl",o.fGroup.controls.firstName),t.xp6(1),t.Q6J("jLoading",t.lcZ(32,60,o.autocomplete$))("jLoadingInverted",!0),t.xp6(6),t.Q6J("formControl",o.fGroup.controls.middleName),t.xp6(1),t.Q6J("jLoading",t.lcZ(39,62,o.autocomplete$))("jLoadingInverted",!0),t.xp6(3),t.Q6J("isCalendarShown",!1)("label",t.lcZ(42,64,"DIRECTORY.EMPLOYEES.BIRTH_DATE"))("hasError",o.fGroup.controls.birthDate.errors&&o.isSubmitted)("formControl",o.fGroup.controls.birthDate)("minDate",o.minDate)("maxDate",o.maxDate),t.xp6(6),t.Q6J("name",t.lcZ(48,66,"KZ"+o.fGroup.controls.iban.value)),t.xp6(2),t.Q6J("dropSpecialCharacters",!0)("mask",o.masks.iban.mask)("jShadow",o.masks.iban.shadow)("formControl",o.fGroup.controls.iban),t.xp6(2),t.Q6J("control",o.fGroup.controls.iban)("errorMessages",o.errors.bankAccount),t.xp6(5),t.Q6J("dropSpecialCharacters",!0)("formControl",o.fGroup.controls.salarySum),t.xp6(5),t.Q6J("dropSpecialCharacters",!0)("formControl",o.fGroup.controls.pensionSum),t.xp6(1),t.Q6J("control",o.fGroup.controls.pensionSum)("errorMessages",o.socialSumErr),t.xp6(5),t.Q6J("dropSpecialCharacters",!0)("formControl",o.fGroup.controls.socialSum),t.xp6(1),t.Q6J("control",o.fGroup.controls.socialSum)("errorMessages",o.socialSumErr),t.xp6(5),t.Q6J("dropSpecialCharacters",!0)("formControl",o.fGroup.controls.ocmcSum),t.xp6(1),t.Q6J("control",o.fGroup.controls.ocmcSum)("errorMessages",o.socialSumErr),t.xp6(1),t.Q6J("ngIf",o.errorText),t.xp6(2),t.Q6J("disabled",t.lcZ(78,68,o.updateInProgress$)),t.xp6(2),t.Oqu(t.lcZ(80,70,"SHARED.CANCEL")),t.xp6(2),t.Q6J("disabled",t.lcZ(82,72,o.updateInProgress$))("jLoading",t.lcZ(83,74,o.updateInProgress$)),t.xp6(3),t.Oqu(t.lcZ(85,76,"SHARED.SAVE")))},directives:[u.Pi,E.d$,m.O5,p._Y,p.JL,p.sg,Y.O8,st.I,N.m,Q.hx,p.Fj,at.N,p.JJ,p.oH,ct.v,pt.T,mt.k,he.Y,B.k,U.X,dt.w,ut.u,ht.q,fe.a,ge.s],pipes:[T.w,m.Ov,u.X$,L.vI],styles:[".modal-body[_ngcontent-%COMP%]{padding:.25rem 1.5rem .5rem;flex-grow:1}.modal-body[_ngcontent-%COMP%]   .counterParty[_ngcontent-%COMP%]{width:3em;position:relative}.modal-footer[_ngcontent-%COMP%]{padding:.25rem 1.5rem 1rem;flex-shrink:0}.modal-header[_ngcontent-%COMP%]{padding:1.5rem 1.5rem 1rem;flex-shrink:0}.scrolled[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;max-height:calc(100vh - 280px)}j-directory-edit-employee[_ngcontent-%COMP%]{display:flex;flex-direction:row;max-height:calc(100vh - 80px)}.j-form-field[_ngcontent-%COMP%]   .is-loading[_ngcontent-%COMP%]{width:40px;position:relative}"]}),n})();var xe=l(72159),Ce=l(15239);function Ee(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",2)(2,"div",3),t._UZ(3,"input",4)(4,"label",5),t.qZA()(),t.TgZ(5,"div",6)(6,"p",7),t._uU(7),t._UZ(8,"br"),t.TgZ(9,"span",8),t._uU(10),t.ALo(11,"date"),t.qZA()()(),t.TgZ(12,"div",9)(13,"p",10),t._uU(14),t.qZA()(),t.TgZ(15,"div",11)(16,"p",7),t._uU(17),t.ALo(18,"maskIban"),t.qZA()(),t.TgZ(19,"div",12)(20,"p",7),t._UZ(21,"j-money",13),t.qZA()(),t.TgZ(22,"div",14)(23,"p",7),t._UZ(24,"j-money",13),t.qZA()(),t.TgZ(25,"div",14)(26,"p",7),t._UZ(27,"j-money",13),t.qZA()(),t.TgZ(28,"div",14)(29,"p",7),t._UZ(30,"j-money",13),t.qZA()(),t.TgZ(31,"div",15)(32,"span",16)(33,"button",17),t.NdJ("click",function(){return t.CHM(e),t.oxw().onEdit()}),t.ALo(34,"translate"),t._UZ(35,"i",18),t.ALo(36,"svgPath"),t.qZA()(),t.TgZ(37,"span")(38,"button",19),t.NdJ("click",function(){return t.CHM(e),t.oxw().onRemove()}),t.ALo(39,"translate"),t._UZ(40,"i",18),t.ALo(41,"svgPath"),t.qZA()()(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("jSelectionRow",e.item.id),t.uIk("id",e.item.id),t.xp6(1),t.uIk("for",e.item.id),t.xp6(3),t.Oqu(e.item.iin),t.xp6(3),t.Oqu(t.xi3(11,15,e.item.birthDate,"dd.MM.yyyy")),t.xp6(4),t.Oqu(e.fio),t.xp6(3),t.Oqu(t.lcZ(18,18,e.item.iban)),t.xp6(4),t.Q6J("money",e.item.salarySum),t.xp6(3),t.Q6J("money",e.item.pensionSum),t.xp6(3),t.Q6J("money",e.item.socialSum),t.xp6(3),t.Q6J("money",e.item.ocmcSum),t.xp6(3),t.Q6J("ngbTooltip",t.lcZ(34,20,"DIRECTORY.EMPLOYEES.EDIT")),t.xp6(2),t.Q6J("inlineSVG",t.lcZ(36,22,"edit")),t.xp6(3),t.Q6J("ngbTooltip",t.lcZ(39,24,"DIRECTORY.EMPLOYEES.DELETE")),t.xp6(2),t.Q6J("inlineSVG",t.lcZ(41,26,"bucket"))}}const Te=function(n){return{num:n}};function Ze(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",20)(1,"span",21),t._uU(2),t.qZA(),t.TgZ(3,"button",22),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCancelRemove()}),t._UZ(4,"i",18),t.ALo(5,"svgPath"),t.TgZ(6,"small",23),t._uU(7),t.ALo(8,"translate"),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("translateParams",e.row.deleteWith?t.VKq(9,Te,e.row.deleteWith.length+1):null),t.xp6(1),t.Oqu(e.row.deleteWith?"DIRECTORY.EMPLOYEES.EMPLOYEES_DELETED":"DIRECTORY.EMPLOYEES.EMPLOYEE_DELETED"),t.xp6(2),t.Q6J("inlineSVG",t.lcZ(5,5,"arrow-loop-left")),t.xp6(3),t.AsE("",t.lcZ(8,7,"SHARED.RETURN")," ",e.removing,"")}}let Ae=(()=>{class n{constructor(){this.remove=new t.vpe,this.cancelRemove=new t.vpe,this.edit=new t.vpe}ngOnInit(){}onEdit(){this.edit.emit(this.row)}onRemove(){this.remove.emit(this.row)}onCancelRemove(){this.cancelRemove.emit(this.row)}get fio(){const e=[];return this.item.lastName&&e.push(this.item.lastName),this.item.firstName&&e.push(this.item.firstName),this.item.middleName&&e.push(this.item.middleName),e.join(" ")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["j-directory-employee-row"]],hostAttrs:[1,"j-table--row"],inputs:{item:"item",row:"row",removing:"removing"},outputs:{remove:"remove",cancelRemove:"cancelRemove",edit:"edit"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["removingTpl",""],[1,"directory-employees-list--select","p3","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"jSelectionRow"],[1,"custom-control-label"],[1,"directory-employees-list--iin","p3","j-table--cell","j-table--cell_static"],[1,"m-0"],[1,"text-gray"],[1,"directory-employees-list--name","p3","j-table--cell"],[1,"directory-employees-list--name-helper","m-0"],[1,"directory-employees-list--number","p3","j-table--cell","j-table--cell_static"],[1,"directory-employees-list--salary","p3","j-table--cell"],[3,"money"],[1,"directory-employees-list--payment","p3","j-table--cell","j-table--cell_static"],[1,"directory-employees-list--tools","p3","j-table--cell"],[1,"mr-2"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray","ml-auto",3,"ngbTooltip","click"],[3,"inlineSVG"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[1,"p3","j-table--cell","directory-employees-list--removing","d-flex"],["translate","",1,"text-muted",3,"translateParams"],["type","button",1,"ml-auto","btn","btn-link","text-info","p-0",3,"click"],[1,"ml-1"]],template:function(e,o){if(1&e&&(t.YNc(0,Ee,42,28,"ng-container",0),t.YNc(1,Ze,9,11,"ng-template",null,1,t.W1O)),2&e){const i=t.MAs(2);t.Q6J("ngIf",!o.removing)("ngIfElse",i)}},directives:[m.O5,$,xe.y,y._L,E.d$,u.Pi],pipes:[m.uU,Ce.u,u.X$,T.w],styles:[".directory-employees-list--name-helper[_ngcontent-%COMP%]{display:inline-block;max-width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding-right:.2em}"]}),n})();const Re=["contentBody"],Se=["emptyBody"],je=["errorBody"];function Oe(n,r){1&n&&t.GkF(0)}function ke(n,r){1&n&&t.GkF(0)}function De(n,r){if(1&n&&(t.TgZ(0,"div",13),t.YNc(1,Oe,1,0,"ng-container",14),t.YNc(2,ke,1,0,"ng-container",14),t.qZA()),2&n){const e=t.oxw(),o=t.MAs(9);t.xp6(1),t.Q6J("ngTemplateOutlet",o),t.xp6(1),t.Q6J("ngTemplateOutlet",e.contentTpl)}}function we(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onRemoveSelected()}),t.ALo(1,"translate"),t._UZ(2,"i",30),t.ALo(3,"svgPath"),t.qZA()}2&n&&(t.Q6J("ngbTooltip",t.lcZ(1,2,"DIRECTORY.EMPLOYEES.DELETE_MULTY")),t.xp6(2),t.Q6J("inlineSVG",t.lcZ(3,4,"bucket")))}function Ie(n,r){if(1&n&&(t.TgZ(0,"div",15)(1,"div",16)(2,"div",17)(3,"div",18),t._UZ(4,"input",19)(5,"label",20),t.qZA()(),t.TgZ(6,"div",21),t._uU(7,"DIRECTORY.EMPLOYEES.IIN_BIRTH"),t.qZA(),t.TgZ(8,"div",22),t._uU(9,"DIRECTORY.EMPLOYEES.FIO"),t.qZA(),t.TgZ(10,"div",23),t._uU(11,"DIRECTORY.EMPLOYEES.ACCOUNT_N"),t.qZA(),t.TgZ(12,"div",24),t._uU(13,"DIRECTORY.EMPLOYEES.SUM_SAL"),t.qZA(),t.TgZ(14,"div",25),t._uU(15,"DIRECTORY.EMPLOYEES.SUM_PENS"),t.qZA(),t.TgZ(16,"div",25),t._uU(17,"DIRECTORY.EMPLOYEES.SUM_SOC"),t.qZA(),t.TgZ(18,"div",25),t._uU(19,"DIRECTORY.EMPLOYEES.SUM_MEDICAL"),t.qZA(),t.TgZ(20,"div",26)(21,"span",27),t.YNc(22,we,4,6,"button",28),t.qZA()()()()),2&n){const e=t.oxw();t.xp6(4),t.Q6J("masterSelect",!0),t.xp6(18),t.Q6J("ngIf",e.selectionModel.value.length)}}function Me(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"j-directory-employee-row",33),t.NdJ("edit",function(){const a=t.CHM(e).$implicit;return t.oxw(2).onEdit(a)})("remove",function(){const a=t.CHM(e).$implicit;return t.oxw(2).onRemove(a)})("cancelRemove",function(){const a=t.CHM(e).$implicit;return t.oxw(2).onCancelRemove(a)}),t.ALo(1,"async"),t.qZA()}if(2&n){const e=r.$implicit;t.Q6J("hidden",e.hidden)("row",e)("item",e.data)("removing",t.lcZ(1,4,e.removing$))}}function Pe(n,r){if(1&n&&(t.TgZ(0,"div",31),t.YNc(1,Me,2,6,"ng-template",32),t.ALo(2,"async"),t.ALo(3,"trackByProperty"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",t.lcZ(2,2,e.composedRows$))("ngForTrackBy",t.lcZ(3,4,"id"))}}function Le(n,r){if(1&n&&t._UZ(0,"j-empty-placeholder",34),2&n){const e=t.oxw();t.Q6J("label",e.search.value?"DIRECTORY.EMPLOYEES.NOT_FOUND_CHANGE_PARAMS":"PAYMENTS.EMPLOYEES.EMPTY")}}function Ye(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",35)(1,"p",36),t._uU(2,"SHARED.LIST_LOADING_ERR_REFRESH"),t.qZA(),t.TgZ(3,"button",37),t.NdJ("click",function(){return t.CHM(e),t.oxw().onRefresh()}),t._uU(4,"SHARED.REFRESH"),t.qZA()()}}function Ne(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"button",38),t.NdJ("click",function(){return t.CHM(e),t.oxw().onEdit()}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij("+ ",t.lcZ(2,1,"DIRECTORY.EMPLOYEES.ADD_EMPLOYEE"),""))}function Ue(n,r){1&n&&t.GkF(0)}function $e(n,r){1&n&&t.GkF(0)}function Je(n,r){if(1&n&&(t.TgZ(0,"div",39),t.YNc(1,Ue,1,0,"ng-container",14),t.YNc(2,$e,1,0,"ng-container",14),t.qZA()),2&n){t.oxw();const e=t.MAs(20);t.xp6(1),t.Q6J("ngTemplateOutlet",e),t.xp6(1),t.Q6J("ngTemplateOutlet",e)}}const Fe=function(){return{width:"200px",height:"25px","background-color":"#ECEEF1"}},Zt=function(){return{height:"115px","background-color":"#ECEEF1"}};function Ge(n,r){1&n&&t._UZ(0,"ngx-skeleton-loader",40)(1,"ngx-skeleton-loader",40)(2,"ngx-skeleton-loader",40),2&n&&(t.Q6J("theme",t.DdM(3,Fe)),t.xp6(1),t.Q6J("theme",t.DdM(4,Zt)),t.xp6(1),t.Q6J("theme",t.DdM(5,Zt)))}let At=(()=>{class n{constructor(e,o,i,a,s){this.company=e,this.employeeService=o,this.modalService=i,this.notifierService=a,this.translateService=s,this.search=new p.NI(""),this.rows$=new h.X([]),this.composedRows$=new h.X([]),this.loadingErrors$=new h.X(void 0),this.selectionModel=new p.NI([]),this.subs=new R.w,this.store=new ce.td([])}ngOnInit(){this.subs.add(this.company.currentCompany$.pipe((0,k.g)(0),(0,z.T)(1)).subscribe(e=>{this.selectionModel.patchValue([]),this.onRefresh(),this.rows$.getValue().forEach(o=>{o.cancelRemove$&&o.cancelRemove$.next(Date.now())})})),this.combineFilter(),this.watchForBodyTpl(),this.watchForItems(),this.onRefresh()}onEdit(e){const o=this.modalService.open(be,{backdropClass:"backdrop_light",windowClass:"modal_light modal-adaptive_sm modal_max-height modal-adaptive",centered:!0,backdrop:"static"});o.componentInstance.item=null==e?void 0:e.data,o.result.then(i=>this.handleEditResult(i,e))}onRemoveSelected(){let e=this.selectionModel.value;e=e[e.length-1];const o=this.rows$.getValue().find(i=>i.data.id===e);o&&this.startDeleteProcess(o,!0)}onRemove(e,o){this.startDeleteProcess(e,o)}onCancelRemove(e){e.cancelRemove$&&e.cancelRemove$.next(Date.now())}onRefresh(){return(0,b.mG)(this,void 0,void 0,function*(){try{yield this.fetchEmployees(),this.selectionModel.patchValue([]),this.loadingErrors$.next(null)}catch(e){this.rows$.next([]),this.selectionModel.patchValue([]),this.loadingErrors$.next(e)}})}combineFilter(){this.subs.add((0,x.aj)([this.rows$,this.search.valueChanges.pipe((0,I.O)(""))]).pipe((0,f.U)(([e,o])=>{const i=o.toLocaleLowerCase();return e.filter(a=>!a.hidden&&this.employeeService.filterEmployee(a.data,i))})).subscribe(this.composedRows$))}fetchEmployees(){return(0,b.mG)(this,void 0,void 0,function*(){this.store.fetching=!0;try{const e=yield this.employeeService.getEmployees();this.store.setState(e),this.store.fetching=!1,!this.store.fetched&&(this.store.fetched=!0)}catch(e){throw this.store.setState([]),!this.store.fetched&&(this.store.fetched=!0),this.store.fetching=!1,e}})}handleEditResult(e,o){e&&([_.create,_.update].some(i=>i===e.type)?(this.notifierService.notify("success",this.translateService.instant("DIRECTORY.EMPLOYEES."+(_.create===e.type?"EMPLOYEE_ADDED":"EMPLOYEE_EDITED"))),this.store.upsertItem(e.payload)):this.startDeleteProcess(o))}watchForItems(){this.subs.add((0,x.aj)([this.store.items$,this.store.fetching$,this.store.fetched$]).pipe((0,D.h)(([e,o,i])=>!o&&i),(0,f.U)(e=>e[0]),(0,w.x)(),(0,C.b)(e=>this.selectionModel.patchValue([])),(0,f.U)(e=>e.map(o=>new et(o)))).subscribe(e=>{this.rows$.next(e)}))}watchForBodyTpl(){this.subs.add((0,x.aj)([this.store.fetched$,this.search.valueChanges.pipe((0,I.O)("")),this.loadingErrors$,this.composedRows$]).pipe((0,k.g)(0),(0,f.U)(([e,o,i,a])=>i?this.errorBody:e&&!a.length?this.emptyBody:this.contentBody),(0,w.x)()).subscribe(e=>this.contentTpl=e))}startDeleteProcess(e,o){let i;if(o){const s=this.selectionModel.value.reduce((c,d)=>(c[d]=!0,c),{});delete s[e.data.id],i=this.rows$.getValue().filter(c=>s[c.data.id]),e.deleteWith=i,i.forEach(c=>c.hidden=!0)}e.cancelRemove$=new V.xQ,e.removing$.next("5"),this.rows$.next([...this.rows$.getValue()]);const a=(0,K.F)(1e3).pipe((0,M.R)(e.cancelRemove$.pipe((0,C.b)(()=>{e.removing$.next(""),e.deleteWith&&(e.deleteWith.forEach(s=>s.hidden=!1),e.deleteWith=null),e.cancelRemove$=null}))),(0,C.b)(s=>{e.removing$.next((+e.removing$.getValue()-1).toString())}),(0,tt.q)(5)).subscribe({next:s=>{4===s&&this.finishRemove(e,i)},complete:()=>a.unsubscribe(),error:()=>a.unsubscribe()})}finishRemove(e,o){return(0,b.mG)(this,void 0,void 0,function*(){!e.destroy$.closed&&e.removing$.next(null);let i=[];i=o?o.map(c=>c.data.id).concat(e.data.id):[e.data.id];const a=i.map(c=>this.store.entities[c]).map(c=>c&&c.iin);this.store.removeItems(i);const s=i.reduce((c,d)=>(c[d]=!0,c),{});this.selectionModel.patchValue(this.selectionModel.value.filter(c=>!s[c])),[e,...o||[]].forEach(c=>c.destroy());try{yield this.employeeService.deleteEmployee(a),this.notifierService.notify("success",this.translateService.instant("DIRECTORY.EMPLOYEES."+(i.length>1?"EMPLOYEES_DELETED":"EMPLOYEE_DELETED"),{num:i.length}))}catch(c){this.notifierService.notify("error",c)}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(ft.J),t.Y36(Tt.GP),t.Y36(y.FF),t.Y36(gt.lG),t.Y36(u.sK))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-directory-employees"]],viewQuery:function(e,o){if(1&e&&(t.Gf(Re,5),t.Gf(Se,5),t.Gf(je,5)),2&e){let i;t.iGM(i=t.CRH())&&(o.contentBody=i.first),t.iGM(i=t.CRH())&&(o.emptyBody=i.first),t.iGM(i=t.CRH())&&(o.errorBody=i.first)}},decls:21,vars:9,consts:[[1,"list-page--content","list-page--content_counterparties",3,"jSelectionContainer","rows"],[1,"list-page--filter"],["clearable","true"],["jPrefix","","inlineSVG","/assets/icons/search.svg",1,"text-primary","d-block","mt-n1"],["type","text","jFormInput","","placeholder","\u041f\u043e\u0438\u0441\u043a","autocomplete","off",1,"form-control",3,"formControl"],["class","directory-employee--list j-table",4,"ngIf","ngIfElse"],["tableHead",""],["contentBody",""],["emptyBody",""],["errorBody",""],["jPortalledTpl","DIRECTORY_TITLE"],["loading",""],["loaderPart",""],[1,"directory-employee--list","j-table"],[4,"ngTemplateOutlet"],[1,"j-table--head"],[1,"j-table--row"],[1,"directory-employees-list--select","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox","id","checkboxAll","jSelectionRow","",1,"custom-control-input",3,"masterSelect"],["for","checkboxAll",1,"custom-control-label"],["translate","",1,"directory-employees-list--iin","j-table--cell","j-table--cell_static","p4"],["translate","",1,"directory-employees-list--name","j-table--cell","p4"],["translate","",1,"directory-employees-list--number","j-table--cell","j-table--cell_static","p4"],["translate","",1,"directory-employees-list--salary","j-table--cell","p4"],["translate","",1,"directory-employees-list--payment","j-table--cell","j-table--cell_static","p4"],[1,"directory-employees-list--tools","j-table--cell"],[1,"ml-auto"],["type","button","tooltipClass","tooltip-light","placement","top","class","btn btn-link btn-as-text btn-link-light-gray",3,"ngbTooltip","click",4,"ngIf"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[3,"inlineSVG"],[1,"j-table--body"],["ngFor","",3,"ngForOf","ngForTrackBy"],[3,"hidden","row","item","removing","edit","remove","cancelRemove"],[3,"label"],[1,"text-center","pt-5"],["translate","",1,"text-gray","text-gray"],["translate","","ng-disabled","store.fetching$ | async",1,"btn","btn-link","p-1",3,"click"],[1,"mt-n3","btn","btn-link","p-0",3,"click"],[1,"p-4"],[3,"theme"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0),t.ALo(1,"async"),t.TgZ(2,"div",1)(3,"j-form-field",2),t._UZ(4,"span",3)(5,"input",4),t.qZA()(),t.YNc(6,De,3,2,"div",5),t.ALo(7,"async"),t.YNc(8,Ie,23,2,"ng-template",null,6,t.W1O),t.YNc(10,Pe,4,6,"ng-template",null,7,t.W1O),t.qZA(),t.YNc(12,Le,1,1,"ng-template",null,8,t.W1O),t.YNc(14,Ye,5,0,"ng-template",null,9,t.W1O),t.YNc(16,Ne,3,3,"ng-template",10),t.YNc(17,Je,3,2,"ng-template",null,11,t.W1O),t.YNc(19,Ge,3,6,"ng-template",null,12,t.W1O)),2&e){const i=t.MAs(18);t.Q6J("jSelectionContainer",o.selectionModel)("rows",t.lcZ(1,5,o.composedRows$)),t.xp6(5),t.Q6J("formControl",o.search),t.xp6(1),t.Q6J("ngIf",t.lcZ(7,7,o.store.fetched$))("ngIfElse",i)}},directives:[H,Y.O8,U.X,E.d$,N.m,p.Fj,p.JJ,p.oH,m.O5,m.tP,$,u.Pi,y._L,m.sg,Ae,yt.j,_t,G.xr],pipes:[m.Ov,u.X$,T.w,bt.$],styles:[".directory-employee--list{min-height:200px;overflow:auto}.directory-employee--list .j-table--head{min-width:760px;position:sticky;top:0}.directory-employee--list .j-table--body{min-width:760px}.directory-employee--list .directory-employees-list--select{position:sticky;left:0;background:#fff}.directory-employee--list--select{flex-basis:50px;max-width:50px}.directory-employees-list--iin{flex-basis:120px}.directory-employees-list--name{flex-basis:140px;max-width:170px;flex-wrap:wrap}.directory-employees-list--number{flex-basis:100px}.directory-employees-list--salary{flex-basis:120px}.directory-employees-list--payment{flex-basis:80px;max-width:100px}.directory-employees-list--tools{flex-basis:64px;margin-left:auto;text-align:right;padding-top:18px;padding-bottom:18px;min-width:86px}.directory-employees-list--tools .btn+.btn{margin-left:1em}.directory-employees-list--removing{background-color:#f6f7f8}@media (min-width: 960px){.directory-employee--list{overflow:initial;min-width:none}.directory-employee--list .j-table--head{min-width:none;position:static}.directory-employee--list .directory-employees-list--select{position:static;background:none}.directory-employee--list .j-table--body{min-width:none}}\n"],encapsulation:2}),n})();var Qe=l(99430),Ve=l(16831),qe=l(77337),Be=l(194);function He(n,r){1&n&&t.GkF(0)}let Xe=(()=>{class n{constructor(e,o){this.portal=o,this.template$=o.pipe((0,D.h)(i=>!i||e in i),(0,f.U)(i=>i&&i[e]))}}return n.\u0275fac=function(e){return new(e||n)(t.$8M("name"),t.Y36(vt))},n.\u0275cmp=t.Xpm({type:n,selectors:[["j-portal-host"]],inputs:{context:"context"},decls:2,vars:4,consts:[[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,o){1&e&&(t.YNc(0,He,1,0,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngTemplateOutlet",t.lcZ(1,2,o.template$))("ngTemplateOutletContext",o.context)},directives:[m.tP],pipes:[m.Ov],styles:[""]}),n})();const We=function(){return["counterparties"]},Ke=function(){return["employees"]},ze=["*"];let to=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["j-directory-tabs"]],ngContentSelectors:ze,decls:8,vars:4,consts:[[1,"list-page--nav"],[1,"page-tabs"],["routerLinkActive","active","translate","",3,"routerLink"]],template:function(e,o){1&e&&(t.F$t(),t.TgZ(0,"div",0)(1,"nav")(2,"div",1)(3,"a",2),t._uU(4,"DIRECTORY.COUNTERPARTIES.TITLE"),t.qZA(),t.TgZ(5,"a",2),t._uU(6,"DIRECTORY.EMPLOYEES.TITLE"),t.qZA()()(),t.Hsn(7),t.qZA()),2&e&&(t.xp6(3),t.Q6J("routerLink",t.DdM(2,We)),t.xp6(2),t.Q6J("routerLink",t.DdM(3,Ke)))},directives:[A.yS,A.Od,u.Pi],styles:[""]}),n})();const eo=[{path:"",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["j-directory"]],decls:17,vars:3,consts:[[1,"row"],[1,"col-lg-10","offset-lg-1","col-xl-8","offset-xl-2"],[1,"directory__title","header-title"],[1,"directory--actions","d-md-none"],["name","DIRECTORY_TITLE"],[1,"list-page"],[1,"directory--actions","d-none","d-md-block"]],template:function(e,o){1&e&&(t.TgZ(0,"j-layout-home")(1,"j-aside"),t._UZ(2,"j-nav-main"),t.qZA(),t.TgZ(3,"j-main")(4,"div",0)(5,"div",1)(6,"section")(7,"h2",2),t._uU(8),t.ALo(9,"translate"),t.TgZ(10,"div",3),t._UZ(11,"j-portal-host",4),t.qZA()(),t.TgZ(12,"div",5)(13,"j-directory-tabs")(14,"div",6),t._UZ(15,"j-portal-host",4),t.qZA()(),t._UZ(16,"router-outlet"),t.qZA()()()()()()),2&e&&(t.xp6(8),t.hij("",t.lcZ(9,1,"DIRECTORY.TITLE")," "))},directives:[Qe.Y,Ve.l,qe.F,Be.C,Xe,to,A.lC],pipes:[u.X$],styles:[".directory__title{margin-top:40px;margin-bottom:40px}.list-page{background:#fff;box-shadow:0 4px 8px #0000000a,0 0 2px #0000000f,0 0 1px #0000000a;border-radius:12px}.list-page--nav{padding:1rem 1.5rem 0;display:flex;width:100%;align-items:center}.list-page--filter{padding:1rem;background:#f6f7f8}.page-tabs{display:flex;min-width:100%}.page-tabs>a{white-space:nowrap;background:none;display:block;padding:12px 0;color:#666c72;margin-right:2.5rem;font-size:1.125rem}.page-tabs>a.active{color:#1a1c1f;font-weight:500;border-bottom:2px solid #ef5630}.page-tabs>a[disabled]{cursor:not-allowed;opacity:.5}.j-table--row{display:flex;flex-direction:row;width:100%;box-shadow:0 0 #0000000a;transition:ease-in-out .3s box-shadow;will-change:box-shadow}.j-table--row+.j-table--row{border-top:1px solid #eceef1}.j-table--head .j-table--row{border-bottom:1px solid #eceef1;align-items:center}.j-table--body .j-table--row:not(.j-table--row_delete):hover{box-shadow:0 10px 20px #0000000a,0 2px 6px #0000000a,0 0 1px #0000000a}.j-table--cell{flex-grow:1;flex-shrink:1;flex-basis:auto;padding:20px 8px}.j-table--cell:first-child{padding-left:16px}.j-table--cell:last-child{padding-right:16px}.j-table--cell_static{flex-grow:0;flex-shrink:0}.header-title .directory--actions{margin-top:.2em;float:right;margin-left:15px}.directory--actions{margin-left:auto}\n"],encapsulation:2}),n})(),data:{title:"DIRECTORY.TITLE"},children:[{path:"counterparties",component:Ct},{path:"employees",component:At},{path:"**",redirectTo:"counterparties"}]},{path:"**",redirectTo:""}];let oo=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[A.Bz.forChild(eo)],A.Bz]}),n})(),no=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[Z.FormBuilderTypeSafe],imports:[[m.ez,Rt.m,oo,G.hx,p.u5,p.UX,Q.yI.forChild(),St]]}),n})()}}]);