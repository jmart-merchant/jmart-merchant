(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"+BgI":function(e,t,i){"use strict";i.d(t,"a",(function(){return N}));var n=i("mrSG"),a=i("YMfE"),o=i("+/Tu"),s=i("Eajh"),r=i("NlNA"),c=i("i2Gl"),d=i("p6Hd"),u=i("HghS"),l=i("TwVa"),m=i("wd/R"),p=i("D1y2"),y=i.n(p),b=i("fXoL"),h=i("4Nuw"),v=i("0mgW"),g=i("bHA9"),k=i("B1Ao"),f=i("wtV8"),R=i("VnnJ"),P=i("1kSV"),I=i("VO+5"),D=i("mR7B"),S=i("sYmb"),A=i("O/Ur");let N=(()=>{class e{constructor(e,t,i,n,a,o,s,r,c,d,u,l){this.accounts=e,this.payments=t,this.dictionaries=i,this.recipients=n,this.api=a,this.bankFromAccount=o,this.company=s,this.modalService=r,this.notifier=c,this.maskService=d,this.translate=u,this.currencyPayments=l}processPayment(e){return Object(n.a)(this,void 0,void 0,(function*(){try{const t=e;return t.body=this.constructPaymentBody(e.rawBody,e),e.paymentId?e.status===l.h.DRAFT?(t.response=yield this.api.updatePayment(t.body,{paymentId:e.paymentId}),yield this.api.createFromDraft(t.body,{paymentId:e.paymentId}),t.response.status.code=l.h.CREATED,t.verified=yield this.handlePaymentCreateResponse(t.response),this.showResult(!0,{amount:e.total,multySubscribers:this.company.currentCompany.signatureScheme===l.j.MULTIPLE_SIGN,hasRights:this.payments.isSignatureRequired},null,t.response)):(t.response=yield this.api.updatePayment(t.body,{paymentId:e.paymentId}),this.showResult(!0,{amount:e.total,updateCreated:!0},null,t.response)):(t.response=yield this.api.createPayment(t.body),t.verified=yield this.handlePaymentCreateResponse(t.response),this.showResult(!0,{amount:e.total,multySubscribers:this.company.currentCompany.signatureScheme===l.j.MULTIPLE_SIGN,hasRights:this.payments.isSignatureRequired},null,t.response)),t.body.paymentRecipient&&this.checkRecipientsRefresh(t.body),t.response}catch(t){throw t&&this.showResult(!1,void 0,t),t}}))}constructPaymentBody(e,t){var i;let n;return e.type&&e.type!==l.i.INTERNAL&&e.type!==l.i.EXTERNAL?e.type===l.i.TAX?n=this.preparePaymentTaxBody(e,t):[l.i.PENSION,l.i.MEDICAL,l.i.SOCIAL].includes(e.type)?n=this.prepareEmployeePaymentBody(e,t):e.type===l.i.SALARY?n=this.prepareSalaryPaymentBody(e,t):e.type===l.i.IN_BETWEEN||e.type===l.i.CARD_TO_CARD||e.type===l.i.CARD_TO_ACCOUNT||e.type===l.i.ACCOUNT_TO_CARD?n=e:e.type===l.i.FOREIGN?n=this.prepareForeignPaymentBody(e):this.notifier.notify("error","NOT_IMPLEMENTED"):n=this.preparePaymentOrderBody(e,t),(null===(i=t)||void 0===i?void 0:i.userPurpose)&&y()(n,"details.associatedField.parameters.paymentPurpose",t.userPurpose),n}handlePaymentCreateResponse(e){return e.status.code===d.e.REJECTED?Promise.reject(e):this.payments.isSignatureRequired?this.processPaymentVerify(e):Promise.resolve()}saveToDrafts(e,t){return Object(n.a)(this,void 0,void 0,(function*(){const i=Object.assign(this.constructPaymentBody(Object.assign({},e),t),{category:t.category,status:{code:l.h.DRAFT}});try{const e=yield t.paymentId?this.api.updatePayment(i,{paymentId:t.paymentId}):this.api.createPayment(i);return this.notifier.notify("success",t.paymentId?"\u0427\u0435\u0440\u043d\u043e\u0432\u0438\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d":"\u041f\u043b\u0430\u0442\u0435\u0436 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d \u0432 \u0447\u0435\u0440\u043d\u043e\u0432\u0438\u043a"),e}catch(n){throw this.notifier.notify("error","\u041e\u0448\u0438\u0431\u043a\u0430"),n}}))}processPaymentVerify(e){return Object(n.a)(this,void 0,void 0,(function*(){const t=this.modalService.open(c.b,{backdropClass:"backdrop_light",windowClass:"modal_light modal_md",backdrop:"static",centered:!0});return Object.assign(t.componentInstance,{additionalParams:{actionIds:[e.id]}}),Object.assign(t.componentInstance,{headerParams:{smsHeader:d.d.SIGNING_PAYMENT}}),new Promise((i,n)=>{t.componentInstance.submitted.subscribe(a=>{this.api.signPayment(a,e.id).then(n=>{t.close(),localStorage.setItem("preferredSignatureType",a.type===l.p.OTP?c.a.OTP:c.a.SMS),i(e)}).catch(e=>{n(e||null)})}),t.componentInstance.closed.subscribe(()=>{n()})})}))}preparePaymentOrderBody(e,t){const i=e.bankAccount?Object(a.ibanPrefix)(e.bankAccount,o.a.KZT):"",n={iinOrBin:e.iinOrBin,name:e.name,kbe:{name:e.kbeCode,code:e.kbeCode},recipientAccount:{iban:i,bankName:i&&this.bankFromAccount.transform(i,"name"),bic:i&&this.bankFromAccount.transform(i)}},s=this.constructBasePaymentDetails(e,t),r=this.payments.checkPaymentTypeFromIban(s.payerIban,i);return{emailOnSuccess:e.emailOnSuccess,paymentRecipient:n,details:s,category:l.g.DOMESTIC,type:r}}prepareForeignPaymentBody(e){return this.currencyPayments.mapForm(e)}prepareEmployeePaymentBody(e,t){const i=e.commonPeriodEnabled&&e.period&&m(e.period).format(a.ISO_8061),n=this.constructBasePaymentDetails(e,t),o=e.employees.map(e=>{const t=e.fio.split(" "),n=t[0],a=t[1];t.splice(0,2);const o=t.length>0?t.join(" "):null;return{amount:{currency:e.currency,amount:e.amount||0},birthDate:e.birthDate,iin:e.iin,lastname:n,firstname:a,middlename:o,period:i||e.period}});return{category:l.g.DOMESTIC,type:e.type,details:n,paymentEmployees:o}}prepareSalaryPaymentBody(e,t){var i,n,s,r,c;const d=this.dictionaries.bankDictionary.getItemsByIds(e.bankReceiver),u={iinOrBin:null===(i=d)||void 0===i?void 0:i.bin,name:null===(n=d)||void 0===n?void 0:n.name,kbe:{code:e.isResidents?"19":"29"},recipientAccount:{iban:(null===(s=d)||void 0===s?void 0:s.salaryTransitIban)||Object(a.ibanPrefix)(e.bankAccount,o.a.KZT),bic:null===(r=d)||void 0===r?void 0:r.bic}},m=this.constructBasePaymentDetails(e,t),p=null===(c=e.employees)||void 0===c?void 0:c.map(e=>{const[t,i,n]=e.fio.split(" "),a=this.maskService.getNumberedAmount(e.amount);return{iban:e.iban,amount:{currency:o.a.KZT,amount:a||0},birthDate:e.birthDate,iin:e.iin.replace(" ",""),lastname:t,firstname:i,middlename:n}});return{category:l.g.DOMESTIC,type:e.type,details:m,paymentEmployees:p,paymentRecipient:u}}preparePaymentTaxBody(e,t){var i,n,a,o;const s=this.dictionaries.UGDictionary.getItemByKey(e.ugd,"code"),r=this.dictionaries.KBKDictionary.getItemByKey(e.kbk,"code"),c={iinOrBin:null===(i=s)||void 0===i?void 0:i.bin,name:null===(n=s)||void 0===n?void 0:n.name},d=["period","periodStart","periodEnd","vin","protocolNumber"].reduce((t,i)=>(e[i]&&(t[i]=e[i]instanceof Date?m(e[i]).format("MM.yyyy"):e[i]),t),{});return{paymentRecipient:c,details:Object.assign(Object.assign({},this.constructBasePaymentDetails(e,t)),{associatedField:{parameters:d},kbk:{code:null===(a=r)||void 0===a?void 0:a.code,name:null===(o=r)||void 0===o?void 0:o.name}}),category:l.g.DOMESTIC,type:l.i.TAX}}flattenPaymentToModel(e){var t,i,n,o,s,r,c,d,u,p,y,b,h,v,g,k,f,R,P;const{paymentRecipient:I,details:D,paymentEmployees:S,type:A}=e,N=this.accounts.store.items.find(e=>e.iban===D.payerIban),C={amount:this.maskService.getMaskedAmount(null===(t=D.paymentAmount)||void 0===t?void 0:t.amount),number:D.documentId,date:D.valueDate&&Object(a.dateToNgbStruct)(new Date(D.valueDate)),knp:null===(i=D.knp)||void 0===i?void 0:i.code,purpose:D.description,vat:D.vat,urgent:D.urgent,type:A,senderAccount:N,emailOnSuccess:e.emailOnSuccess},O=(null===(n=D.associatedField)||void 0===n?void 0:n.parameters)||{};if(S&&(C.employees=S.map(e=>({amount:e.amount.amount,iin:e.iin,fio:[e.lastname,e.firstname,e.middlename].join(" "),birthDate:e.birthDate,period:e.period,iban:e.iban})),C.employees.length)){const e=C.employees[0].period;C.commonPeriodEnabled=C.employees.every(t=>t.period&&t.period===e),C.commonPeriodEnabled&&(C.period=m(e,a.ISO_8061).toDate())}switch(A){case l.i.MEDICAL:case l.i.PENSION:case l.i.SOCIAL:break;case l.i.SALARY:const t=this.dictionaries.bankDictionary.getItemByKey(null===(s=null===(o=I)||void 0===o?void 0:o.recipientAccount)||void 0===s?void 0:s.bic,"bic");t&&(C.bankReceiver=t.id,t.salaryTransitIban||(C.bankAccount=null===(c=null===(r=I)||void 0===r?void 0:r.recipientAccount)||void 0===c?void 0:c.iban)),I&&(C.isResidents="19"===(null===(u=null===(d=I)||void 0===d?void 0:d.kbe)||void 0===u?void 0:u.code));break;case l.i.TAX:let i;(null===(p=I)||void 0===p?void 0:p.iinOrBin)&&(i=this.dictionaries.UGDictionary.getItemByKey(I.iinOrBin,"bin")),Object.assign(C,{ugd:null===(y=i)||void 0===y?void 0:y.code,kbk:null===(b=D.kbk)||void 0===b?void 0:b.code,vin:null===(h=O)||void 0===h?void 0:h.vin,protocolNumber:null===(v=O)||void 0===v?void 0:v.protocolNumber}),["period","periodStart","periodEnd"].forEach(e=>{var t;const i=O[e],n=i&&m(i,"MM.yyyy");(null===(t=n)||void 0===t?void 0:t.isValid())&&(C[e]=n.toDate())}),(C.periodEnd||C.periodEnd)&&(C.intervalEnabled=!0);break;case l.i.FOREIGN:Object.assign(C,this.currencyPayments.mapPayment(e));break;default:Object.assign(C,{iinOrBin:null===(g=I)||void 0===g?void 0:g.iinOrBin,name:null===(k=I)||void 0===k?void 0:k.name,bankAccount:null===(R=null===(f=I)||void 0===f?void 0:f.recipientAccount)||void 0===R?void 0:R.iban,kbeCode:null===(P=I)||void 0===P?void 0:P.kbe.code})}return C}showResult(e,t={},i,n){const a=this.modalService.open(u.a,{backdropClass:"backdrop_light",windowClass:"modal_light modal_sm",centered:!0,backdrop:"static"});Object.assign(a.componentInstance,{message:i&&(i.colvirResultDescription||"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043d\u0435\u043f\u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043d\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0434\u043d\u0435\u0435"),result:e,currency:o.a.KZT,amount:this.maskService.getNumberedAmount(t.amount)||0,multySubscribers:t.multySubscribers,hasRights:this.company.authorityLevel!==r.a.NO_SIGNATURE,payment:n,updateCreated:t.updateCreated})}constructBasePaymentDetails(e,t){var i,n,r;const c=this.dictionaries.KNPDictionary.getItemByKey(e.knp,"code"),d=this.maskService.getNumberedAmount(e.amount);return{valueDate:e.date&&Object(a.ngbDateToUTCStartDay)(e.date).toISOString()||e.date,knp:{code:e.knp,name:c&&c.name||s.b},description:e.purpose,payerIban:null===(i=e.senderAccount)||void 0===i?void 0:i.iban,paymentAmount:{amount:d,currency:null===(r=null===(n=e.senderAccount)||void 0===n?void 0:n.balance)||void 0===r?void 0:r.currency},commission:{amount:t.commission,currency:o.a.KZT},vat:e.vat,urgent:e.urgent,documentId:e.number}}checkRecipientsRefresh(e){const t=e.paymentRecipient.recipientAccount;let i=this.recipients.isRecipientExist({companyId:this.company.currentId,iinOrBin:e.paymentRecipient.iinOrBin,name:e.paymentRecipient.name,kbe:e.paymentRecipient.kbe});return i&&this.recipients.isRecipientAccountExist(t.iban,i.id)||this.recipients.getRecipients("",!0),e}}return e.\u0275fac=function(t){return new(t||e)(b.ec(h.c),b.ec(v.c),b.ec(g.a),b.ec(k.a),b.ec(f.a),b.ec(s.a),b.ec(R.a),b.ec(P.q),b.ec(I.c),b.ec(D.a),b.ec(S.e),b.ec(A.b))},e.\u0275prov=b.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},D1y2:function(e,t,i){var n=i("FZoo");e.exports=function(e,t,i){return null==e?e:n(e,t,i)}},HghS:function(e,t,i){"use strict";i.d(t,"a",(function(){return k}));var n=i("3Pt+"),a=i("y5b2"),o=i("TwVa"),s=i("fXoL"),r=i("1kSV"),c=i("tyNb"),d=i("VnnJ"),u=i("mR7B"),l=i("sYmb");function m(e,t){1&e&&s.Sb(0)}function p(e,t){if(1&e&&(s.Wb(0,"h3",15),s.Rb(1,"j-money",16),s.Vb()),2&e){const e=s.mc();s.Ab(1),s.sc("money",e.money)}}function y(e,t){if(1&e&&(s.Wb(0,"h3",15),s.Rc(1),s.Vb()),2&e){const e=s.mc();s.Ab(1),s.Tc(" ",e.subtitle," ")}}function b(e,t){if(1&e&&(s.Wb(0,"p",17),s.Wb(1,"span"),s.Rc(2,"\u041a\u043e\u043c\u0438\u0441\u0441\u0438\u044f:"),s.Vb(),s.Rc(3,"\xa0"),s.Rb(4,"j-money",16),s.Vb()),2&e){const e=s.mc();s.Ab(4),s.sc("money",e.payment.details.commission)}}function h(e,t){if(1&e){const e=s.Xb();s.Wb(0,"div",11),s.Wb(1,"button",18),s.ic("click",(function(t){return s.Gc(e),s.mc().goToHistory()})),s.Rc(2,"\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u043b\u0430\u0442\u0435\u0436\u0430"),s.Vb(),s.Vb()}}function v(e,t){1&e&&(s.Rb(0,"img",19),s.nc(1,"translate")),2&e&&s.tc("alt",s.oc(1,1,"SHARED.DONE"))}function g(e,t){1&e&&(s.Rb(0,"img",20),s.nc(1,"translate")),2&e&&s.tc("alt",s.oc(1,1,"SHARED.ERROR"))}let k=(()=>{class e{constructor(e,t,i,a,s){this.modal=e,this.router=t,this.companyService=i,this.maskedService=a,this.translate=s,this.hasRights=!0,this.PAYMENT_TYPE=o.i,this.subscribe=new n.h(!1)}ngOnInit(){}get money(){var e;return(null===(e=this.payment)||void 0===e?void 0:e.type)==o.i.FOREIGN?this.payment.details.paymentAmount:{amount:Math.abs(this.maskedService.getNumberedAmount(this.amount)),currency:this.currency}}get subtitle(){let e="";return e=this.result?this.updateCreated?"PAYMENTS.PAYMENT_EDITED":this.hasRights?this.multySubscribers?this.companyService.isPrimaryAuthority()?"PAYMENTS.PAYMENT_SENT_FOR_SIGN":"PAYMENTS.PAYMENT_SIGNED":"PAYMENTS.PAYMENT_SIGNED_AND_SENT":"PAYMENTS.CREATED_FOR_SIGN":"SHARED.ERROR",this.translate.instant(e)}closeModal(e,t){t&&this.router.navigate(["/"]),this.modal.close({subscribe:this.subscribe.value,createNew:e})}goToHistory(){var e,t;if(this.result){let i="tenge";(null===(e=this.payment)||void 0===e?void 0:e.category)==o.g.FOREIGN?i="foreign":(null===(t=this.payment)||void 0===t?void 0:t.category)==o.g.CONVERSION&&(i="conversion"),this.router.navigate([`/history/${i}`],{queryParams:{paymentStatus:a.c.FOR_SIGN}})}this.modal.close()}}return e.\u0275fac=function(t){return new(t||e)(s.Qb(r.a),s.Qb(c.c),s.Qb(d.a),s.Qb(u.a),s.Qb(l.e))},e.\u0275cmp=s.Kb({type:e,selectors:[["j-payment-result"]],inputs:{result:"result",currency:"currency",amount:"amount",multySubscribers:"multySubscribers",hasRights:"hasRights",message:"message",payment:"payment",updateCreated:"updateCreated"},decls:20,vars:12,consts:[[1,"result-modal"],[1,"modal-header"],[1,"modal-body","result-body","pb-0"],[1,"text-center"],[1,"result-modal--label","mb-2"],[4,"ngIf","ngIfThen","ngIfElse"],["class","light mb-3 mt-2",4,"ngIf"],["class","text-muted mt-0 mb-1",4,"ngIf"],[1,"m-0","text-muted"],[1,"modal-body","result-body"],["class","form-group",4,"ngIf"],[1,"form-group"],[1,"btn","btn-block",3,"click"],["success",""],["failure",""],[1,"light","mb-3","mt-2"],[3,"money"],[1,"text-muted","mt-0","mb-1"],[1,"btn","btn-primary","btn-block",3,"click"],["src","./assets/img/history/modals/success.svg",3,"alt"],["src","./assets/img/history/modals/error.svg",3,"alt"]],template:function(e,t){if(1&e&&(s.Wb(0,"div",0),s.Rb(1,"div",1),s.Wb(2,"div",2),s.Wb(3,"div",3),s.Wb(4,"div",4),s.Pc(5,m,1,0,"ng-container",5),s.Vb(),s.Pc(6,p,2,1,"h3",6),s.Pc(7,y,2,1,"h3",6),s.Pc(8,b,5,1,"p",7),s.Wb(9,"p",8),s.Rc(10),s.Vb(),s.Vb(),s.Vb(),s.Wb(11,"div",9),s.Pc(12,h,3,0,"div",10),s.Wb(13,"div",11),s.Wb(14,"button",12),s.ic("click",(function(e){return t.closeModal(!1,!0)})),s.Rc(15,"\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"),s.Vb(),s.Vb(),s.Vb(),s.Vb(),s.Pc(16,v,2,3,"ng-template",null,13,s.Qc),s.Pc(18,g,2,3,"ng-template",null,14,s.Qc)),2&e){const e=s.Dc(17),i=s.Dc(19);s.Ab(5),s.sc("ngIf",t.result)("ngIfThen",e)("ngIfElse",i),s.Ab(1),s.sc("ngIf",t.result),s.Ab(1),s.sc("ngIf",!t.result),s.Ab(1),s.sc("ngIf",(null==t.payment?null:t.payment.type)==t.PAYMENT_TYPE.FOREIGN&&(null==t.payment?null:null==t.payment.details?null:t.payment.details.commission)),s.Ab(2),s.Sc(t.message||t.subtitle),s.Ab(2),s.sc("ngIf",t.result),s.Ab(2),s.Hb("btn-primary",!t.result)("btn-link",t.result)}},styles:["@-webkit-keyframes checkmark{0%{stroke-dashoffset:100px}to{stroke-dashoffset:200px}}@keyframes checkmark{0%{stroke-dashoffset:100px}to{stroke-dashoffset:0px}}@-webkit-keyframes checkmark-circle{0%{stroke-dashoffset:480px}to{stroke-dashoffset:960px}}@keyframes checkmark-circle{0%{stroke-dashoffset:480px}to{stroke-dashoffset:960px}}@-webkit-keyframes colored-circle{0%{opacity:0}to{opacity:1}}@keyframes colored-circle{0%{opacity:0}to{opacity:1}}.inlinesvg .svg svg{display:inline}.icon--order-success svg polyline{-webkit-animation:checkmark .25s ease-in-out .7s backwards;animation:checkmark .25s ease-in-out .7s backwards}.icon--order-success svg circle{-webkit-animation:checkmark-circle .6s ease-in-out backwards;animation:checkmark-circle .6s ease-in-out backwards}.icon--order-success svg circle#colored{-webkit-animation:colored-circle .6s ease-in-out .7s backwards;animation:colored-circle .6s ease-in-out .7s backwards}.result-body{padding:1.5rem}"],encapsulation:2}),e})()},"O/Ur":function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return y}));var n=i("mrSG"),a=i("tk/3"),o=i("YMfE"),s=i("+/Tu"),r=i("TwVa"),c=i("fXoL"),d=i("p6Hd"),u=i("VnnJ"),l=i("mR7B"),m=i("bHA9"),p=function(e){return e.RU="RU",e.US="US",e.CN="CN",e.AU="AU",e.AE="AE",e}({});let y=(()=>{class e{constructor(e,t,i,n){this.api=e,this.companyService=t,this.maskedService=i,this.dictionaries=n}getCountries(){return this.api.get("countries")}getContractById(e){return this.api.get(`companies/${this.companyService.currentId}/fx-contracts/${e}`)}getContracts(){return Object(n.a)(this,void 0,void 0,(function*(){return this.api.get(`companies/${this.companyService.currentId}/fx-contracts`)}))}getCodeWords(e){return Object(n.a)(this,void 0,void 0,(function*(){if(e&&this.cashedCodeWordsList&&e===this.cashedCodeWordsCountry)return this.cashedCodeWordsList;let t=new a.h;t=t.append("countryCode",e);const i=yield this.api.get("dictionaries/codewords",null,t);return this.cashedCodeWordsCountry=e,this.cashedCodeWordsList=i,this.cashedCodeWordsList}))}getBanks(e=null,t=null){return Object(n.a)(this,void 0,void 0,(function*(){if(e===this.cashedBankQuery&&t===this.cashedBankCountryCode)return this.cashedBankList;this.cashedBankQuery=e,this.cashedBankCountryCode=t;let i=new a.h;e&&(i=i.append("search",e)),t&&(i=i.append("countryCode",t));const n=yield this.api.get("dictionaries/banks",null,i);return this.cashedBankList=n,n}))}getKbkList(){return this.api.get("dictionaries/kbk")}getStatuses(){return this.api.get("dictionaries/payer-status")}mapForm(e){var t,i,n,a,c,d,u,l,m,y,b,h;let v={commission:{amount:e.comission,currency:e.comissionCurrency},description:e.purpose,documentId:e.number,foreignPaymentDetails:{commissionWithdrawalIban:null===(t=e.commissionAccount)||void 0===t?void 0:t.iban,intermediaryBankBic:null===(i=e.intermediaryBank)||void 0===i?void 0:i.bic,intermediaryBankName:null===(n=e.intermediaryBank)||void 0===n?void 0:n.name,type:e.payComission?"OUR":"SHA"},valueDate:e.date&&Object(o.ngbDateToUTCStartDay)(e.date).toISOString()||e.date,payerIban:null===(a=e.senderAccount)||void 0===a?void 0:a.iban,paymentAmount:{amount:this.maskedService.getNumberedAmount(e.amount),currency:null===(d=null===(c=e.senderAccount)||void 0===c?void 0:c.balance)||void 0===d?void 0:d.currency}};if(e.knp){let t="";t=e.knpObject?e.knpObject.code:e.knp;const i=this.dictionaries.KNPDictionary.getItemByKey(t,"code");v.knp={code:i.code,name:i.name}}e.kbk&&(v.kbk={code:e.kbk.code,name:e.kbk.description}),e.withinContract&&(v.foreignPaymentDetails.fxContractId=e.contractId,v.foreignPaymentDetails.contract=e.contract,v.foreignPaymentDetails.fxContractRecipient=e.fxContractRecipient,v.foreignPaymentDetails.fxContractRecipientId=e.fxContractRecipientId),e.codeWord&&(v.foreignPaymentDetails.codeWord=e.codeWord),e.isRubNonRussia&&(v.foreignPaymentDetails.intermediaryBankBic=e.rubNonRussiaCorrespondentBank.bic,v.foreignPaymentDetails.intermediaryBankIban=e.rubNonRussiaCorrespondentIban);let g=e.bank;e.isRubNonRussia&&(g=e.rubNonRussiaBank);const k=e.countryCode||(null===(u=e.country)||void 0===u?void 0:u.code)||(null===(m=null===(l=e.fxContractRecipient)||void 0===l?void 0:l.country)||void 0===m?void 0:m.code)||(null===(y=e.fxContractRecipient)||void 0===y?void 0:y.countryCode);let f={category:r.i.FOREIGN,companyId:this.companyService.currentId,details:v,emailOnSuccess:e.emailOnSuccess,paymentRecipient:{cityName:e.cityName,countryCode:k,kbe:{code:e.kbeCode},kpp:e.kpp,name:e.name,recipientAccount:{bankName:null===(b=g)||void 0===b?void 0:b.name,bic:null===(h=g)||void 0===h?void 0:h.bic,iban:e.bankAccount?this.removeSpaces(e.bankAccount):e.bankAccount}},type:r.i.FOREIGN};return k==p.AU&&(f.paymentRecipient.address=e.senderAccount.balance.currency===s.a.AUD?{index:e.audIndex,state:e.audState,street:e.audStreet,buildingNumber:e.audBuildingNumber}:{text:e.audAddress}),e.kio&&(f.paymentRecipient.iinOrBin=e.kio),e.kvo&&(v.foreignPaymentDetails.currencyTransactionCode=e.kvo),e.isRussianBudget&&(v.foreignPaymentDetails.oktmo=e.oktmo,v.foreignPaymentDetails.payerInn=e.payerInn,v.foreignPaymentDetails.payerKpp=e.payerKpp,v.foreignPaymentDetails.payerStatus=e.payerStatus,v.foreignPaymentDetails.paymentBasis=e.paymentBasis,v.foreignPaymentDetails.period=e.budgetPeriod,v.foreignPaymentDetails.uip=e.uip,v.foreignPaymentDetails.budgetDocNumber=e.budgetDocNumber),f}mapPayment(e){var t,i,n,a,s,c,d,u,l,m,p,y,b,h,v,g,k,f,R,P;return{type:r.i.FOREIGN,senderAccount:null,commissionAccount:null,comission:e.details.comission,payComission:"OUR"==e.details.foreignPaymentDetails.type,countryCode:(null===(t=e.paymentRecipient)||void 0===t?void 0:t.countryCode)||"",cityName:(null===(i=e.paymentRecipient)||void 0===i?void 0:i.cityName)||"",isNewPayment:e.isNewPayment||!1,contract:e.details.foreignPaymentDetails.fxContract,contractId:e.details.foreignPaymentDetails.fxContractId,fxContractRecipient:e.details.foreignPaymentDetails.fxContractRecipient,fxContractRecipientId:e.details.foreignPaymentDetails.fxContractRecipientId,withinContract:!!e.details.foreignPaymentDetails.fxContractId,name:(null===(n=e.paymentRecipient)||void 0===n?void 0:n.name)||"",bankAccount:(null===(a=e.paymentRecipient)||void 0===a?void 0:a.recipientAccount.iban)||"",kbeCode:(null===(c=null===(s=e.paymentRecipient)||void 0===s?void 0:s.kbe)||void 0===c?void 0:c.code)||"",number:e.details.documentId,date:e.details.valueDate&&Object(o.dateToNgbStruct)(new Date(e.details.valueDate)),knp:null===(d=e.details.knp)||void 0===d?void 0:d.code,purpose:e.details.description,amount:null===(u=e.details.paymentAmount)||void 0===u?void 0:u.amount,bankLabel:"",bank:null,hasIntermediaryBank:!!e.details.foreignPaymentDetails.intermediaryBankBic,intermediaryBankLabel:"",intermediaryBank:null,notify:!!e.emailOnSuccess,emailOnSuccess:e.emailOnSuccess,kpp:(null===(l=e.paymentRecipient)||void 0===l?void 0:l.kpp)||"",kvo:e.details.foreignPaymentDetails.currencyTransactionCode||"",kio:(null===(m=e.paymentRecipient)||void 0===m?void 0:m.iinOrBin)||"",isRussianBudget:null,isRussianTaxPayer:!(!e.details.foreignPaymentDetails.payerInn&&!e.details.foreignPaymentDetails.payerKpp),payerInn:e.details.foreignPaymentDetails.payerInn||"",payerKpp:e.details.foreignPaymentDetails.payerKpp||"",kbk:e.details.kbk?{code:e.details.kbk.code,description:e.details.kbk.name}:"",oktmo:e.details.foreignPaymentDetails.oktmo||"",payerStatus:e.details.foreignPaymentDetails.payerStatus||"",hasRussianBudgetExtras:!!(e.details.foreignPaymentDetails.paymentBasis||e.details.foreignPaymentDetails.budgetDocNumber||e.details.foreignPaymentDetails.period||e.details.foreignPaymentDetails.uip),paymentBasis:e.details.foreignPaymentDetails.paymentBasis||"",budgetDocNumber:e.details.foreignPaymentDetails.budgetDocNumber||"",budgetPeriod:e.details.foreignPaymentDetails.period||"",uip:e.details.foreignPaymentDetails.uip||"",codeWord:e.details.foreignPaymentDetails.codeWord,audIndex:(null===(y=null===(p=e.paymentRecipient)||void 0===p?void 0:p.address)||void 0===y?void 0:y.index)||"",audState:(null===(h=null===(b=e.paymentRecipient)||void 0===b?void 0:b.address)||void 0===h?void 0:h.state)||"",audStreet:(null===(g=null===(v=e.paymentRecipient)||void 0===v?void 0:v.address)||void 0===g?void 0:g.street)||"",audBuildingNumber:(null===(f=null===(k=e.paymentRecipient)||void 0===k?void 0:k.address)||void 0===f?void 0:f.buildingNumber)||"",audAddress:(null===(P=null===(R=e.paymentRecipient)||void 0===R?void 0:R.address)||void 0===P?void 0:P.text)||""}}removeSpaces(e){return e.replace(/ /g,"")}}return e.\u0275fac=function(t){return new(t||e)(c.ec(d.a),c.ec(u.a),c.ec(l.a),c.ec(m.a))},e.\u0275prov=c.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);