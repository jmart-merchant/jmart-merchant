"use strict";(self.webpackChunkjysan=self.webpackChunkjysan||[]).push([[464],{64464:($e,z,l)=>{l.r(z),l.d(z,{HistoryModule:()=>ke});var _=l(69808),P=l(93075),X=l(81538),_t=l(91995),Tt=l(48925),ft=l(65832),R=l(59516),t=l(5e3),vt=l(99430),yt=l(16831),Et=l(77337),Ct=l(194),bt=l(36290);let At=(()=>{class s{constructor(){}ngOnInit(){}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-history"]],decls:8,vars:0,consts:[[1,"row"],[1,"col-lg-10","offset-lg-1","col-xl-8","offset-xl-2"]],template:function(e,n){1&e&&(t.TgZ(0,"j-layout-home")(1,"j-aside"),t._UZ(2,"j-nav-main"),t.qZA(),t.TgZ(3,"j-main")(4,"section",0)(5,"section",1),t._UZ(6,"j-header")(7,"router-outlet"),t.qZA()()()())},directives:[vt.Y,yt.l,Et.F,Ct.C,bt.G,R.lC],styles:[""]}),s})();var p=l(70655),It=l(42654),Ot=l(36053),Rt=l(36787),Lt=l(61737),xt=l(72986),k=l(2994),Zt=l(87545),Ft=l(27221),Nt=l(40537),Ht=l(82524),W=l(43474),m=l(41359),f=l(1152),u=l(7102),tt=l(99255),Dt=l(80457),G=l(7667),y=l(40703),h=l(89854),b=l(69544);let M=(()=>{class s{constructor(e){this.modal=e}dismissModal(){this.modal.dismiss()}closeModal(){this.modal.close()}get failedText(){switch(this.failedCount%20){case 1:return"HISTORY.DELETE.FAILED.ONE";case 2:case 3:case 4:return"HISTORY.DELETE.FAILED.FEW";default:return"HISTORY.DELETE.FAILED.OTHER"}}get failedParams(){return{transactionsCount:this.failedCount}}get successText(){switch(this.successCount%10){case 1:return"HISTORY.DELETE.SUCCESS.ONE";case 2:case 3:case 4:return"HISTORY.DELETE.SUCCESS.FEW";default:return"HISTORY.DELETE.SUCCESS.OTHER"}}get successParams(){return{transactionsCount:this.successCount}}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-delete-partial"]],inputs:{failedCount:"failedCount",successCount:"successCount"},decls:17,vars:15,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body","text-center","pb-3"],["src","/assets/img/history/modals/partial.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"m-0","text-muted",3,"innerHTML"],[1,"mt-0","text-muted",3,"innerHTML"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.DELETE.PARTIAL"),t.qZA(),t._UZ(9,"p",6),t.ALo(10,"translate"),t._UZ(11,"p",7),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"div",8)(14,"button",9),t.NdJ("click",function(){return n.dismissModal()}),t._uU(15," HISTORY.BACK_TO_HISTORY "),t._UZ(16,"span",10),t.qZA()()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,5,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,7,"HISTORY.DELETE.PARTIAL")),t.xp6(4),t.Q6J("innerHTML",t.xi3(10,9,n.successText,n.successParams),t.oJD),t.xp6(2),t.Q6J("innerHTML",t.xi3(12,12,n.failedText,n.failedParams),t.oJD),t.xp6(5),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"))},directives:[h.Pi,b.d$],pipes:[h.X$],styles:[""]}),s})(),et=(()=>{class s extends M{constructor(e){super(e),this.modal=e}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-delete-error"]],features:[t.qOj],decls:17,vars:11,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","px-4","pt-0","pb-4","text-center"],["src","/assets/img/history/modals/error.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"m-0","text-muted",3,"innerHTML"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-primary","btn-block","mb-3",3,"click"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.DELETE.FAILED.TITLE"),t.qZA(),t._UZ(9,"p",6),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"button",8),t.NdJ("click",function(){return n.closeModal()}),t._uU(13," SHARED.TRY_AGAIN "),t.qZA(),t.TgZ(14,"button",9),t.NdJ("click",function(){return n.dismissModal()}),t._uU(15," HISTORY.BACK_TO_HISTORY "),t._UZ(16,"span",10),t.qZA()()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,4,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,6,"HISTORY.DELETE.FAILED.TITLE")),t.xp6(4),t.Q6J("innerHTML",t.xi3(10,8,n.failedText,n.failedParams),t.oJD),t.xp6(7),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"))},directives:[h.Pi,b.d$],pipes:[h.X$],styles:[""]}),s})(),nt=(()=>{class s extends M{constructor(e){super(e),this.modal=e}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-delete-success"]],features:[t.qOj],decls:15,vars:11,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body","text-center","pb-4"],["src","/assets/img/history/modals/success.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"m-0","text-muted",3,"innerHTML"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.DELETE.SUCCESS.TITLE"),t.qZA(),t._UZ(9,"p",6),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"button",8),t.NdJ("click",function(){return n.dismissModal()}),t._uU(13," HISTORY.BACK_TO_HISTORY "),t._UZ(14,"span",9),t.qZA()()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,4,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,6,"HISTORY.DELETE.SUCCESS.TITLE")),t.xp6(4),t.Q6J("innerHTML",t.xi3(10,8,n.successText,n.successParams),t.oJD),t.xp6(5),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"))},directives:[h.Pi,b.d$],pipes:[h.X$],styles:[""]}),s})();function Pt(s,r){1&s&&(t.TgZ(0,"span"),t._uU(1,", "),t.qZA())}function Mt(s,r){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.YNc(2,Pt,2,0,"span",12),t.qZA()),2&s){const e=r.$implicit,n=r.index,i=t.oxw().$implicit,o=t.oxw();let a;t.xp6(1),t.hij(" ",e,""),t.xp6(1),t.Q6J("ngIf",n<(null==(a=o.retrieveErrors(i))?null:a.length)-1)}}function Yt(s,r){if(1&s&&(t.TgZ(0,"div")(1,"strong"),t._uU(2),t.qZA(),t.YNc(3,Mt,3,2,"span",11),t.qZA()),2&s){const e=r.$implicit,n=t.oxw();t.xp6(2),t.hij("\u2116",e.documentNumber,": "),t.xp6(1),t.Q6J("ngForOf",n.retrieveErrors(e))}}let it=(()=>{class s{constructor(e){this.modal=e}dismissModal(){this.modal.dismiss()}closeModal(){this.modal.close()}retrieveErrors(e){let n;return n=e.errorData?Object.entries(e.errorData).map(o=>o[1]):e.errorMsg?[e.errorMsg]:[],n}get failedText(){switch(this.signResult&&this.signResult.numberOfFailed%20){case 1:return"HISTORY.PARTIAL.FAILED.ONE";case 2:case 3:case 4:return"HISTORY.PARTIAL.FAILED.FEW";default:return"HISTORY.PARTIAL.FAILED.OTHER"}}get failedParams(){return{transactionsCount:this.signResult&&this.signResult.numberOfFailed}}get failedTransactions(){var e;return null===(e=this.signResult)||void 0===e?void 0:e.results}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-multiple-sign-partial-error"]],inputs:{signResult:"signResult"},decls:17,vars:12,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body","text-center","pb-3"],["src","/assets/img/history/modals/error.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"mt-0","text-muted",3,"innerHTML"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"],[1,"modal-footer","bg-main","p-4","d-block","justify-content-start"],["translate","HISTORY.PARTIAL.SUBTITLE"],[4,"ngFor","ngForOf"],[4,"ngIf"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.FAILED.TITLE"),t.qZA(),t._UZ(9,"p",6),t.ALo(10,"translate"),t.TgZ(11,"button",7),t.NdJ("click",function(){return n.dismissModal()}),t._uU(12," HISTORY.BACK_TO_HISTORY "),t._UZ(13,"span",8),t.qZA()(),t.TgZ(14,"div",9),t._UZ(15,"h5",10),t.YNc(16,Yt,4,2,"div",11),t.qZA()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,5,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,7,"HISTORY.FAILED.TITLE")),t.xp6(4),t.Q6J("innerHTML",t.xi3(10,9,n.failedText,n.failedParams),t.oJD),t.xp6(4),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"),t.xp6(3),t.Q6J("ngForOf",n.failedTransactions))},directives:[h.Pi,b.d$,_.sg,_.O5],pipes:[h.X$],styles:[""]}),s})();var Y=l(72159);function Ut(s,r){if(1&s&&(t.TgZ(0,"div",16),t._uU(1),t.ALo(2,"lowercase"),t.ALo(3,"translate"),t.TgZ(4,"strong"),t._UZ(5,"j-money",17),t.qZA()()),2&s){const e=r.$implicit,n=t.oxw();t.xp6(1),t.AsE(" ",e.count," ",t.lcZ(2,3,t.lcZ(3,5,n.mapCountLabel(e.count)))," \u2013 "),t.xp6(4),t.Q6J("money",e.money)}}function kt(s,r){1&s&&(t.TgZ(0,"span"),t._uU(1,", "),t.qZA())}function Gt(s,r){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.YNc(2,kt,2,0,"span",18),t.qZA()),2&s){const e=r.$implicit,n=r.index,i=t.oxw().$implicit,o=t.oxw();let a;t.xp6(1),t.hij(" ",e,""),t.xp6(1),t.Q6J("ngIf",n<(null==(a=o.retrieveErrors(i))?null:a.length)-1)}}function $t(s,r){if(1&s&&(t.TgZ(0,"div")(1,"strong"),t._uU(2),t.qZA(),t.YNc(3,Gt,3,2,"span",15),t.qZA()),2&s){const e=r.$implicit,n=t.oxw();t.xp6(2),t.hij("\u2116",e.documentNumber,": "),t.xp6(1),t.Q6J("ngForOf",n.retrieveErrors(e))}}let st=(()=>{class s{constructor(e){this.modal=e}ngOnInit(){this.generateGroups()}dismissModal(){this.modal.dismiss()}closeModal(){this.modal.close()}retrieveErrors(e){let n;return n=e.errorData?Object.entries(e.errorData).map(o=>o[1]):e.errorMsg?[e.errorMsg]:[],n}get successText(){switch(this.result&&this.result.numberOfSuccess%10){case 1:return"HISTORY.PARTIAL.SUCCESS.ONE";case 2:case 3:case 4:return"HISTORY.PARTIAL.SUCCESS.FEW";default:return"HISTORY.PARTIAL.SUCCESS.OTHER"}}get totalBalance(){return this.result&&this.result.totalBalance}get successCount(){return this.result&&this.result.numberOfSuccess}get totalCount(){return this.result&&this.result.results.length}get successParams(){return{transactionsCount:this.successCount}}get failedText(){switch(this.result&&this.result.numberOfFailed%10){case 1:return"HISTORY.PARTIAL.FAILED.ONE";case 2:case 3:case 4:return"HISTORY.PARTIAL.FAILED.FEW";default:return"HISTORY.PARTIAL.FAILED.OTHER"}}get failedParams(){return{transactionsCount:this.result&&this.result.numberOfFailed}}get failedTransactions(){return this.result&&this.result.results&&this.result.results.filter(e=>e.status===f.Y.FAILED)}mapCountLabel(e){switch(e%20){case 1:return"HISTORY.OPERATION.ONE";case 2:case 3:case 4:return"HISTORY.OPERATION.FEW";default:return"HISTORY.OPERATION.OTHER"}}generateGroups(){let e={};this.result.results.forEach(n=>{const i=n.result.amount;e[i.currency]?(e[i.currency].money.amount+=i.amount,e[i.currency].count++):e[i.currency]={money:{currency:i.currency,amount:i.amount},count:1}}),this.groups=Object.values(e)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-multiple-sign-partial-success"]],inputs:{result:"result"},decls:26,vars:19,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body","text-center","pb-3"],["src","/assets/img/history/modals/partial.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"m-0","text-muted"],["translate",""],["class","result-group",4,"ngFor","ngForOf"],[1,"m-0","text-muted",3,"innerHTML"],[1,"mt-0","text-muted",3,"innerHTML"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"],[1,"modal-footer","bg-main","p-4","d-block","justify-content-start"],["translate","HISTORY.PARTIAL.SUBTITLE"],[4,"ngFor","ngForOf"],[1,"result-group"],[3,"money"],[4,"ngIf"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.PARTIAL.TITLE"),t.qZA(),t.TgZ(9,"p",6)(10,"span",7),t._uU(11,"HISTORY.OPERATION.FEW"),t.qZA(),t._uU(12,": "),t.TgZ(13,"strong"),t._uU(14),t.qZA()(),t.YNc(15,Ut,6,7,"div",8),t._UZ(16,"p",9),t.ALo(17,"translate"),t._UZ(18,"p",10),t.ALo(19,"translate"),t.TgZ(20,"button",11),t.NdJ("click",function(){return n.dismissModal()}),t._uU(21," HISTORY.BACK_TO_HISTORY "),t._UZ(22,"span",12),t.qZA()(),t.TgZ(23,"div",13),t._UZ(24,"h4",14),t.YNc(25,$t,4,2,"div",15),t.qZA()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,9,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,11,"HISTORY.PARTIAL.TITLE")),t.xp6(9),t.AsE("",n.successCount,"/",n.totalCount,""),t.xp6(1),t.Q6J("ngForOf",n.groups),t.xp6(1),t.Q6J("innerHTML",t.xi3(17,13,n.successText,n.successParams),t.oJD),t.xp6(2),t.Q6J("innerHTML",t.xi3(19,16,n.failedText,n.failedParams),t.oJD),t.xp6(4),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"),t.xp6(3),t.Q6J("ngForOf",n.failedTransactions))},directives:[h.Pi,_.sg,Y.y,b.d$,_.O5],pipes:[h.X$,_.i8],styles:[""]}),s})();function Jt(s,r){if(1&s&&(t.TgZ(0,"p",13),t._uU(1),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorText," ")}}let ot=(()=>{class s{constructor(e){this.modal=e}dismissModal(){this.modal.dismiss()}closeModal(){this.modal.close()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-multiple-sign-error"]],inputs:{errorText:"errorText"},decls:19,vars:8,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","px-4","pt-0","pb-4","text-center"],["src","/assets/img/history/modals/error.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"m-0","text-muted"],["translate",""],["class","mt-3 mb-0 text-danger",4,"ngIf"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-primary","btn-block","mb-3",3,"click"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"],[1,"mt-3","mb-0","text-danger"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.FAILED.TITLE"),t.qZA(),t.TgZ(9,"p",6)(10,"span",7),t._uU(11,"HISTORY.FAILED.DESCRIPTION"),t.qZA()(),t.YNc(12,Jt,2,1,"p",8),t.qZA(),t.TgZ(13,"div",9)(14,"button",10),t.NdJ("click",function(){return n.closeModal()}),t._uU(15," SHARED.TRY_AGAIN "),t.qZA(),t.TgZ(16,"button",11),t.NdJ("click",function(){return n.dismissModal()}),t._uU(17," HISTORY.BACK_TO_HISTORY "),t._UZ(18,"span",12),t.qZA()()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,4,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,6,"HISTORY.FAILED.TITLE")),t.xp6(7),t.Q6J("ngIf",n.errorText),t.xp6(6),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"))},directives:[h.Pi,_.O5,b.d$],pipes:[h.X$],styles:[""]}),s})();function jt(s,r){if(1&s&&(t.TgZ(0,"div",10),t._uU(1),t.ALo(2,"lowercase"),t.ALo(3,"translate"),t.TgZ(4,"strong"),t._UZ(5,"j-money",11),t.qZA()()),2&s){const e=r.$implicit,n=t.oxw();t.xp6(1),t.AsE(" ",e.count," ",t.lcZ(2,3,t.lcZ(3,5,n.mapCountLabel(e.count)))," \u2013 "),t.xp6(4),t.Q6J("money",e.money)}}let rt=(()=>{class s{constructor(e){this.modal=e}ngOnInit(){this.generateGroups()}dismissModal(){this.modal.dismiss()}closeModal(){this.modal.close()}mapCountLabel(e){switch(e%20){case 1:return"HISTORY.OPERATION.ONE";case 2:case 3:case 4:return"HISTORY.OPERATION.FEW";default:return"HISTORY.OPERATION.OTHER"}}generateGroups(){let e={};this.result.results.forEach(n=>{const i=n.result.amount;e[i.currency]?(e[i.currency].money.amount+=i.amount,e[i.currency].count++):e[i.currency]={money:{currency:i.currency,amount:i.amount},count:1}}),this.groups=Object.values(e)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-multiple-sign-success"]],inputs:{result:"result"},decls:14,vars:8,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body","text-center","pb-4"],["src","/assets/img/history/modals/success.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],["class","result-group",4,"ngFor","ngForOf"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"],[1,"result-group"],[3,"money"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.SIGNED"),t.qZA(),t.YNc(9,jt,6,7,"div",6),t.qZA(),t.TgZ(10,"div",7)(11,"button",8),t.NdJ("click",function(){return n.dismissModal()}),t._uU(12," HISTORY.BACK_TO_HISTORY "),t._UZ(13,"span",9),t.qZA()()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,4,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,6,"HISTORY.SIGNED")),t.xp6(4),t.Q6J("ngForOf",n.groups),t.xp6(4),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"))},directives:[h.Pi,_.sg,Y.y,b.d$],pipes:[h.X$,_.i8],styles:[""]}),s})();function wt(s,r){1&s&&(t.TgZ(0,"span"),t._uU(1,", "),t.qZA())}function Bt(s,r){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.YNc(2,wt,2,0,"span",13),t.qZA()),2&s){const e=r.$implicit,n=r.index,i=t.oxw().$implicit,o=t.oxw();let a;t.xp6(1),t.hij(" ",e,""),t.xp6(1),t.Q6J("ngIf",n<(null==(a=o.retrieveErrors(i))?null:a.length)-1)}}function Qt(s,r){if(1&s&&(t.TgZ(0,"div")(1,"strong"),t._uU(2),t.qZA(),t.YNc(3,Bt,3,2,"span",12),t.qZA()),2&s){const e=r.$implicit,n=t.oxw();t.xp6(2),t.hij("\u2116",e.documentNumber,": "),t.xp6(1),t.Q6J("ngForOf",n.retrieveErrors(e))}}let L=(()=>{class s{constructor(e){this.modal=e}dismissModal(){this.modal.dismiss()}closeModal(){this.modal.close()}retrieveErrors(e){let n;return n=e.errorData?Object.entries(e.errorData).map(o=>o[1]):e.errorMsg?[e.errorMsg]:[],n}get failedCount(){var e;return(null===(e=this.signResult)||void 0===e?void 0:e.numberOfFailed)||0}get successCount(){var e;return(null===(e=this.signResult)||void 0===e?void 0:e.numberOfSuccess)||0}get failedText(){switch(this.failedCount%20){case 1:return"HISTORY.SEND_TO_SIGNED.FAILED.ONE";case 2:case 3:case 4:return"HISTORY.SEND_TO_SIGNED.FAILED.FEW";default:return"HISTORY.SEND_TO_SIGNED.FAILED.OTHER"}}get failedParams(){return{transactionsCount:this.failedCount}}get failedTransactions(){return this.signResult&&this.signResult.results&&this.signResult.results.filter(e=>e.status===f.Y.FAILED)}get successText(){switch(this.successCount%10){case 1:return"HISTORY.SEND_TO_SIGNED.SUCCESS.ONE";case 2:case 3:case 4:return"HISTORY.SEND_TO_SIGNED.SUCCESS.FEW";default:return"HISTORY.SEND_TO_SIGNED.SUCCESS.OTHER"}}get successParams(){return{transactionsCount:this.successCount}}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-send-to-signed-partial"]],inputs:{signResult:"signResult"},decls:19,vars:16,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body","text-center","pb-3"],["src","/assets/img/history/modals/partial.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"m-0","text-muted",3,"innerHTML"],[1,"mt-0","text-muted",3,"innerHTML"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"],[1,"modal-footer","bg-main","p-4","d-block","justify-content-start"],["translate","HISTORY.PARTIAL.SUBTITLE"],[4,"ngFor","ngForOf"],[4,"ngIf"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.SEND_TO_SIGNED.PARTIAL"),t.qZA(),t._UZ(9,"p",6),t.ALo(10,"translate"),t._UZ(11,"p",7),t.ALo(12,"translate"),t.TgZ(13,"button",8),t.NdJ("click",function(){return n.dismissModal()}),t._uU(14," HISTORY.BACK_TO_HISTORY "),t._UZ(15,"span",9),t.qZA()(),t.TgZ(16,"div",10),t._UZ(17,"h4",11),t.YNc(18,Qt,4,2,"div",12),t.qZA()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,6,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,8,"HISTORY.SEND_TO_SIGNED.PARTIAL")),t.xp6(4),t.Q6J("innerHTML",t.xi3(10,10,n.successText,n.successParams),t.oJD),t.xp6(2),t.Q6J("innerHTML",t.xi3(12,13,n.failedText,n.failedParams),t.oJD),t.xp6(4),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"),t.xp6(3),t.Q6J("ngForOf",n.failedTransactions))},directives:[h.Pi,b.d$,_.sg,_.O5],pipes:[h.X$],styles:[""]}),s})(),at=(()=>{class s extends L{constructor(e){super(e),this.modal=e}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-send-to-signed-success"]],features:[t.qOj],decls:15,vars:11,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body","text-center","pb-4"],["src","/assets/img/history/modals/success.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"m-0","text-muted",3,"innerHTML"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.SEND_TO_SIGNED.SUCCESS.TITLE"),t.qZA(),t._UZ(9,"p",6),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"button",8),t.NdJ("click",function(){return n.dismissModal()}),t._uU(13," HISTORY.BACK_TO_HISTORY "),t._UZ(14,"span",9),t.qZA()()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,4,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,6,"HISTORY.SEND_TO_SIGNED.SUCCESS.TITLE")),t.xp6(4),t.Q6J("innerHTML",t.xi3(10,8,n.successText,n.successParams),t.oJD),t.xp6(5),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"))},directives:[h.Pi,b.d$],pipes:[h.X$],styles:[""]}),s})(),lt=(()=>{class s extends L{constructor(e){super(e),this.modal=e}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-send-to-signed-error"]],features:[t.qOj],decls:17,vars:11,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","px-4","pt-0","pb-4","text-center"],["src","/assets/img/history/modals/error.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"m-0","text-muted",3,"innerHTML"],[1,"modal-footer","py-4","px-3","justify-content-center"],["translate","","type","button",1,"btn","btn-primary","btn-block","mb-3",3,"click"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.SEND_TO_SIGNED.FAILED.TITLE"),t.qZA(),t._UZ(9,"p",6),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"button",8),t.NdJ("click",function(){return n.closeModal()}),t._uU(13," SHARED.TRY_AGAIN "),t.qZA(),t.TgZ(14,"button",9),t.NdJ("click",function(){return n.dismissModal()}),t._uU(15," HISTORY.BACK_TO_HISTORY "),t._UZ(16,"span",10),t.qZA()()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,4,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,6,"HISTORY.SEND_TO_SIGNED.FAILED.TITLE")),t.xp6(4),t.Q6J("innerHTML",t.xi3(10,8,n.failedText,n.failedParams),t.oJD),t.xp6(7),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"))},directives:[h.Pi,b.d$],pipes:[h.X$],styles:[""]}),s})();function Vt(s,r){1&s&&(t.TgZ(0,"span"),t._uU(1,", "),t.qZA())}function qt(s,r){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.YNc(2,Vt,2,0,"span",12),t.qZA()),2&s){const e=r.$implicit,n=r.index,i=t.oxw().$implicit,o=t.oxw();let a;t.xp6(1),t.hij(" ",e,""),t.xp6(1),t.Q6J("ngIf",n<(null==(a=o.retrieveErrors(i))?null:a.length)-1)}}function Kt(s,r){if(1&s&&(t.TgZ(0,"div")(1,"strong"),t._uU(2),t.qZA(),t.YNc(3,qt,3,2,"span",11),t.qZA()),2&s){const e=r.$implicit,n=t.oxw();t.xp6(2),t.hij("\u2116",e.documentNumber,": "),t.xp6(1),t.Q6J("ngForOf",n.retrieveErrors(e))}}let ct=(()=>{class s extends L{constructor(e){super(e),this.modal=e}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-send-to-signed-partial-error"]],features:[t.qOj],decls:17,vars:12,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body","text-center","pb-3"],["src","/assets/img/history/modals/error.svg",3,"alt"],["translate","",1,"light","mb-3","mt-2"],[1,"mt-0","text-muted",3,"innerHTML"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"],[1,"modal-footer","bg-main","p-4","d-block","justify-content-start"],["translate","HISTORY.PARTIAL.SUBTITLE"],[4,"ngFor","ngForOf"],[4,"ngIf"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"img",4),t.ALo(6,"translate"),t.TgZ(7,"h3",5),t._uU(8,"HISTORY.FAILED.TITLE"),t.qZA(),t._UZ(9,"p",6),t.ALo(10,"translate"),t.TgZ(11,"button",7),t.NdJ("click",function(){return n.dismissModal()}),t._uU(12," HISTORY.BACK_TO_HISTORY "),t._UZ(13,"span",8),t.qZA()(),t.TgZ(14,"div",9),t._UZ(15,"h5",10),t.YNc(16,Kt,4,2,"div",11),t.qZA()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,5,"SHARED.CLOSE")),t.xp6(3),t.s9C("alt",t.lcZ(6,7,"HISTORY.FAILED.TITLE")),t.xp6(4),t.Q6J("innerHTML",t.xi3(10,9,n.failedText,n.failedParams),t.oJD),t.xp6(4),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"),t.xp6(3),t.Q6J("ngForOf",n.failedTransactions))},directives:[h.Pi,b.d$,_.sg,_.O5],pipes:[h.X$],styles:[""]}),s})();function zt(s,r){1&s&&(t._UZ(0,"img",14),t.ALo(1,"translate")),2&s&&t.s9C("alt",t.lcZ(1,1,"HISTORY.VALIDATION.ERROR"))}function Xt(s,r){1&s&&(t._UZ(0,"img",15),t.ALo(1,"translate")),2&s&&t.s9C("alt",t.lcZ(1,1,"HISTORY.VALIDATION.ERROR"))}function Wt(s,r){if(1&s&&(t.TgZ(0,"p",16)(1,"span",17),t._uU(2,"HISTORY.OPERATION.FEW"),t.qZA(),t._uU(3,": "),t.TgZ(4,"strong"),t._uU(5),t.qZA()()),2&s){const e=t.oxw();t.xp6(5),t.AsE("",e.successCount,"/",e.totalCount,"")}}function te(s,r){if(1&s&&(t.TgZ(0,"div",18),t._uU(1),t.ALo(2,"lowercase"),t.ALo(3,"translate"),t.TgZ(4,"strong"),t._UZ(5,"j-money",19),t.qZA()()),2&s){const e=r.$implicit,n=t.oxw();t.xp6(1),t.AsE(" ",e.count," ",t.lcZ(2,3,t.lcZ(3,5,n.mapCountLabel(e.count)))," \u2013 "),t.xp6(4),t.Q6J("money",e.money)}}function ee(s,r){1&s&&(t.TgZ(0,"span"),t._uU(1,", "),t.qZA())}function ne(s,r){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.YNc(2,ee,2,0,"span",20),t.qZA()),2&s){const e=r.$implicit,n=r.index,i=t.oxw().$implicit,o=t.oxw();let a;t.xp6(1),t.hij(" ",e,""),t.xp6(1),t.Q6J("ngIf",n<(null==(a=o.retrieveErrors(i.errorData))?null:a.length)-1)}}function ie(s,r){if(1&s&&(t.TgZ(0,"div")(1,"strong"),t._uU(2),t.qZA(),t.YNc(3,ne,3,2,"span",13),t.qZA()),2&s){const e=r.$implicit,n=t.oxw();t.xp6(2),t.hij("\u2116",e.documentNumber,": "),t.xp6(1),t.Q6J("ngForOf",n.retrieveErrors(e.errorData))}}let ut=(()=>{class s{constructor(e){this.modal=e}ngOnInit(){this.generateGroups()}dismissModal(){this.modal.dismiss()}closeModal(){this.modal.close()}retrieveErrors(e){return Object.entries(e).map(o=>o[1])}get totalBalance(){return this.result&&this.result.totalBalance}get successCount(){return this.result&&this.result.numberOfSuccess}get totalCount(){return this.result&&this.result.results.length}get successParams(){return{transactionsCount:this.successCount}}get failedText(){if(!this.result)return"HISTORY.VALIDATION.ERROR";switch(this.result&&this.result.numberOfFailed%10){case 1:return"HISTORY.VALIDATION.ONE";case 2:case 3:case 4:return"HISTORY.VALIDATION.FEW";default:return"HISTORY.VALIDATION.OTHER"}}get failedParams(){return{transactionsCount:this.result&&this.result.numberOfFailed}}get failedTransactions(){return this.result&&this.result.results&&this.result.results.filter(e=>e.status===f.Y.FAILED)}mapCountLabel(e){return e%20==1?"HISTORY.OPERATION.ONE":"HISTORY.OPERATION.OTHER"}generateGroups(){let e={};this.result.results.forEach(n=>{var i;const o=null===(i=n.result)||void 0===i?void 0:i.amount;!o||(e[o.currency]?(e[o.currency].money.amount+=o.amount,e[o.currency].count++):e[o.currency]={money:{currency:o.currency,amount:o.amount},count:1})}),this.groups=Object.values(e)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(y.Kz))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-validation-error"]],inputs:{result:"result"},decls:17,vars:13,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","/assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body","text-center","pb-3"],["src","/assets/img/history/modals/partial.svg",3,"alt",4,"ngIf"],["src","/assets/img/history/modals/error.svg",3,"alt",4,"ngIf"],["class","m-0 text-muted",4,"ngIf"],["class","result-group",4,"ngFor","ngForOf"],[1,"mt-0","text-muted",3,"innerHTML"],["translate","","type","button",1,"btn","btn-static","btn-link","m-0",3,"click"],[3,"inlineSVG"],[1,"modal-footer","bg-main","p-4","d-block","justify-content-start"],["translate","HISTORY.PARTIAL.SUBTITLE"],[4,"ngFor","ngForOf"],["src","/assets/img/history/modals/partial.svg",3,"alt"],["src","/assets/img/history/modals/error.svg",3,"alt"],[1,"m-0","text-muted"],["translate",""],[1,"result-group"],[3,"money"],[4,"ngIf"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return n.dismissModal()}),t._UZ(2,"img",2),t.ALo(3,"translate"),t.qZA()(),t.TgZ(4,"div",3),t.YNc(5,zt,2,3,"img",4),t.YNc(6,Xt,2,3,"img",5),t.YNc(7,Wt,6,2,"p",6),t.YNc(8,te,6,7,"div",7),t._UZ(9,"p",8),t.ALo(10,"translate"),t.TgZ(11,"button",9),t.NdJ("click",function(){return n.dismissModal()}),t._uU(12," HISTORY.BACK_TO_HISTORY "),t._UZ(13,"span",10),t.qZA()(),t.TgZ(14,"div",11),t._UZ(15,"h4",12),t.YNc(16,ie,4,2,"div",13),t.qZA()),2&e&&(t.xp6(2),t.s9C("alt",t.lcZ(3,8,"SHARED.CLOSE")),t.xp6(3),t.Q6J("ngIf",n.successCount>0),t.xp6(1),t.Q6J("ngIf",0===n.successCount),t.xp6(1),t.Q6J("ngIf",n.totalCount&&n.successCount),t.xp6(1),t.Q6J("ngForOf",n.groups),t.xp6(1),t.Q6J("innerHTML",t.xi3(10,10,n.failedText,n.failedParams),t.oJD),t.xp6(4),t.Q6J("inlineSVG","/assets/icons/shared/arrow-right.svg"),t.xp6(3),t.Q6J("ngForOf",n.failedTransactions))},directives:[_.O5,h.Pi,_.sg,Y.y,b.d$],pipes:[h.X$,_.i8],styles:[""]}),s})();var v=l(40520),$=l(1790),dt=l(19204),mt=l(8491),J=l(15057),se=l(21086),oe=l(24850),re=l(78232),pt=l(26164),ae=l(67515),ht=l(26484),le=l(19208);let ce=(()=>{class s{constructor(e,n,i,o,a,d,c,g){this.statementService=e,this.companyService=n,this.api=i,this.translateService=o,this.filterService=a,this.maskedService=d,this.curSymbolPipe=c,this.featureFlagsService=g}getTransactionGroup(e=u.nK.DOMESTIC,n,i=1,o=50){if(this.cashedCategory===e&&this.cashedTransactionGroup&&this.cashedFilter===n&&this.cashedPageNumber===i&&this.cashedPageSize===o)return(0,se.of)(this.cashedTransactionGroup);const a=this.cashedFilter===n&&i>this.cashedPageNumber;return this.getHistoryListObservable(e,n,i,o).pipe((0,oe.U)(d=>{this.cashedCategory=e,this.cashedFilter=n,this.cashedPageNumber=i,this.cashedPageSize=o;const g=this.mapHistoryPayments(d.body);let S=a?this.cashedTransactionGroup.transactions.concat(g):g;return n.paymentStatus===m.$9.FOR_SIGN&&(S=S.sort(this.compareBySignature),S=S.sort(this.compareByDate)),n.paymentStatus===m.$9.FAILED&&this.markFailedAsRead(),this.cashedTransactionGroup={title:this.generateGroupTitle(n.paymentStatus),creditSum:null,debitSum:this.getTotalAmount(S),hasLargeTransactions:this.statementService.checkListForLargeTransactions(S),transactionsCount:S.length,transactions:S},this.cashedTransactionGroup}))}getHistoryList(e,n,i=1,o=50){return(0,p.mG)(this,void 0,void 0,function*(){const a=`companies/${this.companyService.currentId}/payments`,d=new v.WM;let c=new v.LE;return c=this.appendCategoryParams(e,c),c=c.append("page",`${i}`),c=c.append("pageSize",`${o}`),c=this.appendFilterParams(n,c),this.api.get(a,d,c,{observe:"response"})})}getHistoryListObservable(e,n,i=1,o=50){const a=`/companies/${this.companyService.currentId}/payments`,d=new v.WM;let c=new v.LE;return c=this.appendCategoryParams(e,c),c=c.append("page",`${i}`),c=c.append("pageSize",`${o}`),c=this.appendFilterParams(n,c),this.api.getObservable(a,d,c,{observe:"response"})}sendMultipleTransactionsForSign(e){const n=`companies/${this.companyService.currentId}/payments:to-created`;let i=new v.LE;return e.forEach(o=>{i=i.append("paymentId",o)}),this.api.patch(n,null,null,i)}validateTransactionsByPaymentId(e,n){return(0,p.mG)(this,void 0,void 0,function*(){const i=`companies/${e}/payments/signatures/validate`;let o=new v.LE;n.forEach(d=>{o=o.append("paymentId",d)});const a=(new v.WM).append("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");return this.api.post(i,o,a)})}signMultipleTransactions(e,n,i){return(0,p.mG)(this,void 0,void 0,function*(){const o=`companies/${e}/payments/signatures`;let a=new v.WM;return a=a.set(n.type===tt.K.OTP?$.ob.OTP:$.ob.PHONE,n.signature),this.api.post(o,{itemIds:i},a)})}deleteTransaction(e,n){return(0,p.mG)(this,void 0,void 0,function*(){const i=`companies/${e}/payments`,o=new v.WM;let a=(new v.LE).set("id",n.id);return this.api.delete(i,o,a)})}revokePayment(e,n){return(0,p.mG)(this,void 0,void 0,function*(){return this.api.patch(`companies/${e}/payments/${n.paymentId}:to-revoked`)})}deleteMultipleTransactions(e,n){return(0,p.mG)(this,void 0,void 0,function*(){const i=`companies/${e}/payments`,o=new v.WM;let a=new v.LE;return n.forEach(d=>{a=a.append("id",d.id)}),this.api.delete(i,o,a)})}isRemovable(e){return e.status.code===u.R$.CREATED||e.status.code===u.R$.DRAFT}isEditable(e){return!(e.type===u.V_.CONVERSION&&e.status.code!==u.R$.CREATED||e.status.code!==u.R$.DRAFT&&e.status.code!==u.R$.CREATED)}isRevokable(e){return e.status.code===u.R$.READY_TO_SEND}getSignsCountText(e){return`${e.signatures&&e.signatures.length||0}/${this.companyService.isMultipleSignScheme(e.signatureScheme)?2:1}`}appendCategoryParams(e,n){return n=e===u.nK.ALL?(n=(n=n.append("category",u.nK.DOMESTIC)).append("category",u.nK.FOREIGN)).append("category",u.nK.CONVERSION):n.append("category",e)}appendFilterParams(e,n){switch(n=this.appendStatusToParams(e.paymentStatus,n),e.documentNumber&&(n=n.append("documentNumber",e.documentNumber)),e.periodFrom&&(n=n.append("dateFrom",(0,mt.convertDateToApiFormat)(e.periodFrom))),e.periodTo&&(n=n.append("dateTo",(0,mt.convertDateToApiFormat)(e.periodTo))),e.amountFrom&&(n=n.append("amountFrom",`${e.amountFrom}`)),e.amountTo&&(n=n.append("amountTo",`${e.amountTo}`)),e.recipientIban&&(n=n.append("correspondentAccount",e.recipientIban)),e.recipientBin&&(n=n.append("correspondentBin",e.recipientBin)),e.type&&(n=n.append("type",e.type)),e.sortBy){case m.d0.AMOUNT_ASC:n=n.append("sortBy","AMOUNT");break;case m.d0.AMOUNT_DESC:n=n.append("sortBy","-AMOUNT")}return n}appendStatusToParams(e,n){switch(e){case m.$9.ALL:n=(n=(n=(n=(n=(n=(n=(n=n.append("status",u.R$.DRAFT)).append("status",u.R$.CREATED)).append("status",u.R$.REJECTED)).append("status",u.R$.BANK_COMPLETED)).append("status",u.R$.BANK_PROCESSING)).append("status",u.R$.BANK_SENT)).append("status",u.R$.READY_TO_SEND)).append("status",u.R$.IN_BANK);break;case m.$9.DRAFT:n=n.append("status",u.R$.DRAFT);break;case m.$9.FOR_SIGN:n=n.append("status",u.R$.CREATED);break;case m.$9.FAILED:n=n.append("status",u.R$.REJECTED);break;case m.$9.SUCCESS:n=n.append("status",u.R$.BANK_COMPLETED);break;case m.$9.IN_PROGRESS:n=(n=(n=(n=n.append("status",u.R$.BANK_PROCESSING)).append("status",u.R$.BANK_SENT)).append("status",u.R$.READY_TO_SEND)).append("status",u.R$.IN_BANK)}return n}compareByDate(e,n){return e.paymentStatus.timestamp<n.paymentStatus.timestamp?1:e.paymentStatus.timestamp>n.paymentStatus.timestamp?-1:0}updateForSignCount(e=null,n){return(0,p.mG)(this,void 0,void 0,function*(){this.filterService.updateForSignCount(null),e||(e=(yield this.retrivePaymentsByStatus(m.$9.FOR_SIGN,n)).payments);let i=0,o=0;null==e||e.forEach(a=>{var d;this.companyService.isSignable(a.status.code,a.signatureScheme,this.companyService.currentAuthority.authority,null===(d=a.signatures)||void 0===d?void 0:d.length)?i++:o++}),0==i&&0==o?this.filterService.updateForSignCount(0):i>0?this.filterService.updateForSignCount(i,!0):this.filterService.updateForSignCount(o)})}retrivePaymentsByStatus(e,n){return(0,p.mG)(this,void 0,void 0,function*(){let i=0,o=null;const a=`companies/${this.companyService.currentId}/payments`,d=new v.WM;let c=new v.LE;c=this.appendStatusToParams(e,c),c=this.appendCategoryParams(n,c),c=c.append("pageSize","100000");try{const g=yield this.api.get(a,d,c,{observe:"response"});o=g.body,i=+g.headers.get("X-Total-Count")}catch(g){}finally{return{payments:o,count:i}}})}updateStatusCounts(e){this.updateForSignCount(null,e),this.updateCountsByBadges(e)}isSignable(e){var n;const i=this.companyService.isSignable(e.status.code,e.signatureScheme,this.companyService.currentAuthority.authority,null===(n=e.signatures)||void 0===n?void 0:n.length);return e.status.code===u.R$.DRAFT?i&&this.isCorrectlyFullfilled(e):i}isSignableByOthers(e){var n;return this.companyService.isSignableByOthers(e.status.code,e.signatureScheme,this.companyService.currentAuthority.authority,null===(n=e.signatures)||void 0===n?void 0:n.length)}isSendableForSign(e){const n=this.isSignableByOthers(e),i=this.companyService.isSendableForSign(e.status.code,e.signatureScheme,this.companyService.currentAuthority.authority);return!n&&i}isCorrectlyFullfilled(e){return!0}markFailedAsRead(){return(0,p.mG)(this,void 0,void 0,function*(){const e=`companies/${this.companyService.currentId}/payments/badges:mark-read-rejected`;try{yield this.api.put(e)}catch(n){}finally{this.filterService.updateFailedCount(0)}})}updateCountsByBadges(e){return(0,p.mG)(this,void 0,void 0,function*(){this.filterService.updateInProgressCount(null),this.filterService.updateFailedCount(null);let n=0,i=0;const o=`companies/${this.companyService.currentId}/payments/badges`;let a=new v.LE;a=this.appendCategoryParams(e,a);try{(yield this.api.get(o,null,a)).forEach(c=>{switch(c.statusCode){case u.R$.READY_TO_SEND:case u.R$.IN_BANK:case u.R$.BANK_PROCESSING:case u.R$.BANK_SENT:n+=c.count;break;case u.R$.REJECTED:i+=c.count}})}catch(d){}finally{this.filterService.updateInProgressCount(n),this.filterService.updateFailedCount(i)}})}getTotalAmount(e){let n=0,i=null;return e.forEach(o=>{o.balance&&(o.balance.currency&&!i&&(i=o.balance.currency),n+=o.balance.amount)}),{currency:i,amount:n}}mapDescription(e){var n,i,o,a,d,c,g;if(e.type===u.V_.CONVERSION){const S=this.maskedService.getMaskedAmount(null===(n=e.details.exchangeRate)||void 0===n?void 0:n.calculatedSum),A=this.curSymbolPipe.transform(null===(i=e.details.exchangeRate)||void 0===i?void 0:i.currencyTo);let E;return E=S&&A?this.translateService.instant("CONVERSION.DESCRIPTION",{money:`${S} ${A}`,iban:e.paymentRecipient.recipientAccount.iban}):(null===(o=e.details)||void 0===o?void 0:o.description)||null,E?`${E} ${(null===(a=e.details.conversionPurpose)||void 0===a?void 0:a.description)||""}`:(null===(d=e.details.conversionPurpose)||void 0===d?void 0:d.description)?`${null===(c=e.details.conversionPurpose)||void 0===c?void 0:c.description}`:null}return(null===(g=e.details)||void 0===g?void 0:g.description)||null}mapHistoryPayments(e){return e.map((n,i)=>{var o,a,d,c,g,S,A,E,x,Z,F,N,H,D,C,O,I,j,w,B,Q,V,q,K;const Ge={id:n.id||null,iban:(null===(o=n.details)||void 0===o?void 0:o.payerIban)||null,reference:n.id||null,documentNumber:(null===(a=n.details)||void 0===a?void 0:a.documentId)||null,correspondentBankBic:(null===(c=null===(d=n.paymentRecipient)||void 0===d?void 0:d.recipientAccount)||void 0===c?void 0:c.bic)||null,correspondentAccount:(null===(S=null===(g=n.paymentRecipient)||void 0===g?void 0:g.recipientAccount)||void 0===S?void 0:S.iban)||null,correspondentName:(null===(A=n.paymentRecipient)||void 0===A?void 0:A.name)||null,kbe:(null===(E=n.paymentRecipient)||void 0===E?void 0:E.kbe)||null,correspondentBin:(null===(x=n.paymentRecipient)||void 0===x?void 0:x.iinOrBin)||null,debit:(null===(Z=n.details)||void 0===Z?void 0:Z.paymentAmount)||null,credit:null,description:this.mapDescription(n),documentDate:(null===(F=n.details)||void 0===F?void 0:F.issueDate)||null,valueDate:(null===(N=n.details)||void 0===N?void 0:N.valueDate)||null,knp:(null===(H=n.details)||void 0===H?void 0:H.knp)||null,kbk:(null===(D=n.details)||void 0===D?void 0:D.kbk)||null,signHead:null,signBuch:null,isPayment:!0,paymentId:n.id,paymentStatus:n.status||null,paymentType:n.type||null,paymentEmployees:n.paymentEmployees,createDate:(null===(C=n.details)||void 0===C?void 0:C.createDate)||null,foreignPaymentDetails:n.details.foreignPaymentDetails||null,foreignRecipient:{country:null===(O=n.paymentRecipient)||void 0===O?void 0:O.country,countryCode:null===(I=n.paymentRecipient)||void 0===I?void 0:I.countryCode,cityName:null===(j=n.paymentRecipient)||void 0===j?void 0:j.cityName,bic:null===(B=null===(w=n.paymentRecipient)||void 0===w?void 0:w.recipientAccount)||void 0===B?void 0:B.bic,bankName:null===(V=null===(Q=n.paymentRecipient)||void 0===Q?void 0:Q.recipientAccount)||void 0===V?void 0:V.bankName},emailOnSuccess:n.emailOnSuccess||null,signatureScheme:n.signatureScheme||null,signatures:n.signatures||[]},T=new dt.YW(Ge,this.translateService);return this.isFeatureDisabled(n.type)?(T.isExportable=!1,T.isRepeatable=!1,T.isEditable=!1,T.isRemovable=!1,T.isSignable=!1,T.isSendableForSign=!1,T.isRevokable=!1):(T.isExportable=this.isExportable(n),T.isRepeatable=this.isRepeatable(n),T.isEditable=this.isEditable(n),T.isRemovable=this.isRemovable(n),T.isSignable=this.isSignable(n),T.isSendableForSign=this.isSendableForSign(n),T.isRevokable=this.isRevokable(n)),T.associatedField=null===(K=null===(q=n.details)||void 0===q?void 0:q.associatedField)||void 0===K?void 0:K.parameters,T.isSignableByOthers=this.isSignableByOthers(n),T.signsCountText=this.getSignsCountText(T),T})}isFeatureDisabled(e){const n=e==u.V_.CONVERSION&&this.featureFlagsService.isDisabled(J.Y.CONVERSION),i=e==u.V_.FOREIGN&&this.featureFlagsService.isDisabled(J.Y.FOREIGN_PAYMENT);return n||i||!1}isRepeatable(e){return!(e.status.state==u.jC.MIGRATED&&e.category===u.nK.CONVERSION||e.status.code==u.R$.DRAFT)}isExportable(e){return!(e.status.state===u.jC.MIGRATED&&e.category===u.nK.CONVERSION||e.status.code===u.R$.CREATED)}generateGroupTitle(e){switch(e){case m.$9.ALL:return"HISTORY.LISTS.ALL";case m.$9.FOR_SIGN:return"HISTORY.LISTS.FOR_SIGN";case m.$9.FOR_SIGN_OTHERS:return"HISTORY.LISTS.FOR_SIGN_OTHERS";case m.$9.SUCCESS:return"HISTORY.LISTS.SUCCESS";case m.$9.FAILED:return"HISTORY.LISTS.FAILED";case m.$9.IN_PROGRESS:return"HISTORY.LISTS.IN_PROGRESS";case m.$9.DRAFT:return"HISTORY.LISTS.DRAFT"}}compareBySignature(e,n){return e.isSignable&&n.isSignable?0:e.isSignable&&n.isSignableByOthers?-1:1}}return s.\u0275fac=function(e){return new(e||s)(t.LFG(re.A),t.LFG(pt.J),t.LFG($.sM),t.LFG(h.sK),t.LFG(ae.i),t.LFG(ht.O),t.LFG(le.M),t.LFG(J.a))},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var ue=l(17687),de=l(66013),me=l(36336),pe=l(37784),he=l(16345);function ge(s,r){if(1&s&&(t.TgZ(0,"a",10),t._uU(1),t.qZA()),2&s){const e=r.$implicit;t.Q6J("routerLink",e.url),t.xp6(1),t.Oqu(e.label)}}function Se(s,r){1&s&&(t.TgZ(0,"div",11),t._UZ(1,"j-statement-loading"),t.qZA())}function _e(s,r){if(1&s&&(t.TgZ(0,"div",25)(1,"div")(2,"span",26),t._uU(3,"HISTORY.OPERATION.OTHER"),t.qZA(),t._uU(4,": "),t.TgZ(5,"strong"),t._uU(6),t.qZA()(),t.TgZ(7,"div")(8,"span",26),t._uU(9,"HISTORY.FOR_AMOUNT"),t.qZA(),t._uU(10,": "),t.TgZ(11,"strong"),t._UZ(12,"j-money",27),t.qZA()()()),2&s){const e=t.oxw(3);t.xp6(6),t.hij(" ",e.totalCount," "),t.xp6(6),t.Q6J("money",e.totalBalance)}}function Te(s,r){if(1&s&&(t.TgZ(0,"div",25)(1,"strong"),t._UZ(2,"j-money",27),t.qZA(),t._uU(3),t.qZA()),2&s){const e=r.$implicit;t.xp6(2),t.Q6J("money",e.balance),t.xp6(1),t.hij(" (",e.count,") ")}}function fe(s,r){if(1&s&&t.YNc(0,Te,4,2,"div",28),2&s){const e=t.oxw(3);t.Q6J("ngForOf",e.currencies)}}function ve(s,r){if(1&s&&(t.TgZ(0,"div",25)(1,"strong"),t._UZ(2,"j-money",27),t.qZA(),t._uU(3),t.qZA()),2&s){const e=r.$implicit;t.xp6(2),t.Q6J("money",e.balance),t.xp6(1),t.hij(" (",e.count,") ")}}function ye(s,r){if(1&s&&(t.YNc(0,ve,4,2,"div",28),t.TgZ(1,"div",29),t._uU(2,"+ "),t.qZA()),2&s){t.oxw();const e=t.MAs(10),n=t.oxw(2);t.Q6J("ngForOf",n.currencies.splice(0,4)),t.xp6(1),t.Q6J("ngbTooltip",e)}}function Ee(s,r){if(1&s&&(t.TgZ(0,"div")(1,"strong"),t._UZ(2,"j-money",27),t.qZA(),t._uU(3),t.qZA()),2&s){const e=r.$implicit;t.xp6(2),t.Q6J("money",e.balance),t.xp6(1),t.hij(" (",e.count,") ")}}function Ce(s,r){if(1&s&&t.YNc(0,Ee,4,2,"div",30),2&s){const e=t.oxw(3);t.Q6J("ngForOf",e.currencies.splice(3,e.currencies.length))}}function be(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"a",32),t.NdJ("click",function(i){return t.CHM(e),t.oxw(4).exportSelectedTransactions(i)}),t.ALo(1,"translate"),t.qZA()}2&s&&t.Q6J("ngbTooltip",t.lcZ(1,2,"HISTORY.DOWNLOAD_SELECTED"))("inlineSVG","/assets/icons/transaction/pdf.svg")}function Ae(s,r){if(1&s&&(t.ynx(0),t.YNc(1,be,2,4,"a",31),t.BQk()),2&s){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",e.isSelectableForExport&&e.selectedCount>0)}}function Ie(s,r){if(1&s){const e=t.EpF();t.ynx(0),t.TgZ(1,"a",33),t.NdJ("click",function(i){return t.CHM(e),t.oxw(4).signAll(i)}),t.TgZ(2,"span",34),t._uU(3,"HISTORY.SIGN_ALL"),t.qZA(),t._UZ(4,"span",35),t.qZA(),t.BQk()}2&s&&(t.xp6(4),t.Q6J("inlineSVG","/assets/icons/transaction/sign.svg"))}function Oe(s,r){if(1&s){const e=t.EpF();t.ynx(0),t.TgZ(1,"a",33),t.NdJ("click",function(i){return t.CHM(e),t.oxw(4).sendAllForSign(i)}),t.TgZ(2,"span",34),t._uU(3,"HISTORY.SEND_ALL_FOR_SIGN"),t.qZA(),t._UZ(4,"span",35),t.qZA(),t.BQk()}2&s&&(t.xp6(4),t.Q6J("inlineSVG","/assets/icons/transaction/for-sign.svg"))}function Re(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"a",37),t.NdJ("click",function(i){return t.CHM(e),t.oxw(5).signSelected(i)}),t.ALo(1,"translate"),t.qZA()}2&s&&t.Q6J("ngbTooltip",t.lcZ(1,2,"HISTORY.SIGN_SELECTED"))("inlineSVG","/assets/icons/transaction/sign.svg")}function Le(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"a",37),t.NdJ("click",function(i){return t.CHM(e),t.oxw(5).sendForSignSelected(i)}),t.ALo(1,"translate"),t.qZA()}2&s&&t.Q6J("ngbTooltip",t.lcZ(1,2,"HISTORY.SEND_FOR_SIGN_SELECTED"))("inlineSVG","/assets/icons/transaction/for-sign.svg")}function xe(s,r){if(1&s){const e=t.EpF();t.ynx(0),t.TgZ(1,"a",32),t.NdJ("click",function(i){return t.CHM(e),t.oxw(4).deleteSelectedTransactions(i)}),t.ALo(2,"translate"),t.qZA(),t.YNc(3,Re,2,4,"a",36),t.YNc(4,Le,2,4,"a",36),t.BQk()}if(2&s){const e=t.oxw(4);t.xp6(1),t.Q6J("ngbTooltip",t.lcZ(2,4,"HISTORY.DELETE_SELECTED"))("inlineSVG","/assets/icons/transaction/delete.svg"),t.xp6(2),t.Q6J("ngIf",e.isSignable),t.xp6(1),t.Q6J("ngIf",e.isSendableForSign)}}function Ze(s,r){if(1&s&&(t.ynx(0),t.YNc(1,Ie,5,1,"ng-container",24),t.YNc(2,Oe,5,1,"ng-container",24),t.YNc(3,xe,5,6,"ng-container",24),t.BQk()),2&s){const e=t.oxw(3);t.xp6(1),t.Q6J("ngIf",0==e.selectedCount&&e.isAllSignable),t.xp6(1),t.Q6J("ngIf",0==e.selectedCount&&e.isAllSendableForSign),t.xp6(1),t.Q6J("ngIf",e.selectedCount>0)}}function Fe(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div",16)(1,"div",17),t.NdJ("click",function(i){return i.stopPropagation()}),t.TgZ(2,"input",18),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw(2).isAllSelected=i})("click",function(i){return i.stopPropagation()})("change",function(){return t.CHM(e),t.oxw(2).selectAll()}),t.qZA(),t.TgZ(3,"label",19),t._uU(4,"HISTORY.SELECT_ALL"),t.qZA()(),t.TgZ(5,"div",20),t.YNc(6,_e,13,2,"ng-template",21),t.YNc(7,fe,1,1,"ng-template",21),t.YNc(8,ye,3,2,"ng-template",21),t.YNc(9,Ce,1,1,"ng-template",null,22,t.W1O),t.TgZ(11,"div",23),t.YNc(12,Ae,2,1,"ng-container",24),t.YNc(13,Ze,4,3,"ng-container",24),t.qZA()()()}if(2&s){const e=t.oxw(2);t.xp6(2),t.Q6J("ngModel",e.isAllSelected),t.xp6(4),t.Q6J("ngIf",!e.currencies||(null==e.currencies?null:e.currencies.length)<=1),t.xp6(1),t.Q6J("ngIf",(null==e.currencies?null:e.currencies.length)>1&&(null==e.currencies?null:e.currencies.length)<=3),t.xp6(1),t.Q6J("ngIf",(null==e.currencies?null:e.currencies.length)>3),t.xp6(4),t.Q6J("ngIf",e.isSelectableForExport),t.xp6(1),t.Q6J("ngIf",e.isSelectable)}}function Ne(s,r){1&s&&(t.TgZ(0,"div",38),t._uU(1," ACCOUNTS.STATEMENT.ALL_LOADED "),t.qZA())}function He(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div",12),t.YNc(1,Fe,14,6,"div",13),t.TgZ(2,"j-statement",14),t.NdJ("signed",function(i){return t.CHM(e),t.oxw().onSign(i)})("sentForSign",function(i){return t.CHM(e),t.oxw().onSentForSign(i)})("deleted",function(i){return t.CHM(e),t.oxw().onDelete(i)})("revoked",function(i){return t.CHM(e),t.oxw().onRevoke(i)})("selected",function(){return t.CHM(e),t.oxw().onSelect()}),t.qZA(),t.YNc(3,Ne,2,0,"div",15),t.qZA()}if(2&s){const e=t.oxw();t.ekj("list-statement--scrollable",e.hasMorePages),t.xp6(1),t.Q6J("ngIf",e.totalCount&&(e.isSelectable||e.isSelectableForExport)),t.xp6(1),t.Q6J("statement",e.statement)("isTotalsShown",!1)("hasExtraPadding",!0)("isSelectable",e.isSelectable||e.isSelectableForExport),t.xp6(1),t.Q6J("ngIf",!e.hasMorePages&&(null==e.statement?null:e.statement.totalTransactionsCount)>0)}}let U=(()=>{class s{constructor(e,n,i,o,a,d,c,g,S,A,E){this.company=e,this.filterService=n,this.historyService=i,this.route=o,this.router=a,this.datePipe=d,this.modalService=c,this.filesService=g,this.maskedService=S,this.statementService=A,this.notifierService=E,this.filterScheme={periodTo:null,periodFrom:null},this.filterCurrency=Dt.w.KZT,this.filterMode=W.e5.HISTORY,this.modalConfigSmall={backdropClass:"backdrop_light",windowClass:"modal_light modal_sm",backdrop:"static",centered:!0},this.modalConfigMedium={backdropClass:"backdrop_light",windowClass:"modal_light modal_md",backdrop:"static",centered:!0},this.historyTypes=[{label:"HISTORY.ALL",url:"/history/all"},{label:"HISTORY.TENGE_PAYMENTS",url:"/history/tenge"},{label:"HISTORY.CURRENCY_PAYMENTS",url:"/history/foreign"},{label:"HISTORY.CONVERSION",url:"/history/conversion"}],this.subscription=new It.w,this.pageNumber=1,this.pageSize=25,this.pageSizeForSign=1e5,this.hasMorePages=!0,this.isLoading=!0,this.isLoadingExtra=!0,this.isReady=!1,this.hasSignableSelected=!1,this.isAllSelected=!1,this.selectedTransactions=[],this.selectedCount=0,this.SESSION_ROUTE_KEY="historyRouteQuery",this.cashedRouteQuery=JSON.parse(sessionStorage.getItem(this.SESSION_ROUTE_KEY)),this.canBeNavigatedToForSign=!0;const x=(0,Ot.aj)([this.route.queryParams,this.route.data]).pipe((0,xt.q)(1)).subscribe(([C,O])=>{Object.keys(C).length>0&&(this.canBeNavigatedToForSign=!1),this.paymentCategory=O.category,this.cashedRouteQuery&&!C&&(C=this.cashedRouteQuery),this.updateCashedRouteQuery(C);const I=this.mapQueryParams(C);this.filterScheme=I,this.filterService.updateExtra(this.filterScheme)});this.subscription.add(x);const Z=this.company.refresh$.pipe((0,k.b)(()=>this.historyService.updateStatusCounts(this.paymentCategory))),F=this.filterService.getScheme(),N=(0,Rt.T)(F,Z).pipe((0,Zt.w)(C=>this.init(Array.isArray(C)?this.filterScheme:C))).subscribe(()=>{}),H=this.filesService.onImport().subscribe(()=>{this.init(this.filterScheme).toPromise(),this.historyService.updateStatusCounts(this.paymentCategory)}),D=this.filterService.getStatuses().subscribe(C=>{const O=C.find(I=>I.value==m.$9.FOR_SIGN);if(O.count>0&&O.classList.includes("badge-primary")&&this.canBeNavigatedToForSign){this.canBeNavigatedToForSign=!1;const I=Object.assign(this.filterScheme,{paymentStatus:m.$9.FOR_SIGN});this.filterService.updateExtra(I)}});this.subscription.add(N),this.subscription.add(H),this.subscription.add(D)}init(e=this.filterService.getDefaults(this.filterMode)){return this.filterScheme=Object.assign({},e),this.pageNumber=1,this.hasMorePages=!1,this.isLoading=!0,this.updateQueryParams(),this.loadStatement().pipe((0,k.b)(()=>this.updateSelectable()))}ngOnDestroy(){this.subscription.unsubscribe()}onScroll(){this.hasMorePages&&(this.pageNumber++,this.loadStatement().toPromise())}validateTransactionsByPaymentId(e){return(0,p.mG)(this,void 0,void 0,function*(){try{const n=yield this.historyService.validateTransactionsByPaymentId(this.company.currentId,e);return n.status!==f.Y.SUCCESS&&this.showValidationError(n),n.status}catch(n){return this.showValidationError(n),f.Y.FAILED}})}onSign(e){return(0,p.mG)(this,void 0,void 0,function*(){const n={transactionIds:[e.id],totalBalance:e.balance,transactionsCount:1};try{if(e.paymentStatus.code===u.R$.DRAFT&&(yield this.validateTransactionsByPaymentId(n.transactionIds))===f.Y.FAILED)return;yield this.showSignModal(n),this.historyService.updateForSignCount(null,this.paymentCategory)}catch(i){}})}onSentForSign(e){return(0,p.mG)(this,void 0,void 0,function*(){this.sendToSigned([e])})}onSelect(){this.updateSelectable()}selectAll(){this.currentTransactions.forEach(e=>{e.isSelected=this.isAllSelected}),this.updateSelectable(),this.isAllSelected=!0}selectSignable(){this.currentTransactions.forEach(e=>{e.isSelected=!!e.isSignable&&this.hasSignableSelected}),this.updateSelectable(),this.hasSignableSelected=!0}get isAllSignable(){return this.currentTransactions.length>0&&(this.filterScheme.paymentStatus===m.$9.FOR_SIGN||this.filterScheme.paymentStatus===m.$9.DRAFT)&&this.hasSignableInList(this.currentTransactions)}get isAllSendableForSign(){return!this.isAllSignable&&this.currentTransactions.length>0&&this.filterScheme.paymentStatus===m.$9.DRAFT&&this.hasSendableForSignInList(this.currentTransactions)}get isSignable(){return this.currentTransactions&&(this.filterScheme.paymentStatus===m.$9.FOR_SIGN||this.filterScheme.paymentStatus===m.$9.DRAFT)&&this.isAllSignableInList(this.selectedTransactions)}get isSendableForSign(){return!this.isSignable&&this.currentTransactions&&this.filterScheme.paymentStatus===m.$9.DRAFT&&this.isAllSendableForSignInList(this.selectedTransactions)}get isSelectable(){return this.currentTransactions&&(this.filterScheme.paymentStatus===m.$9.FOR_SIGN||this.filterScheme.paymentStatus===m.$9.DRAFT)}get isSelectableForExport(){return this.filterScheme.paymentStatus===m.$9.SUCCESS||this.filterScheme.paymentStatus===m.$9.FAILED||this.filterScheme.paymentStatus===m.$9.IN_PROGRESS||this.filterScheme.paymentStatus===m.$9.DRAFT}get isAllSelectableForExport(){return this.filterScheme.paymentStatus===m.$9.IN_PROGRESS}get totalBalance(){return this.selectedCount>0?this.selectedBalance:this.countTotalBalanceFromTransactionsList(this.currentTransactions)}get totalCount(){return this.selectedCount>0?this.selectedCount:this.currentTransactionsCount}get currentTransactionsCount(){var e;return(null===(e=this.statement)||void 0===e?void 0:e.totalTransactionsCount)||0}get currentTransactions(){var e,n;const i=null===(n=null===(e=this.statement)||void 0===e?void 0:e.transactionGroups)||void 0===n?void 0:n.map(o=>o.transactions);return(null==i?void 0:i.flat())||[]}get hasAnySelected(){return this.selectedCount>0}get currencies(){const e={};return(this.selectedCount>0?this.selectedTransactions:this.currentTransactions).forEach(i=>{var o,a,d,c,g,S,A,E;(null===(o=i.balance)||void 0===o?void 0:o.currency)&&(e[null===(a=i.balance)||void 0===a?void 0:a.currency]?(e[null===(d=i.balance)||void 0===d?void 0:d.currency].count++,e[null===(c=i.balance)||void 0===c?void 0:c.currency].balance.amount+=null===(g=i.balance)||void 0===g?void 0:g.amount):e[null===(S=i.balance)||void 0===S?void 0:S.currency]={count:1,balance:{amount:null===(A=i.balance)||void 0===A?void 0:A.amount,currency:null===(E=i.balance)||void 0===E?void 0:E.currency}})}),Object.values(e)}signAll(e){return(0,p.mG)(this,void 0,void 0,function*(){e.preventDefault();const n={paymentStatus:this.filterScheme.paymentStatus},a=(yield this.historyService.getHistoryList(this.paymentCategory,n,1,this.pageSizeForSign)).body.filter(c=>this.historyService.isSignable(c)),d={transactionIds:this.retrieveIdsFromList(a),totalBalance:this.countTotalBalanceFromPaymentsList(a),transactionsCount:a.length};this.filterScheme.paymentStatus===m.$9.DRAFT&&(yield this.validateTransactionsByPaymentId(d.transactionIds))===f.Y.FAILED||this.showSignModal(d)})}sendAllForSign(e){return(0,p.mG)(this,void 0,void 0,function*(){e.preventDefault();const n={paymentStatus:m.$9.DRAFT},a=(yield this.historyService.getHistoryList(this.paymentCategory,n,1,this.pageSizeForSign)).body.filter(d=>this.historyService.isSendableForSign(d));this.sendToSigned(a)})}signSelected(e){return(0,p.mG)(this,void 0,void 0,function*(){e.preventDefault();const n={transactionIds:this.retrieveIdsFromList(this.selectedTransactions),totalBalance:this.countTotalBalanceFromTransactionsList(this.selectedTransactions),transactionsCount:this.selectedTransactions.length};this.filterScheme.paymentStatus===m.$9.DRAFT&&(yield this.validateTransactionsByPaymentId(n.transactionIds))!==f.Y.SUCCESS||this.showSignModal(n)})}sendForSignSelected(e){return(0,p.mG)(this,void 0,void 0,function*(){e.preventDefault(),this.sendToSigned(this.selectedTransactions)})}deleteSelectedTransactions(e=null){return(0,p.mG)(this,void 0,void 0,function*(){e&&e.preventDefault(),this.deleteTransactions(this.selectedTransactions)})}exportSelectedTransactions(e=null){return(0,p.mG)(this,void 0,void 0,function*(){e&&e.preventDefault();const n=yield this.statementService.exportTransactions(this.selectedTransactions);this.filesService.downloadFile(n,`${this.selectedCount}_operations.pdf`)})}onDelete(e){return(0,p.mG)(this,void 0,void 0,function*(){yield this.deleteTransactions([e])})}onRevoke(e){return(0,p.mG)(this,void 0,void 0,function*(){e.isLoading=!0;try{yield this.historyService.revokePayment(this.company.currentId,e),yield this.init(this.filterScheme).toPromise()}catch(n){this.notifierService.notify("error",n.description||n.code)}finally{this.historyService.updateForSignCount(null,this.paymentCategory),this.historyService.updateStatusCounts(this.paymentCategory),this.resetSelectable(),this.updateSelectable()}})}deleteTransactions(e){return(0,p.mG)(this,void 0,void 0,function*(){e.forEach(n=>{n.isLoading=!0});try{const n=yield this.historyService.deleteMultipleTransactions(this.company.currentId,e);yield this.init(this.filterScheme).toPromise();const i=n.length,o=e.length-i;0===i?this.showDeleteError(e):0===o?this.showDeleteSuccess(i):this.showDeletePartial(i,o)}catch(n){this.showDeleteError(e)}finally{this.historyService.updateForSignCount(null,this.paymentCategory),this.resetSelectable(),this.updateSelectable()}})}sendToSigned(e){return(0,p.mG)(this,void 0,void 0,function*(){try{const n=yield this.historyService.sendMultipleTransactionsForSign(e.map(i=>i.id));switch(n.status){case f.Y.SUCCESS:this.showSendToSignedSuccess(n),yield this.init(this.filterScheme).toPromise();break;case f.Y.PARTLY_SUCCESS:this.showSendToSignedPartial(n),yield this.init(this.filterScheme).toPromise();break;case f.Y.FAILED:this.showSendToSignedPartialError(n)}}catch(n){console.error(n),this.showSendToSignedError(e)}finally{this.resetSelectable(),this.updateSelectable(),this.historyService.updateForSignCount(null,this.paymentCategory)}})}showSignModal(e){return(0,p.mG)(this,void 0,void 0,function*(){const n=this.modalService.open(G.uB,this.modalConfigMedium);Object.assign(n.componentInstance,{additionalParams:{actionIds:e.transactionIds}}),Object.assign(n.componentInstance,{headerParams:{smsHeader:Ht.H$.SIGNING_PAYMENT}}),n.componentInstance.submitted.subscribe(i=>{this.signMultipleTransactions(i,e).then(()=>{localStorage.setItem("preferredSignatureType",i.type===tt.K.OTP?G.a$.OTP:G.a$.SMS)}).catch(o=>{this.showMultipleSignError(o.description||o.code,e)}).finally(()=>{this.historyService.updateForSignCount(null,this.paymentCategory),n.close()})}),n.componentInstance.sentForRevision.subscribe(()=>{this.init(this.filterScheme).toPromise(),n.close()})})}signMultipleTransactions(e,n){return(0,p.mG)(this,void 0,void 0,function*(){try{const i=yield this.historyService.signMultipleTransactions(this.company.currentId,e,n.transactionIds);switch(i.status){case f.Y.SUCCESS:this.showMultipleSignSuccess(i),yield this.init(this.filterScheme).toPromise();break;case f.Y.PARTLY_SUCCESS:this.showMultipleSignPartialSuccess(i),yield this.init(this.filterScheme).toPromise();break;case f.Y.FAILED:this.showMultipleSignPartialError(i)}}catch(i){this.showMultipleSignError(i,n)}finally{this.updateSelectable(),this.historyService.updateForSignCount(null,this.paymentCategory)}})}loadStatement(){return this.isLoadingExtra=!0,1===this.pageNumber&&(this.statement=null),this.historyService.getTransactionGroup(this.paymentCategory,this.filterScheme,this.pageNumber,this.filterScheme.paymentStatus===m.$9.FOR_SIGN?this.pageSizeForSign:this.pageSize).pipe((0,k.b)(e=>{this.hasMorePages=this.pageSize*this.pageNumber<=e.transactionsCount,this.statement={totalTransactionsCount:e.transactionsCount,transactionGroups:this.filterScheme.paymentStatus===m.$9.FOR_SIGN?this.destructureForSignGroups(e):[e]}}),(0,Ft.K)(e=>(console.log(e),this.statement=null,(0,Lt._)(e))),(0,Nt.x)(()=>{this.isReady=!0,this.isLoading=!1,this.isLoadingExtra=!1}))}destructureForSignGroups(e){const n=e.transactions.filter(d=>d.isSignable),i=e.transactions.filter(d=>d.isSignableByOthers);return[{title:this.historyService.generateGroupTitle(m.$9.FOR_SIGN),creditSum:null,debitSum:this.historyService.getTotalAmount(n),hasLargeTransactions:this.statementService.checkListForLargeTransactions(n),transactionsCount:n.length,transactions:n},{title:this.historyService.generateGroupTitle(m.$9.FOR_SIGN_OTHERS),creditSum:null,debitSum:this.historyService.getTotalAmount(i),hasLargeTransactions:this.statementService.checkListForLargeTransactions(i),transactionsCount:i.length,transactions:i}]}showValidationError(e){return(0,p.mG)(this,void 0,void 0,function*(){const n=this.modalService.open(ut,this.modalConfigMedium);e.results=e.results.map(i=>(i.documentNumber=this.getDocumentNumberById(i.itemId),i)),n.componentInstance.result=e})}showMultipleSignPartialSuccess(e){return(0,p.mG)(this,void 0,void 0,function*(){const n=this.modalService.open(st,this.modalConfigMedium);e.results=e.results.map(i=>(i.documentNumber=this.getDocumentNumberById(i.itemId),i)),n.componentInstance.result=e})}showMultipleSignPartialError(e){return(0,p.mG)(this,void 0,void 0,function*(){const n=this.modalService.open(it,this.modalConfigMedium);e.results=e.results.map(i=>(i.documentNumber=this.getDocumentNumberById(i.itemId),i)),n.componentInstance.signResult=e})}showMultipleSignSuccess(e){return(0,p.mG)(this,void 0,void 0,function*(){this.modalService.open(rt,this.modalConfigSmall).componentInstance.result=e})}showMultipleSignError(e=null,n){return(0,p.mG)(this,void 0,void 0,function*(){const i=this.modalService.open(ot,this.modalConfigSmall);i.componentInstance.errorText=e;try{yield i.result,this.showSignModal(n)}catch(o){}})}showDeleteSuccess(e){return(0,p.mG)(this,void 0,void 0,function*(){this.modalService.open(nt,this.modalConfigSmall).componentInstance.successCount=e})}showDeletePartial(e,n){return(0,p.mG)(this,void 0,void 0,function*(){const i=this.modalService.open(M,this.modalConfigMedium);i.componentInstance.successCount=e,i.componentInstance.failedCount=n})}showDeleteError(e){return(0,p.mG)(this,void 0,void 0,function*(){const n=this.modalService.open(et,this.modalConfigSmall);n.componentInstance.failedCount=e.length;try{yield n.result,this.deleteTransactions(e)}catch(i){}})}showSendToSignedSuccess(e){return(0,p.mG)(this,void 0,void 0,function*(){this.modalService.open(at,this.modalConfigSmall).componentInstance.signResult=e})}showSendToSignedPartial(e){return(0,p.mG)(this,void 0,void 0,function*(){const n=this.modalService.open(L,this.modalConfigMedium);e.results=e.results.map(i=>(i.documentNumber=this.getDocumentNumberById(i.itemId),i)),n.componentInstance.signResult=e})}showSendToSignedPartialError(e){return(0,p.mG)(this,void 0,void 0,function*(){const n=this.modalService.open(ct,this.modalConfigMedium);e.results=e.results.map(i=>(i.documentNumber=this.getDocumentNumberById(i.itemId),i)),n.componentInstance.signResult=e})}showSendToSignedError(e){return(0,p.mG)(this,void 0,void 0,function*(){const n=this.modalService.open(lt,this.modalConfigSmall);n.componentInstance.signResult={numberOfFailed:e.length,numberOfSuccess:0,status:f.Y.FAILED};try{yield n.result,this.sendToSigned(e)}catch(i){}})}resetSelectable(){this.selectedTransactions=[],this.selectedCount=0,this.selectedBalance={amount:0,currency:null},this.isAllSelected=!1,this.hasSignableSelected=!1}updateSelectable(){this.resetSelectable(),this.updateSelectedValues()}retrieveIdsFromList(e){return e.map(n=>n.id)}updateSelectedValues(){this.currentTransactions.forEach(e=>{e.isSelected&&(this.selectedTransactions.push(e),this.selectedCount++)}),this.selectedBalance=this.countTotalBalanceFromTransactionsList(this.selectedTransactions)}countTotalBalanceFromPaymentsList(e){const n={amount:0,currency:null};return e.forEach(i=>{var o,a;n.currency||(n.currency=null===(o=i.details.paymentAmount)||void 0===o?void 0:o.currency),n.amount+=null===(a=i.details.paymentAmount)||void 0===a?void 0:a.amount}),n}countTotalBalanceFromTransactionsList(e){const n={amount:0,currency:null};return e.forEach(i=>{i.debit&&(!n.currency&&i.debit.currency&&(n.currency=i.debit.currency),n.amount+=i.debit.amount)}),n}isAllSignableInList(e){let n=!0;return e.forEach(i=>{if(!1===n)return n;i.isSignable||(n=!1)}),n}isAllSendableForSignInList(e){let n=!0;return e.forEach(i=>{if(!1===n)return n;i.isSendableForSign||(n=!1)}),n}hasSignableInList(e){return!!e.find(n=>n.isSignable)}hasSendableForSignInList(e){return!!e.find(n=>n.isSendableForSign)}mapQueryParams(e){let n=Object.assign({},this.filterService.getDefaults(this.filterMode));for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){const o=e[i];if(!o)continue;n[i]="periodFrom"==i||"periodTo"==i?new Date(o):o}return n}updateQueryParams(){const e=Object.assign({},this.filterScheme),n={};for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){const o=e[i];o&&null!=o&&"null"!=o&&(n[i]="periodFrom"==i||"periodTo"==i?this.datePipe.transform(o,"yyyy-MM-dd"):o,("amountFrom"==i||"amountTo"==i)&&(n[i]=this.maskedService.getNumberedAmount(o)))}this.updateCashedRouteQuery(n),this.router.navigate([],{queryParams:n,relativeTo:this.route,skipLocationChange:!1})}updateCashedRouteQuery(e){sessionStorage.setItem(this.SESSION_ROUTE_KEY,JSON.stringify(e))}getDocumentNumberById(e){const n=this.currentTransactions.find(i=>i.id==e);return n&&n.documentNumber||null}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(pt.J),t.Y36(W.iZ),t.Y36(ce),t.Y36(R.gz),t.Y36(R.F0),t.Y36(_.uU),t.Y36(y.FF),t.Y36(ue.n),t.Y36(ht.O),t.Y36(dt.AQ),t.Y36(de.lG))},s.\u0275cmp=t.Xpm({type:s,selectors:[["j-history-list"]],decls:10,vars:9,consts:[[1,"j-list"],[1,"j-list__header"],[1,"j-tabs"],[1,"j-tabs__list"],["class","j-tabs__item","routerLinkActive","active","translate","",3,"routerLink",4,"ngFor","ngForOf"],[1,"j-list__filter"],[3,"currency","mode"],["class","j-list__statement j-list__loading",4,"ngIf"],["infiniteScroll","",3,"scrollWindow","alwaysCallback","infiniteScrollDistance","infiniteScrollThrottle","scrolled"],["class","j-list__statement",3,"list-statement--scrollable",4,"ngIf"],["routerLinkActive","active","translate","",1,"j-tabs__item",3,"routerLink"],[1,"j-list__statement","j-list__loading"],[1,"j-list__statement"],["class","total",4,"ngIf"],[3,"statement","isTotalsShown","hasExtraPadding","isSelectable","signed","sentForSign","deleted","revoked","selected"],["class","text-center text-muted mt-5 mb-3 text-small","translate","",4,"ngIf"],[1,"total"],[1,"total__select","custom-control","custom-checkbox",3,"click"],["type","checkbox","id","checkboxAll",1,"custom-control-input",3,"ngModel","ngModelChange","click","change"],["for","checkboxAll","translate","",1,"custom-control-label"],[1,"total__content"],[3,"ngIf"],["leftCurrencies",""],[1,"total__actions"],[4,"ngIf"],[1,"total__text"],["translate",""],[3,"money"],["class","total__text",4,"ngFor","ngForOf"],[1,"total__text",3,"ngbTooltip"],[4,"ngFor","ngForOf"],["href","#","class","total__action","tooltipClass","tooltip-light",3,"ngbTooltip","inlineSVG","click",4,"ngIf"],["href","#","tooltipClass","tooltip-light",1,"total__action",3,"ngbTooltip","inlineSVG","click"],["href","#",1,"total__action","total__action--sign",3,"click"],["translate","",1,"mr-2"],[3,"inlineSVG"],["href","#","class","total__action total__action--sign","tooltipClass","tooltip-light",3,"ngbTooltip","inlineSVG","click",4,"ngIf"],["href","#","tooltipClass","tooltip-light",1,"total__action","total__action--sign",3,"ngbTooltip","inlineSVG","click"],["translate","",1,"text-center","text-muted","mt-5","mb-3","text-small"]],template:function(e,n){1&e&&(t.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"nav",3),t.YNc(4,ge,2,2,"a",4),t.qZA()(),t.TgZ(5,"div",5),t._UZ(6,"j-filter",6),t.qZA()(),t.YNc(7,Se,2,0,"div",7),t.TgZ(8,"div",8),t.NdJ("scrolled",function(){return n.onScroll()}),t.YNc(9,He,4,8,"div",9),t.qZA()()),2&e&&(t.xp6(4),t.Q6J("ngForOf",n.historyTypes),t.xp6(2),t.Q6J("currency",n.filterCurrency)("mode",n.filterMode),t.xp6(1),t.Q6J("ngIf",n.isLoading),t.xp6(1),t.Q6J("scrollWindow",!0)("alwaysCallback",!0)("infiniteScrollDistance",2)("infiniteScrollThrottle",500),t.xp6(1),t.Q6J("ngIf",!n.isLoading))},directives:[_.sg,R.yS,R.Od,h.Pi,me.z,_.O5,pe.D,X.R,P.Wl,P.JJ,P.On,Y.y,y._L,b.d$,he.H],pipes:[h.X$],styles:['[_nghost-%COMP%]{margin:1rem 0;display:block}.total[_ngcontent-%COMP%]{min-height:60px;position:relative;font-size:.875rem;color:#666c72;padding-bottom:1rem}@media (min-width: 960px){.total[_ngcontent-%COMP%]{align-items:center;display:flex}}.total[_ngcontent-%COMP%]:after{content:"";display:block;background:#eceef1;height:1px;position:absolute;bottom:0;left:-1.5rem;right:-1.5rem}.total[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#1a1c1f}.total__select[_ngcontent-%COMP%]{margin-bottom:1rem}@media (min-width: 960px){.total__select[_ngcontent-%COMP%]{margin-right:1.5rem;margin-bottom:0}}.total__select[_ngcontent-%COMP%]   .custom-control-label[_ngcontent-%COMP%]{line-height:1.5rem}.total__actions[_ngcontent-%COMP%]{margin-left:auto;display:flex}.total__text[_ngcontent-%COMP%]{margin-right:1rem}@media (min-width: 960px){.total__text[_ngcontent-%COMP%]{text-align:right}}.total__action[_ngcontent-%COMP%]{display:block;margin-left:.5rem;color:#b7bec5}.total__action[_ngcontent-%COMP%]:hover{color:#ef5630}.total__action--sign[_ngcontent-%COMP%]{color:#1586bb}.total__content[_ngcontent-%COMP%]{margin-left:auto;display:flex;align-items:center}@media (min-width: 960px){.total__content[_ngcontent-%COMP%]{justify-content:flex-end}}']}),s})();const Me=[{path:"",component:At,data:{title:"HISTORY.TITLE"},children:[{path:"all",component:U,data:{category:u.nK.ALL}},{path:"tenge",component:U,data:{category:u.nK.DOMESTIC}},{path:"foreign",component:U,data:{category:u.nK.FOREIGN}},{path:"conversion",component:U,data:{category:u.nK.CONVERSION}},{path:"**",redirectTo:"all"}]},{path:"**",redirectTo:""}];let Ye=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[R.Bz.forChild(Me)],R.Bz]}),s})();var Ue=l(23918);let ke=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[_.ez,_t.m,ft.i,P.u5,Tt.n,Ye,X.X,h.aw,Ue.hx]]}),s})()}}]);