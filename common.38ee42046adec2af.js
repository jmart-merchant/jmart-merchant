"use strict";(self.webpackChunkjysan=self.webpackChunkjysan||[]).push([[592],{57720:(O,g,e)=>{e.d(g,{r:()=>d});var v=e(70655),_=e(80457),u=e(7102),l=e(5e3),c=e(1790),m=e(26164),n=e(26484),o=e(91024),s=e(74967),i=e(25437);let d=(()=>{class r{constructor(t,a,h,y,E,D){this.api=t,this.companyService=a,this.maskedService=h,this.paymentsPipelineService=y,this.paymentsApiService=E,this.paymentsSharedService=D}getPurposeList(){return this.api.get("dictionaries/conversion-purposes")}getRateObservable(t){return this.api.postObservable(`companies/${this.companyService.currentId}/payments/exchange-rate`,t)}getRate(t){return this.paymentsSharedService.getExchangeRate(t)}getConversionById(t){return this.paymentsApiService.getPaymentById(t)}saveEditedConversion(t,a){return this.paymentsApiService.updatePayment(this.mapConversionToPayment(t,a),{paymentId:t.id})}getCommission(t){return(0,v.mG)(this,void 0,void 0,function*(){const a=`companies/${this.companyService.currentId}/payments/commission`,h=this.mapFormToPayment(t),y=yield this.api.post(a,h);return{amount:y.commissionAmount||0,currency:y.currency||_.w.KZT}})}createConversion(t){return this.paymentsApiService.createPayment(this.mapFormToPayment(t))}updateConversion(t){return this.paymentsApiService.updatePayment(this.mapFormToPayment(t),{paymentId:t.id})}createAndSignConversion(t){return(0,v.mG)(this,void 0,void 0,function*(){const a=yield this.createConversion(t);return this.paymentsPipelineService.processPaymentVerify(a)})}mapFormToPayment(t){var a,h,y,E,D;const P={status:{code:u.R$.CREATED},paymentRecipient:{recipientAccount:{iban:null===(a=t.to)||void 0===a?void 0:a.iban}},type:u.V_.CONVERSION,category:u.nK.CONVERSION,details:{exchangeRate:t.rate,conversionPurpose:t.purpose,description:t.description,payerIban:null===(h=t.from)||void 0===h?void 0:h.iban,paymentAmount:{amount:this.maskedService.getNumberedAmount(t.fromAmount),currency:null===(E=null===(y=t.from)||void 0===y?void 0:y.balance)||void 0===E?void 0:E.currency},documentId:t.documentNumber}};return t.commissionAccount&&(P.details.exchangeRate=Object.assign(Object.assign({},P.details.exchangeRate),{commissionWithdrawalIban:null===(D=t.commissionAccount)||void 0===D?void 0:D.iban})),P}mapConversionToPayment(t,a){return a.paymentRecipient.recipientAccount.iban=t.to.iban,a.details.exchangeRate=t.rate,a.details.conversionPurpose=t.purpose,a.details.description=t.description,a.details.payerIban=t.from.iban,a.details.paymentAmount={amount:this.maskedService.getNumberedAmount(t.fromAmount),currency:t.from.balance.currency},a.details.documentId=t.documentNumber,a}}return r.\u0275fac=function(t){return new(t||r)(l.LFG(c.sM),l.LFG(m.J),l.LFG(n.O),l.LFG(o.Z),l.LFG(s.e),l.LFG(i.t))},r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()},1953:(O,g,e)=>{e.d(g,{N:()=>l});var v=e(40520),_=e(24850),u=e(5e3);let l=(()=>{class c{constructor(n,o){this.http=n,this.baseUrl=o}getOrders(n="",o=1,s="",i=!0){const d=`${this.baseUrl}/gw/order/v1/merchant/order`;let r=(new v.LE).set("search",n).set("page",String(o)).set("descDate",Number(i));return r="C"!==s?r.set("status",s):r.set("status[0]","C").set("status[1]","R"),this.http.get(d,{params:r}).pipe((0,_.U)(p=>p.data))}getOrder(n){return this.http.get(`${this.baseUrl}/gw/order/v1/merchant/order/${n}`).pipe((0,_.U)(s=>s.data))}editComments(n,o){const s=`${this.baseUrl}/gw/order/v1/merchant/merchant-comment/${n}`,i=new URLSearchParams;i.set("merchantComment",o);const d=(new v.WM).set("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");return this.http.put(s,i.toString(),{headers:d}).pipe((0,_.U)(r=>r.data))}changeStatus(n,o,s,i){const d=`${this.baseUrl}/gw/order/v1/merchant/order/status-change/${n}`,r=new URLSearchParams;r.set("status",o),s&&r.set("cancelReason",s),i&&r.set("cancelReasonOther",i);const p=(new v.WM).set("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");return this.http.put(d,r.toString(),{headers:p}).pipe((0,_.U)(t=>t.data))}sendSms(n){return this.http.post(`${this.baseUrl}/gw/order/v2/order/confirmation-sms/${n}`,{}).pipe((0,_.U)(s=>s.data))}changeStatusByCode(n,o){const s=`${this.baseUrl}/gw/order/v2/order/change-status-by-sms-code/${n}`,i=new URLSearchParams;i.set("code",o);const d=(new v.WM).set("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");return this.http.post(s,i.toString(),{headers:d}).pipe((0,_.U)(r=>r.data))}}return c.\u0275fac=function(n){return new(n||c)(u.LFG(v.eN),u.LFG("JMART_CABINET_BASE_URL"))},c.\u0275prov=u.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},69942:(O,g,e)=>{e.d(g,{p:()=>m});var v=e(591),_=e(24850),u=e(5154),l=e(5e3),c=e(40520);let m=(()=>{class n{constructor(s,i){this.baseUrl=s,this.http=i,this.deliveryCity$=new v.X([]),this.cities$=null,this.citiesAndRegions$=null}getDeliveries(){return this.http.get(`${this.baseUrl}/gw/shipping/v1/merchant/shipping-rates`).pipe((0,_.U)(s=>s.data.items.map(i=>Object.assign(Object.assign({},i),{attributes:Object.assign(Object.assign({},i.attributes),{workingTime:i.attributes.workingTime.map(d=>Object.assign(Object.assign({},d),{days:d.days.map(r=>Object.assign(Object.assign({},r),{day:r.name.slice(0,2)}))}))})})))).subscribe(s=>{this.deliveryCity$.next(s)}),this.deliveryCity$}mapCity({cityId:s,title:i}){return{cityId:s,title:i,type:3,id:s}}getCities(){if(!this.cities$){const s=this.http.get(`${this.baseUrl}/gw/dictionary/v1/cities`,{params:{status:"A"}}).pipe((0,_.U)(i=>Object.values(i.data).map(this.mapCity)),(0,u.d)(1));this.cities$=s}return this.cities$}getCitiesAndRegion(){if(!this.citiesAndRegions$){const s=this.http.get(`${this.baseUrl}/gw/dictionary/v1/entities/city,region`,{params:{is_city:0}}).pipe((0,_.U)(i=>{const{city:d,region:r}=i.data;return[{title:"\u0412\u0441\u044f \u0441\u0442\u0440\u0430\u043d\u0430",value:{title:"\u0412\u0441\u044f \u0441\u0442\u0440\u0430\u043d\u0430",cityId:0,type:1,id:0}},...r.map(({title:p,id:t})=>({title:p,value:{title:p,cityId:t,type:2,id:t}})),...d.map(p=>{const t=this.mapCity(p);return{title:t.title,value:t}})]}),(0,u.d)(1));this.citiesAndRegions$=s}return this.citiesAndRegions$}addDelivery(s){this.http.post(`${this.baseUrl}/gw/shipping/v1/merchant/shipping-rates`,s).subscribe(d=>{const r=d.data,p=this.deliveryCity$.getValue();this.deliveryCity$.next([r,...p])})}editDelivery(s,i){this.http.put(`${this.baseUrl}/gw/shipping/v1/merchant/shipping-rates/${i}`,s).subscribe(d=>{const r=this.deliveryCity$.getValue(),p=r.findIndex(({id:t})=>i===t);r[p]=d.data,this.deliveryCity$.next([...r])})}removeDelivery(s,i){return this.http.delete(`${this.baseUrl}/gw/shipping/v1/merchant/shipping-rates/${s}`).subscribe(()=>{const d=this.deliveryCity$.getValue();this.deliveryCity$.next(d.filter(({id:r})=>r!==s)),i.dismiss()})}getTariff(s){return this.http.get(`${this.baseUrl}/gw/tariff/v1/company-tariff/rates-by-category?type=${s}`).pipe((0,_.U)(i=>{let d={};const r=Object.values(i.data).map(({category:t,card:a,credit:h,installment:y})=>(d=Object.assign(Object.assign(Object.assign({},d),y),{credit:h,card:a}),{category:t,card:a,credit:h,installment:y})),p=Object.values(d).filter(t=>"number"==typeof t).length;return{data:r,installmentMax:d,cellLength:p}}))}}return n.\u0275fac=function(s){return new(s||n)(l.LFG("JMART_CABINET_BASE_URL"),l.LFG(c.eN))},n.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},49653:(O,g,e)=>{e.d(g,{P:()=>m});var v=e(57553),_=e(5e3),u=e(40703),l=e(50384),c=e(59516);let m=(()=>{class n{constructor(s,i,d){this.modal=s,this.auth=i,this.router=d}canDeactivate(s,i,d,r){var p;const{extras:t}=this.router.getCurrentNavigation();if(null===(p=null==t?void 0:t.state)||void 0===p?void 0:p.silent)return Promise.resolve(!0);if(s&&s.formDirective&&this.auth.isAuthenticated){const{formDirective:a,form:h}=s;if(!a.submitted&&h.dirty||a.submitted&&h.dirty)return this.modal.open(v.A,{backdropClass:"backdrop_light",windowClass:"modal_light modal_max-height",centered:!0}).result}return Promise.resolve(!0)}}return n.\u0275fac=function(s){return new(s||n)(_.LFG(u.FF),_.LFG(l.e),_.LFG(c.F0))},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},7500:(O,g,e)=>{e.d(g,{si:()=>_.s,hm:()=>_.h,e6:()=>u.e,$g:()=>c.$,Zx:()=>m.Z,TB:()=>n.TB,cR:()=>n.cR}),e(49653);var _=e(54557),u=e(74967),c=(e(54702),e(39996)),m=e(91024),n=e(28706)},54702:(O,g,e)=>{e.d(g,{k:()=>n});var v=e(38114),_=e(5e3),u=e(59516),l=e(74967),c=e(28706),m=e(66013);let n=(()=>{class o{constructor(i,d,r,p,t){this.router=i,this.route=d,this.api=r,this.payments=p,this.notification=t}canActivate(i,d){var r,p,t;const a=null===(p=null===(r=this.router.getCurrentNavigation().extras)||void 0===r?void 0:r.state)||void 0===p?void 0:p.repeatPayment,h=(null===(t=i.params)||void 0===t?void 0:t.paymentId)||(null==a?void 0:a.id);let y=v.KK.tenge.order;return a&&(y=this.payments.getPaymentRouteByType(a.type)),h?this.api.getPaymentById(h).then(E=>{const D=[this.payments.getPaymentRouteByType(E.type)];a||D.push(h),this.router.navigate(D,{state:{resolvedPayment:E}})}).catch(E=>{this.router.navigate([v.KK.tenge.order]),this.notification.show({type:"error",message:E})}):this.router.navigate([y]),!1}}return o.\u0275fac=function(i){return new(i||o)(_.LFG(u.F0),_.LFG(u.gz),_.LFG(l.e),_.LFG(c.cR),_.LFG(m.lG))},o.\u0275prov=_.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},31872:(O,g,e)=>{e.d(g,{V:()=>_});var v=e(5e3);let _=(()=>{class u{constructor(){this.fileDropped=new v.vpe}onDragOver(c){c.preventDefault(),c.stopPropagation(),this.fileOver=!0}onDragLeave(c){c.preventDefault(),c.stopPropagation(),this.fileOver=!1}ondrop(c){c.preventDefault(),c.stopPropagation(),this.fileOver=!1;let m=c.dataTransfer.files;m.length>0&&this.fileDropped.emit(m)}}return u.\u0275fac=function(c){return new(c||u)},u.\u0275dir=v.lG2({type:u,selectors:[["","jDnd",""]],hostVars:2,hostBindings:function(c,m){1&c&&v.NdJ("dragover",function(o){return m.onDragOver(o)})("dragleave",function(o){return m.onDragLeave(o)})("drop",function(o){return m.ondrop(o)}),2&c&&v.ekj("fileover",m.fileOver)},outputs:{fileDropped:"fileDropped"}}),u})()}}]);