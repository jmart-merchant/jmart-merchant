(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{Yj9t:function(t,e,i){"use strict";i.r(e);var s=i("ofXK"),r=i("tyNb"),n=i("3Pt+"),o=i("tmjD"),a=i("PCNd"),c=i("mrSG"),h=i("quSY"),b=i("lJxs"),u=i("p6Hd"),l=i("fXoL"),d=i("qXBG"),p=i("7foZ"),m=i("VO+5"),g=i("7/bn"),T=i("ZF+8"),v=i("iQ9M"),E=i("mR7B"),f=i("VnnJ"),R=i("sYmb"),S=i("3MRA"),y=i("ZVDf"),A=i("yy4r"),I=i("M6pS"),O=i("zdqJ");const k=["phoneInput"],C=["passwordInput"],w=["registerButton"];let V=(()=>{class t{constructor(t,e,i,s,r,o){this.maskedService=t,this.maskPipe=e,this.tourService=i,this.route=s,this.companyService=r,this.translateService=o,this.isSubmitted=!1,this.isPhoneSubmitted=!1,this.PHONE=localStorage.getItem("phone")?localStorage.getItem("phone"):"",this.PASSWORD="",this.passwordRegExp=/[^ ]/,this.passwordPasteRegExp=/[ ]/,this.countryCode={code:"+7",country:this.translateService.instant(`COUNTRIES.${v.b.KAZAKHSTAN}`),id:v.b.KAZAKHSTAN},this.submitted=new l.n,this.subscription=new h.a,this.isFromAtf=!1,this.isTourShown=JSON.parse(localStorage.getItem("isLoginStepShown"))||!1;const a=this.route.queryParams.subscribe(t=>{this.queryParams=t,this.isFromAtf=this.companyService.isFromAtf(t),this.startLoginTour()});this.loginForm=new n.k({prefix:new n.h(this.countryCode.code,n.H.required),phone:new n.h(this.PHONE,n.H.required),password:new n.h(this.PASSWORD,n.H.required)});const c=this.loginForm.valueChanges.subscribe(t=>{this.isSubmitted=!1,this.isPhoneSubmitted=!1});this.subscription.add(a),this.subscription.add(c)}triggerErrorAnimation(){this.passwordInput.triggerHelperAnimation()}ngOnDestroy(){this.subscription.unsubscribe()}ngAfterViewInit(){this.loginForm.controls.phone.value?this.passwordInput.focus():this.phoneInput.focus(),this.startLoginTour()}ngOnChanges(t){var e;(null===(e=t.passwordError)||void 0===e?void 0:e.currentValue)&&(this.passwordError=t.passwordError.currentValue)}onTabPress(t){t.preventDefault(),this.isPhoneSubmitted=!0,this.f.phone.valid&&this.passwordInput.focus()}onSubmit(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.isSubmitted=!0,this.loginForm.invalid)return void(this.loginForm.controls.phone.errors?this.loginError="ERRORS.NOT_ENOUGH_SYMBOLS":this.loginForm.controls.password.errors&&(this.passwordError="ERRORS.ENTER_PASSWORD"));const t=`${this.countryCode.code}${this.maskedService.getUnmaskedPhone(this.f.phone.value)}`;this.submitted.emit({phone:t,password:this.f.password.value,countryCode:this.countryCode})}))}get f(){return this.loginForm.controls}startLoginTour(){this.isTourShown||(this.isTourShown=!0,localStorage.setItem("isLoginStepShown",JSON.stringify(!0)),setTimeout(()=>{this.tourService.startTour(T.e.AUTH,{skipAuthorization:!0})},0))}onCountrySelected(t){this.countryCode=t}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(E.a),l.Qb(o.b),l.Qb(T.g),l.Qb(r.a),l.Qb(f.a),l.Qb(R.e))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-login-phone"]],viewQuery:function(t,e){var i;1&t&&(l.Vc(k,!0),l.Vc(C,!0),l.Vc(w,!0)),2&t&&(l.Bc(i=l.jc())&&(e.phoneInput=i.first),l.Bc(i=l.jc())&&(e.passwordInput=i.first),l.Bc(i=l.jc())&&(e.registerButton=i.first))},inputs:{isLoading:"isLoading",phone:"phone",passwordError:"passwordError",loginError:"loginError",prefix:"prefix"},outputs:{submitted:"submitted"},features:[l.yb()],decls:21,vars:21,consts:[["translate","",1,"light","mb-3","mt-0"],["autocomplete","off",3,"formGroup","ngSubmit"],[1,"phone-input"],[3,"formControl","countryCode","countrySelected","keydown.Tab"],["phonePrefixInput",""],[3,"formControl","hasError","errorText","countryCode","keydown.Tab"],["phoneInput",""],[3,"regexStr","pasteRegexStr","hasCapsLockCheck","hasCyrillicCheck","isAuth","formControl","hasError","errorText"],["passwordInput",""],[1,"auth-submit"],[1,"auth-submit__button"],["translate","","type","submit",1,"btn","btn-static","btn-primary","btn-lg",3,"jLoading","disabled"],["translate","","routerLink","/auth/register","queryParamsHandling","merge","jTour","AUTH.REGISTER","jTourPosition","right",1,"btn","btn-static","btn-link",3,"disabled"]],template:function(t,e){1&t&&(l.Wb(0,"article"),l.Wb(1,"h3",0),l.Qc(2,"AUTH.LOGIN_TITLE"),l.Vb(),l.Wb(3,"p"),l.Qc(4),l.mc(5,"translate"),l.Vb(),l.Vb(),l.Wb(6,"form",1),l.ic("ngSubmit",(function(t){return e.onSubmit()})),l.Wb(7,"div",2),l.Wb(8,"j-phone-prefix-input",3,4),l.ic("countrySelected",(function(t){return e.onCountrySelected(t)}))("keydown.Tab",(function(t){return e.onTabPress(t)})),l.Vb(),l.Wb(10,"j-phone-input",5,6),l.ic("keydown.Tab",(function(t){return e.onTabPress(t)})),l.Vb(),l.Vb(),l.Rb(12,"j-password-input",7,8),l.Wb(14,"div",9),l.Wb(15,"div",10),l.Wb(16,"button",11),l.Qc(17,"AUTH.LOGIN"),l.Vb(),l.Vb(),l.Wb(18,"div",10),l.Wb(19,"button",12),l.Qc(20,"AUTH.REGISTER"),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&t&&(l.Ab(4),l.Rc(l.nc(5,19,e.isFromAtf?"AUTH.LOGIN_SUBTITLE_ATF":"AUTH.LOGIN_SUBTITLE")),l.Ab(2),l.rc("formGroup",e.loginForm),l.Ab(2),l.rc("formControl",e.f.prefix)("countryCode",e.countryCode),l.Ab(2),l.rc("formControl",e.f.phone)("hasError",e.loginError||e.f.phone.errors&&(e.isSubmitted||e.isPhoneSubmitted))("errorText",e.loginError)("countryCode",e.countryCode),l.Ab(2),l.rc("regexStr",e.passwordRegExp)("pasteRegexStr",e.passwordPasteRegExp)("hasCapsLockCheck",!0)("hasCyrillicCheck",!0)("isAuth",!e.isLoading)("formControl",e.f.password)("hasError",e.passwordError||e.isSubmitted&&e.f.password.errors)("errorText",e.passwordError),l.Ab(4),l.rc("jLoading",e.isLoading)("disabled",e.isLoading),l.Ab(3),l.rc("disabled",e.isLoading))},directives:[R.a,n.J,n.u,n.l,S.a,n.t,n.i,y.a,A.a,I.a,r.d,O.a],pipes:[R.d],styles:[".phone-input[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}j-phone-input[_ngcontent-%COMP%]{width:-moz-available;width:-webkit-fill-available;width:stretch}"]}),t})();var L=i("aF9I"),N=i("yZrb"),D=i("2FF4"),W=i("Kcpt"),P=i("4zJ+");function j(t,e){if(1&t){const t=l.Xb();l.Wb(0,"a",3),l.ic("click",(function(e){return l.Fc(t),l.lc().navigateToPhone(e)})),l.Rb(1,"j-icon",4),l.Wb(2,"strong",5),l.Qc(3,"SHARED.BACK"),l.Vb(),l.Vb()}2&t&&(l.Ab(1),l.rc("isStroke",!0))}function H(t,e){1&t&&(l.Wb(0,"div",6),l.Rb(1,"j-animated-loading"),l.Vb())}let Q=(()=>{class t{constructor(){this.isReady=!1,this.submitted=new l.n,this.closed=new l.n,this.headerParams={smsHeader:N.c.AUTHORIZATION}}onSmsLoaded(){this.isReady=!0}onSubmit(t){this.submitted.emit(t)}navigateToPhone(t=null){var e;null===(e=t)||void 0===e||e.preventDefault(),this.closed.emit()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Kb({type:t,selectors:[["j-login-sms"]],inputs:{isLoading:"isLoading",phone:"phone",countryCode:"countryCode"},outputs:{submitted:"submitted",closed:"closed"},decls:3,vars:5,consts:[["href","#","class","j-link",3,"click",4,"ngIf"],[3,"phone","countryCode","headers","loaded","submitted"],["class","spinner-wrap",4,"ngIf"],["href","#",1,"j-link",3,"click"],["name","arrowLeft","color","primary",1,"mr-2",3,"isStroke"],["translate",""],[1,"spinner-wrap"]],template:function(t,e){1&t&&(l.Oc(0,j,4,1,"a",0),l.Wb(1,"j-sms",1),l.ic("loaded",(function(t){return e.onSmsLoaded()}))("submitted",(function(t){return e.onSubmit(t)})),l.Vb(),l.Oc(2,H,2,0,"div",2)),2&t&&(l.rc("ngIf",e.isReady),l.Ab(1),l.rc("phone",e.phone)("countryCode",e.countryCode)("headers",e.headerParams),l.Ab(1),l.rc("ngIf",!e.isReady))},directives:[s.u,D.a,W.a,R.a,P.a],styles:[".spinner-wrap[_ngcontent-%COMP%]{min-height:280px;position:relative}"]}),t})();const _=["loginPhone"];function U(t,e){if(1&t){const t=l.Xb();l.Wb(0,"j-login-sms",13),l.ic("closed",(function(e){return l.Fc(t),l.lc().onSmsClose()}))("submitted",(function(e){return l.Fc(t),l.lc().onSmsSubmit(e)})),l.Vb()}if(2&t){const t=l.lc();l.rc("phone",t.phone)("countryCode",t.countryCode)("isLoading",t.isLoading)}}function M(t,e){1&t&&(l.Wb(0,"div",14),l.Rb(1,"j-animated-loading"),l.Vb())}var F=function(t){return t.PHONE="phone",t.SMS="sms",t.LOADING="loading",t}({});let x=(()=>{class t{constructor(t,e,i,s,r){this.auth=t,this.tokenService=e,this.route=i,this.router=s,this.notifierService=r,this.isLoading=!1,this.steps=F,this.currentStep=this.steps.PHONE,this.phoneError="",this.subscription=new h.a,this.subscription.add(this.route.paramMap.pipe(Object(b.a)(()=>window.history.state)).subscribe(t=>{t.phone&&(this.phone=t.phone),t.error&&(this.phoneError=t.error)}))}ngOnDestroy(){this.subscription.unsubscribe()}onSmsClose(){this.navigateToPhone(),this.phoneError=""}onPhoneSubmit(t){this.loginForm=t,this.phone=this.loginForm.phone,this.countryCode=this.loginForm.countryCode;try{const t=this.tokenService.getDeviceToken(this.loginForm.password);localStorage.setItem("countryCode",JSON.stringify(this.countryCode)),t?this.login():this.navigateToSms()}catch(e){this.navigateToSms()}}onSmsSubmit(t){return Object(c.a)(this,void 0,void 0,(function*(){this.auth.setSmsToken(t);try{const t=yield this.auth.requestDevice(this.phone);this.tokenService.setDeviceToken(t.signature,this.loginForm.password),this.login()}catch(e){switch(this.navigateToPhone(),e.code){case u.b.DEVICE_TOKEN_INVALID:case u.b.RESOURCE_NOT_FOUND:case u.b.AUTHORIZATION_ERROR:case u.b.INVALID_GRANT:this.phoneError="ERRORS.WRONG_CREDENTIALS";break;case u.b.USER_BLOCKED:case u.b.RESOURCE_BLOCKED:this.phoneError="ERRORS.ACCOUNT_BLOCKED";break;default:this.phoneError=e.description}}}))}login(){return Object(c.a)(this,void 0,void 0,(function*(){this.isLoading=!0,this.phoneError="";try{yield this.auth.login(this.loginForm.phone,this.loginForm.password),this.router.navigateByUrl("/"),this.notifierService.hideAll()}catch(t){if(this.navigateToPhone(),t.status)switch(t.code){case u.b.RESOURCE_NOT_FOUND:case u.b.AUTHORIZATION_ERROR:case u.b.INVALID_GRANT:this.phoneError="ERRORS.WRONG_CREDENTIALS";break;case u.b.RESOURCE_BLOCKED:this.tokenService.clearDeviceToken(),this.phoneError="ERRORS.ACCOUNT_BLOCKED";break;case u.b.DEVICE_NOT_AUTHORIZED:case u.b.DEVICE_TOKEN_INVALID:case u.b.TOKEN_EXPIRED:this.navigateToSms();break;default:this.phoneError=t.description}else this.phoneError="ERRORS.API_UNAVAILABLE";this.loginPhone.triggerErrorAnimation(),this.isLoading=!1}}))}navigateToSms(){this.currentStep=F.SMS}navigateToPhone(){this.currentStep=F.PHONE}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(d.a),l.Qb(p.a),l.Qb(r.a),l.Qb(r.c),l.Qb(m.c))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-login"]],viewQuery:function(t,e){var i;1&t&&l.Vc(_,!0),2&t&&l.Bc(i=l.jc())&&(e.loginPhone=i.first)},decls:13,vars:7,consts:[[1,"auth-wrap"],[1,"d-sm-none",3,"isUserShown"],[1,"login-wrap"],[1,"login"],[1,"mb-7","d-none","d-sm-flex","justify-content-between"],["src","./assets/img/logo.svg","alt","Jusan bank"],["src","./assets/img/v2/atf.svg","alt","ATF Business"],[1,"login-steps"],[3,"hidden","phone","isLoading","passwordError","submitted"],["loginPhone",""],[3,"phone","countryCode","isLoading","closed","submitted",4,"ngIf"],["class","spinner-wrap",4,"ngIf"],["langClassName","d-block","copyrightClassName",""],[3,"phone","countryCode","isLoading","closed","submitted"],[1,"spinner-wrap"]],template:function(t,e){1&t&&(l.Wb(0,"section",0),l.Rb(1,"j-aside",1),l.Wb(2,"div",2),l.Wb(3,"div",3),l.Wb(4,"div",4),l.Rb(5,"img",5),l.Rb(6,"img",6),l.Vb(),l.Wb(7,"section",7),l.Wb(8,"j-login-phone",8,9),l.ic("submitted",(function(t){return e.onPhoneSubmit(t)})),l.Vb(),l.Oc(10,U,1,3,"j-login-sms",10),l.Oc(11,M,2,0,"div",11),l.Vb(),l.Vb(),l.Vb(),l.Rb(12,"j-footer",12),l.Vb()),2&t&&(l.Ab(1),l.rc("isUserShown",!1),l.Ab(7),l.rc("hidden",e.currentStep!=e.steps.PHONE)("phone",e.phone)("isLoading",e.isLoading)("passwordError",e.phoneError),l.Ab(2),l.rc("ngIf",e.currentStep==e.steps.SMS),l.Ab(1),l.rc("ngIf",e.currentStep==e.steps.LOADING))},directives:[g.a,V,s.u,L.a,Q,P.a],styles:[".login[_ngcontent-%COMP%]{background:#f6f7f8;width:100%;padding:1rem}@media(min-width:670px){.login[_ngcontent-%COMP%]{border-radius:2.5rem;padding:3.5rem}}.login-wrap[_ngcontent-%COMP%]{max-width:546px;margin:auto;width:100%;padding-top:1.5rem;padding-bottom:1.5rem}@media(min-width:1920px){.login-wrap[_ngcontent-%COMP%]{max-width:600px}}.spinner-wrap[_ngcontent-%COMP%]{min-height:280px;position:relative}"]}),t})();var G=i("paXB"),K=i("Zgqj"),B=i("EiG8");let q=(()=>{class t{constructor(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Kb({type:t,selectors:[["j-register"]],decls:8,vars:2,consts:[[3,"isUserShown"],[3,"isCentered"],[1,"row"],[1,"col-sm-10","col-md-7","offset-sm-1","col-lg-5","offset-lg-1","col-xl-4","offset-xl-1"],[1,"auth-form"]],template:function(t,e){1&t&&(l.Wb(0,"j-layout-home"),l.Wb(1,"j-aside",0),l.Rb(2,"j-nav-auth"),l.Vb(),l.Wb(3,"j-main",1),l.Wb(4,"div",2),l.Wb(5,"div",3),l.Wb(6,"div",4),l.Rb(7,"router-outlet"),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&t&&(l.Ab(1),l.rc("isUserShown",!1),l.Ab(2),l.rc("isCentered",!0))},directives:[G.a,g.a,K.a,B.a,r.h],styles:[""]}),t})();var X=i("1kSV");let J=(()=>{class t{constructor(t){this.modal=t}dismissModal(){this.modal.dismiss()}closeModal(){this.modal.close()}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(X.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-can-register"]],decls:14,vars:3,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","./assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body"],["translate","",1,"auth-heading","light","mb-3","mt-0"],["translate","",1,"m-0"],[1,"modal-footer","j-modal-footer"],["translate","","type","button",1,"btn","btn-static","btn-primary",3,"click"],["translate","","type","button",1,"btn","btn-static","btn-link",3,"click"]],template:function(t,e){1&t&&(l.Wb(0,"div",0),l.Wb(1,"button",1),l.ic("click",(function(t){return e.dismissModal()})),l.Rb(2,"img",2),l.mc(3,"translate"),l.Vb(),l.Vb(),l.Wb(4,"div",3),l.Wb(5,"h3",4),l.Qc(6,"AUTH.CAN_REGISTER.TITLE"),l.Vb(),l.Wb(7,"p",5),l.Qc(8,"AUTH.CAN_REGISTER.DESCRIPTION"),l.Vb(),l.Vb(),l.Wb(9,"div",6),l.Wb(10,"button",7),l.ic("click",(function(t){return e.closeModal()})),l.Qc(11,"AUTH.REGISTER"),l.Vb(),l.Wb(12,"button",8),l.ic("click",(function(t){return e.dismissModal()})),l.Qc(13,"SHARED.CANCEL"),l.Vb(),l.Vb()),2&t&&(l.Ab(2),l.sc("alt",l.nc(3,1,"SHARED.CLOSE")))},directives:[R.a],pipes:[R.d],styles:[""]}),t})(),Z=(()=>{class t{constructor(t){this.modal=t}dismissModal(){this.modal.dismiss()}closeModal(t){this.modal.close(t)}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(X.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-can-restore"]],decls:12,vars:3,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","./assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body"],["translate","",1,"auth-heading","light","mb-3","mt-0"],["translate","",1,"m-0"],[1,"modal-footer","j-modal-footer"],["translate","","type","button",1,"btn","btn-static","btn-primary",3,"click"]],template:function(t,e){1&t&&(l.Wb(0,"div",0),l.Wb(1,"button",1),l.ic("click",(function(t){return e.dismissModal()})),l.Rb(2,"img",2),l.mc(3,"translate"),l.Vb(),l.Vb(),l.Wb(4,"div",3),l.Wb(5,"h3",4),l.Qc(6,"AUTH.CAN_RESTORE.TITLE"),l.Vb(),l.Wb(7,"p",5),l.Qc(8,"AUTH.CAN_RESTORE.DESCRIPTION"),l.Vb(),l.Vb(),l.Wb(9,"div",6),l.Wb(10,"button",7),l.ic("click",(function(t){return e.closeModal("login")})),l.Qc(11,"AUTH.LOGIN"),l.Vb(),l.Vb()),2&t&&(l.Ab(2),l.sc("alt",l.nc(3,1,"SHARED.CLOSE")))},directives:[R.a],pipes:[R.d],styles:[""]}),t})(),$=(()=>{class t{constructor(t){this.modal=t}dismissModal(){this.modal.dismiss()}closeModal(t){this.modal.close(t)}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(X.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-contact-modal"]],decls:14,vars:3,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","./assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body"],["translate","",1,"auth-heading","light","mb-3","mt-0"],["translate","",1,"m-0"],[1,"modal-footer","j-modal-footer"],["translate","","href","https://jysanbank.kz/ru/page/contacts","target","_blank",1,"btn","btn-static","btn-primary"],["translate","","type","button",1,"btn","btn-link","d-none","d-sm-block",3,"click"]],template:function(t,e){1&t&&(l.Wb(0,"div",0),l.Wb(1,"button",1),l.ic("click",(function(t){return e.dismissModal()})),l.Rb(2,"img",2),l.mc(3,"translate"),l.Vb(),l.Vb(),l.Wb(4,"div",3),l.Wb(5,"h3",4),l.Qc(6,"AUTH.CONTACT.TITLE"),l.Vb(),l.Wb(7,"p",5),l.Qc(8,"AUTH.CONTACT.DESCRIPTION "),l.Vb(),l.Vb(),l.Wb(9,"div",6),l.Wb(10,"a",7),l.Qc(11,"AUTH.CONTACT.LINK"),l.Vb(),l.Wb(12,"button",8),l.ic("click",(function(t){return e.dismissModal()})),l.Qc(13,"SHARED.CANCEL"),l.Vb(),l.Vb()),2&t&&(l.Ab(2),l.sc("alt",l.nc(3,1,"SHARED.CLOSE")))},directives:[R.a],pipes:[R.d],styles:[""]}),t})(),z=(()=>{class t{constructor(t){this.modal=t}closeModal(){this.modal.close()}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(X.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-expired"]],decls:12,vars:3,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","./assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body"],["translate","",1,"auth-heading","light","mb-3","mt-0"],["translate","",1,"m-0"],[1,"modal-footer","j-modal-footer"],["translate","","type","button",1,"btn","btn-static","btn-primary",3,"click"]],template:function(t,e){1&t&&(l.Wb(0,"div",0),l.Wb(1,"button",1),l.ic("click",(function(t){return e.closeModal()})),l.Rb(2,"img",2),l.mc(3,"translate"),l.Vb(),l.Vb(),l.Wb(4,"div",3),l.Wb(5,"h3",4),l.Qc(6,"AUTH.EXPIRED.TITLE"),l.Vb(),l.Wb(7,"p",5),l.Qc(8,"AUTH.EXPIRED.DESCRIPTION"),l.Vb(),l.Vb(),l.Wb(9,"div",6),l.Wb(10,"button",7),l.ic("click",(function(t){return e.closeModal()})),l.Qc(11,"SHARED.CLOSE"),l.Vb(),l.Vb()),2&t&&(l.Ab(2),l.sc("alt",l.nc(3,1,"SHARED.CLOSE")))},directives:[R.a],pipes:[R.d],styles:[""]}),t})(),Y=(()=>{class t{constructor(t){this.modal=t}closeModal(){this.modal.close()}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(X.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-invalid-phone"]],decls:12,vars:3,consts:[[1,"modal-header","j-modal-header"],["type","button",1,"close",3,"click"],["src","./assets/icons/close.svg",3,"alt"],[1,"modal-body","j-modal-body"],["translate","",1,"auth-heading","light","mb-3","mt-0"],["translate","",1,"m-0"],[1,"modal-footer","j-modal-footer"],["translate","","type","button",1,"btn","btn-static","btn-primary",3,"click"]],template:function(t,e){1&t&&(l.Wb(0,"div",0),l.Wb(1,"button",1),l.ic("click",(function(t){return e.closeModal()})),l.Rb(2,"img",2),l.mc(3,"translate"),l.Vb(),l.Vb(),l.Wb(4,"div",3),l.Wb(5,"h3",4),l.Qc(6,"AUTH.INVALID_PHONE.TITLE"),l.Vb(),l.Wb(7,"p",5),l.Qc(8,"AUTH.INVALID_PHONE.DESCRIPTION"),l.Vb(),l.Vb(),l.Wb(9,"div",6),l.Wb(10,"button",7),l.ic("click",(function(t){return e.closeModal()})),l.Qc(11,"SHARED.OK"),l.Vb(),l.Vb()),2&t&&(l.Ab(2),l.sc("alt",l.nc(3,1,"SHARED.CLOSE")))},directives:[R.a],pipes:[R.d],styles:[""]}),t})();var tt=i("bsP8");function et(t){const e=12==t.value.length;if(e)return null;let i={};return e||(i.length=!0),{iin:i}}var it=i("tkTF");const st=["iinInput"];let rt=(()=>{class t{constructor(t){this.authService=t,this.IIN="",this.submitted=new l.n,this.subs=new h.a,this.openIinForm=new n.k({iin:new n.h(this.IIN,[n.H.required,et])});const e=this.openIinForm.valueChanges.subscribe(t=>{this.isSubmitted=!1,this.errorText=""});this.subs.add(e)}ngOnDestroy(){this.subs.unsubscribe()}ngAfterViewInit(){this.iinInput.focus()}onSubmit(){return Object(c.a)(this,void 0,void 0,(function*(){this.isSubmitted=!0,this.openIinForm.valid?(this.isLoading=!0,this.submitted.emit({iin:this.iin})):this.validateIin(this.f.iin.errors)}))}get f(){return this.openIinForm.controls}get iin(){return this.f.iin.value}validateIin(t){t&&t.iin&&(t.iin.length?this.errorText="ERRORS.IIN_LENGTH":t.iin.date&&(this.errorText="ERRORS.IIN_DATE"))}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(d.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-auth-iin"]],viewQuery:function(t,e){var i;1&t&&l.Vc(st,!0),2&t&&l.Bc(i=l.jc())&&(e.iinInput=i.first)},outputs:{submitted:"submitted"},decls:9,vars:6,consts:[[3,"formGroup"],[1,"form-group"],[3,"formControl","hasError","errorText"],["iinInput",""],[1,"auth-submit"],["translate","","type","submit",1,"btn","btn-static","btn-primary","btn-lg",3,"jLoading","disabled","click"],["translate","","href","#","routerLink","/auth/login",1,"btn","btn-static","btn-link"]],template:function(t,e){1&t&&(l.Wb(0,"form",0),l.Wb(1,"div",1),l.Rb(2,"j-iin-input",2,3),l.Vb(),l.Wb(4,"div",4),l.Wb(5,"button",5),l.ic("click",(function(t){return e.onSubmit()})),l.Qc(6,"SHARED.CONTINUE"),l.Vb(),l.Wb(7,"a",6),l.Qc(8,"AUTH.LOGIN"),l.Vb(),l.Vb(),l.Vb()),2&t&&(l.rc("formGroup",e.openIinForm),l.Ab(2),l.rc("formControl",e.f.iin)("hasError",e.f.iin.errors&&e.isSubmitted)("errorText",e.errorText),l.Ab(3),l.rc("jLoading",e.isLoading)("disabled",e.isLoading))},directives:[n.J,n.u,n.l,it.a,n.t,n.i,R.a,I.a,r.f],styles:[""]}),t})();const nt={backdropClass:"backdrop_light",windowClass:"modal_light modal-auth",size:"md",centered:!0};let ot=(()=>{class t{constructor(t,e,i,s,r){this.router=t,this.route=e,this.navService=i,this.modalService=s,this.companyService=r,this.subs=new h.a,this.isFromAtf=!1,this.navService.triggerRegisterError("iin",!1),this.navService.triggerRegisterError("no-account",!1),this.navService.triggerRegisterError("no-email",!1),this.navService.triggerRegisterError("user-blocked",!1),this.navService.triggerRegisterError("phone-not-match",!1);const n=this.route.data.subscribe(t=>{this.title=t.title,this.authType=t.action}),o=this.route.queryParams.subscribe(t=>{this.isFromAtf=this.companyService.isFromAtf(t)});this.subs.add(n),this.subs.add(o)}ngOnDestroy(){this.subs.unsubscribe()}onSubmit(t){this.navigateToPhone(t.iin)}handleCheckIin(t,e){return Object(c.a)(this,void 0,void 0,(function*(){switch(t){case v.d.BLOCKED:this.navigateToUserBlocked();break;case v.d.DOES_NOT_EXIST:this.navigateToNoAccount();break;case v.d.INCORRECT_DATA:case v.d.INVALID_DATA:this.navigateToNoEmail();break;case v.d.ALREADY_REGISTERED:this.handleAlreadyRegistered(e);break;case v.d.CAN_REGISTER:this.handleCanRegister(e)}}))}handleAlreadyRegistered(t){switch(this.authType){case v.a.RESTORE:this.navigateToPhone(t);break;case v.a.REGISTER:this.showCanRestoreModal(t)}}showCanRegisterModal(t){return Object(c.a)(this,void 0,void 0,(function*(){const e=this.modalService.open(J,nt);try{yield e.result,this.navigateToRegisterPhone(t)}catch(i){}}))}showCanRestoreModal(t){return Object(c.a)(this,void 0,void 0,(function*(){const e=this.modalService.open(Z,nt);try{const i=yield e.result;"restore"==i?this.navigateToRestorePhone(t):"login"==i&&this.navigateToLogin()}catch(i){}}))}handleCanRegister(t){switch(this.authType){case v.a.REGISTER:this.navigateToPhone(t);break;case v.a.RESTORE:this.showCanRegisterModal(t)}}navigateToPhone(t,e=""){this.router.navigate([`${e}phone`],{relativeTo:this.route.parent,state:{iin:t}})}navigateToRegisterPhone(t){this.navigateToPhone(t,"../register/")}navigateToRestorePhone(t){this.navigateToPhone(t,"../restore/")}navigateToLogin(){this.router.navigate(["../login"],{relativeTo:this.route.parent})}navigateToNoAccount(){this.router.navigate(["no-account"],{relativeTo:this.route.parent})}navigateToNoEmail(){this.router.navigate(["no-email"],{relativeTo:this.route.parent})}navigateToUserBlocked(){this.router.navigate(["user-blocked"],{relativeTo:this.route.parent})}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.c),l.Qb(r.a),l.Qb(tt.a),l.Qb(X.q),l.Qb(f.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-register-iin"]],decls:7,vars:4,consts:[["translate","",1,"auth-heading","light","mb-3","mt-0"],[3,"submitted"]],template:function(t,e){1&t&&(l.Wb(0,"article"),l.Wb(1,"h3",0),l.Qc(2),l.Vb(),l.Wb(3,"p"),l.Qc(4),l.mc(5,"translate"),l.Vb(),l.Vb(),l.Wb(6,"j-auth-iin",1),l.ic("submitted",(function(t){return e.onSubmit(t)})),l.Vb()),2&t&&(l.Ab(2),l.Rc(e.title),l.Ab(2),l.Rc(l.nc(5,2,e.isFromAtf?"AUTH.REGISTER_SUBTITLE_ATF":"AUTH.REGISTER_SUBTITLE")))},directives:[R.a,rt],pipes:[R.d],styles:[""]}),t})();var at=i("S09V");const ct=["phoneInput"];let ht=(()=>{class t{constructor(t,e,i,s,r,o,a,c){this.router=t,this.route=e,this.maskedService=i,this.maskPipe=s,this.navService=r,this.authService=o,this.modalService=a,this.translateService=c,this.PHONE="",this.hasNoAccount=!1,this.countryCode={code:"+7",country:this.translateService.instant(`COUNTRIES.${v.b.KAZAKHSTAN}`),id:v.b.KAZAKHSTAN},this.subs=new h.a,this.registerPhoneForm=new n.k({phone:new n.h(this.PHONE,n.H.required)}),this.navService.triggerRegisterError("phone",!1),this.navService.triggerRegisterError("no-account",!1),this.navService.triggerRegisterError("no-email",!1),this.navService.triggerRegisterError("user-blocked",!1),this.navService.triggerRegisterError("phone-not-match",!1);const u=this.registerPhoneForm.valueChanges.subscribe(t=>{this.isSubmitted=!1}),l=this.route.data.subscribe(t=>{this.title=t.title,this.authType=t.action}),d=this.route.paramMap.pipe(Object(b.a)(()=>window.history.state)).subscribe(t=>{if(t.iin){this.iin=t.iin;const e=this.maskPipe.transform(t.phone,at.a.phone.mask);e&&this.f.phone.setValue(`${e}`)}else this.navigateToIin()});this.subs.add(u),this.subs.add(l),this.subs.add(d)}ngOnDestroy(){this.subs.unsubscribe()}onEnter(){this.phoneInput.blur(),this.onSubmit()}focus(){this.phoneInput.focus()}navigateFromModal(t){this.router.navigate([`/auth/${t}/sms`],{state:{phone:this.phone,iin:this.iin}})}onSubmit(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.isSubmitted=!0,this.registerPhoneForm.valid){this.isLoading=!0;try{this.phone=`${this.countryCode.code}${this.maskedService.getUnmaskedPhone(this.f.phone.value)}`,yield this.authService.checkPhone(this.phone),this.navigateToSms()}catch(t){switch(t.code){case u.b.INVALID_PHONE_FORMAT:yield this.showInvalidPhoneFormatModal();break;default:this.errorText=t.description}}finally{this.isLoading=!1}}else this.errorText="\u041d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"}))}get f(){return this.registerPhoneForm.controls}showInvalidPhoneFormatModal(){return Object(c.a)(this,void 0,void 0,(function*(){const t=this.modalService.open(Y,{centered:!0});try{yield t.result}catch(e){}finally{this.phoneInput.focus()}}))}navigateToSms(){this.router.navigate(["sms"],{relativeTo:this.route.parent,state:{phone:this.phone,iin:this.iin,countryCode:this.countryCode}})}navigateToIin(){this.router.navigate(["iin"],{relativeTo:this.route.parent})}onCountrySelected(t){this.countryCode=t}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.c),l.Qb(r.a),l.Qb(E.a),l.Qb(o.b),l.Qb(tt.a),l.Qb(d.a),l.Qb(X.q),l.Qb(R.e))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-register-phone"]],viewQuery:function(t,e){var i;1&t&&l.Vc(ct,!0),2&t&&l.Bc(i=l.jc())&&(e.phoneInput=i.first)},hostBindings:function(t,e){1&t&&l.ic("keyup.enter",(function(t){return e.onEnter()}))},decls:18,vars:11,consts:[["routerLink","../iin",1,"auth-backlink","j-link"],["name","arrowLeft","color","primary",1,"mr-2",3,"isStroke"],["translate",""],["translate","",1,"auth-heading","light","mb-3","mt-0"],[3,"formGroup"],[1,"phone-block"],[3,"countryCode","countrySelected"],["phonePrefixInput",""],[3,"autofocus","formControl","hasError","errorText","countryCode"],["phoneInput",""],[1,"auth-submit"],["translate","","type","button",1,"btn","btn-static","btn-primary","btn-lg",3,"jLoading","disabled","click"]],template:function(t,e){1&t&&(l.Wb(0,"a",0),l.Rb(1,"j-icon",1),l.Wb(2,"span",2),l.Qc(3,"SHARED.IIN"),l.Vb(),l.Vb(),l.Wb(4,"article"),l.Wb(5,"h3",3),l.Qc(6),l.Vb(),l.Wb(7,"p",2),l.Qc(8,"AUTH.PHONE.DESCRIPTION"),l.Vb(),l.Vb(),l.Wb(9,"form",4),l.Wb(10,"div",5),l.Wb(11,"j-phone-prefix-input",6,7),l.ic("countrySelected",(function(t){return e.onCountrySelected(t)})),l.Vb(),l.Rb(13,"j-phone-input",8,9),l.Vb(),l.Wb(15,"div",10),l.Wb(16,"button",11),l.ic("click",(function(t){return e.onSubmit()})),l.Qc(17,"SHARED.CONTINUE"),l.Vb(),l.Vb(),l.Vb()),2&t&&(l.Ab(1),l.rc("isStroke",!0),l.Ab(5),l.Rc(e.title),l.Ab(3),l.rc("formGroup",e.registerPhoneForm),l.Ab(2),l.rc("countryCode",e.countryCode),l.Ab(2),l.rc("autofocus",!0)("formControl",e.f.phone)("hasError",e.f.phone.errors&&e.isSubmitted)("errorText",e.errorText)("countryCode",e.countryCode),l.Ab(3),l.rc("jLoading",e.isLoading)("disabled",e.isLoading))},directives:[r.f,W.a,R.a,n.J,n.u,n.l,S.a,y.a,n.t,n.i,I.a],styles:[".phone-block[_ngcontent-%COMP%]{display:-webkit-box;display:flex}"]}),t})();function bt(t,e){if(1&t){const t=l.Xb();l.Wb(0,"a",3),l.ic("click",(function(e){return l.Fc(t),l.lc().navigateToPhone(e)})),l.Rb(1,"j-icon",4),l.Wb(2,"span",5),l.Qc(3,"SHARED.PHONE"),l.Vb(),l.Vb()}2&t&&(l.Ab(1),l.rc("isStroke",!0))}function ut(t,e){if(1&t){const t=l.Xb();l.Wb(0,"j-sms",6),l.ic("submitted",(function(e){return l.Fc(t),l.lc().onSmsSubmit(e)}))("failed",(function(e){return l.Fc(t),l.lc().onSmsFail()}))("loaded",(function(e){return l.Fc(t),l.lc().onFormLoaded()})),l.Vb()}if(2&t){const t=l.lc();l.rc("phone",t.phone)("countryCode",t.countryCode)("params",t.params)("headers",t.headerParams)}}function lt(t,e){1&t&&l.Rb(0,"j-animated-loading")}const dt={backdropClass:"backdrop_light",windowClass:"modal_light modal-auth",size:"md",centered:!0};let pt=(()=>{class t{constructor(t,e,i,s){this.authService=t,this.route=e,this.router=i,this.modalService=s,this.isFormLoaded=!1,this.subs=new h.a,this.subs.add(this.route.paramMap.pipe(Object(b.a)(()=>window.history.state)).subscribe(t=>{this.phone=t.phone,this.countryCode=t.countryCode,this.iin=t.iin,this.params={actionIds:[this.iin]}}));const r=this.route.data.subscribe(t=>{this.authType=t.action,this.headerParams={smsHeader:N.c[this.authType.toUpperCase()]}});this.subs.add(r)}ngOnDestroy(){this.subs.unsubscribe()}onSmsFail(){this.navigateToPhone()}onFormLoaded(){this.isFormLoaded=!0}onSmsSubmit(t){return Object(c.a)(this,void 0,void 0,(function*(){this.authService.setSmsToken(t),this.checkIinAndPhone()}))}navigateToPhone(t=null){var e;null===(e=t)||void 0===e||e.preventDefault(),this.router.navigate(["phone"],{relativeTo:this.route.parent,state:{iin:this.iin}})}checkIinAndPhone(){return Object(c.a)(this,void 0,void 0,(function*(){try{const t=yield this.authService.checkIinAndPhone(this.iin,this.phone);this.handleIinAndPhoneCheck(t.status)}catch(t){this.navigateToError(t)}}))}handleIinAndPhoneCheck(t){switch(t){case v.c.BLOCKED:this.navigateToUserBlocked();break;case v.c.DOES_NOT_EXIST:this.navigateToNoAccount();break;case v.c.INVALID_DATA:case v.c.INCORRECT_DATA:this.navigateToNoEmail();break;case v.c.DATA_MISMATCH:this.navigateToPhoneNotMatch();break;case v.c.ALREADY_REGISTERED:this.handleAlreadyRegistered();break;case v.c.CAN_REGISTER:this.handleCanRegister()}}navigateToError(t){this.router.navigate(["error"],{relativeTo:this.route.parent,state:{error:t,iin:this.iin}})}navigateToUserBlocked(){this.router.navigate(["user-blocked"],{relativeTo:this.route.parent})}navigateToEmail(t=""){this.router.navigate([`${t}email`],{relativeTo:this.route.parent,state:{phone:this.phone,iin:this.iin}})}navigateToNoAccount(){this.router.navigate(["no-account"],{relativeTo:this.route.parent})}navigateToNoEmail(){this.router.navigate(["no-email"],{relativeTo:this.route.parent})}navigateToPhoneNotMatch(){this.router.navigate(["phone-not-match"],{relativeTo:this.route.parent,state:{iin:this.iin,phone:this.phone}})}handleAlreadyRegistered(){switch(this.authType){case v.a.RESTORE:this.navigateToEmail();break;case v.a.REGISTER:this.showCanRestoreModal()}}showCanRegisterModal(){return Object(c.a)(this,void 0,void 0,(function*(){const t=this.modalService.open(J,dt);try{yield t.result,this.navigateToRegisterEmail()}catch(e){this.navigateToPhone()}}))}showCanRestoreModal(){return Object(c.a)(this,void 0,void 0,(function*(){const t=this.modalService.open(Z,dt);try{const e=yield t.result;"restore"===e?this.navigateToRestoreEmail():"login"===e&&this.navigateToLogin()}catch(e){this.navigateToPhone()}}))}handleCanRegister(){switch(this.authType){case v.a.REGISTER:this.navigateToEmail();break;case v.a.RESTORE:this.showCanRegisterModal()}}navigateToRegisterEmail(){this.navigateToEmail("../register/")}navigateToRestoreEmail(){this.navigateToEmail("../restore/")}navigateToLogin(){this.router.navigate(["../login"],{relativeTo:this.route.parent})}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(d.a),l.Qb(r.a),l.Qb(r.c),l.Qb(X.q))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-register-sms"]],decls:3,vars:3,consts:[["href","#","class","auth-backlink j-link",3,"click",4,"ngIf"],[3,"phone","countryCode","params","headers","submitted","failed","loaded",4,"ngIf"],[4,"ngIf"],["href","#",1,"auth-backlink","j-link",3,"click"],["name","arrowLeft","color","primary",1,"mr-2",3,"isStroke"],["translate",""],[3,"phone","countryCode","params","headers","submitted","failed","loaded"]],template:function(t,e){1&t&&(l.Oc(0,bt,4,1,"a",0),l.Oc(1,ut,1,4,"j-sms",1),l.Oc(2,lt,1,0,"j-animated-loading",2)),2&t&&(l.rc("ngIf",e.isFormLoaded),l.Ab(1),l.rc("ngIf",e.params),l.Ab(1),l.rc("ngIf",!e.isFormLoaded))},directives:[s.u,W.a,R.a,D.a,P.a],styles:[""]}),t})();var mt=i("TwVa"),gt=i("gN/K"),Tt=i("bSvt");const vt=["codeInput"];function Et(t,e){if(1&t){const t=l.Xb();l.Wb(0,"a",14),l.ic("click",(function(e){return l.Fc(t),l.lc().navigateToPhone(e)})),l.Rb(1,"j-icon",15),l.Wb(2,"span",16),l.Qc(3,"SHARED.PHONE"),l.Vb(),l.Vb()}2&t&&(l.Ab(1),l.rc("isStroke",!0))}function ft(t,e){if(1&t){const t=l.Xb();l.Wb(0,"j-sms-error",17),l.ic("codeRequested",(function(e){return l.Fc(t),l.lc().requestEmail()})),l.Vb()}if(2&t){const t=l.lc();l.rc("errorType",t.errorTypes.FORBIDDEN)("isLoading",t.isLoading)("destinationValue",t.email)("timerValue",t.timerValue)("isTimerRunning",t.isTimerRunning)}}function Rt(t,e){if(1&t){const t=l.Xb();l.Wb(0,"j-sms-error",17),l.ic("codeRequested",(function(e){return l.Fc(t),l.lc().requestEmail()})),l.Vb()}if(2&t){const t=l.lc();l.rc("errorType",t.errorTypes.FORBIDDEN)("isLoading",t.isLoading)("destinationValue",t.email)("timerValue",t.blockedTimerValue)("isTimerRunning",t.isBlockedTimerRunning)}}function St(t,e){if(1&t){const t=l.Xb();l.Wb(0,"j-sms-error",18),l.ic("codeRequested",(function(e){return l.Fc(t),l.lc().requestEmail()})),l.Vb()}if(2&t){const t=l.lc();l.rc("errorType",t.errorTypes.UNKNOWN)("isLoading",t.isLoading)("destinationValue",t.email)("isTimerRunning",t.isBlockedTimerRunning)("timerValue",t.blockedTimerValue)}}function yt(t,e){1&t&&l.Rb(0,"j-animated-loading")}let At=(()=>{class t{constructor(t,e,i,s){this.route=t,this.auth=e,this.router=i,this.modalService=s,this.smsCodeLength=mt.k,this.timerMaxValue=mt.n,this.expireTimerMaxValue=300,this.errorTypes=mt.l,this.isReady=!1,this.currentTab=mt.m.FORM,this.authTabs=mt.m,this.subs=new h.a,this.emailCodeForm=new n.k({emailCode:new n.h("",n.H.required)});const r=this.route.paramMap.pipe(Object(b.a)(()=>window.history.state)).subscribe(t=>{this.phone=t.phone,this.iin=t.iin,this.requestEmail()}),o=this.emailCodeForm.valueChanges.subscribe(t=>{this.isSubmitted=!1,t.emailCode&&t.emailCode.length===this.smsCodeLength&&this.onSubmit()});this.subs.add(r),this.subs.add(o)}ngOnDestroy(){this.subs.unsubscribe()}openContactModal(){this.modalService.open($,{centered:!0})}setTab(t){this.currentTab=t}get f(){return this.emailCodeForm.controls}requestEmail(){return Object(c.a)(this,void 0,void 0,(function*(){this.f.emailCode.setValue(""),this.errorText="",this.hasError=!1;try{const t=yield this.auth.requestEmail(this.phone,this.iin);this.setTab(this.authTabs.FORM),this.email=t.email.replace(/\*/gm,"\u2022"),this.codeInput.focus()}catch(t){switch(t.code){case u.b.ARGUMENT_MISSING:this.router.navigate(["phone"],{relativeTo:this.route.parent});break;case u.b.RESOURCE_BLOCKED:t.data&&t.data.millisecondsLeft&&this.startBlockedTimer(t.data.millisecondsLeft),this.setTab(this.authTabs.FORBIDDEN_BLOCKED);break;default:this.setTab(this.authTabs.ERRORED)}}finally{this.isReady=!0}}))}navigateToPhone(t=null){var e;null===(e=t)||void 0===e||e.preventDefault(),this.router.navigate(["phone"],{relativeTo:this.route.parent,state:{iin:this.iin,phone:this.phone}})}onSubmit(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.isSubmitted=!0,this.emailCodeForm.valid){this.isLoading=!0;const e=this.f.emailCode.value;try{yield this.auth.submitEmail(e,this.phone,this.iin),this.router.navigate(["password"],{relativeTo:this.route.parent,state:{phone:this.phone,iin:this.iin}})}catch(t){switch(this.hasError=!0,t.code){case u.b.ARGUMENT_MISSING:this.router.navigate(["phone"],{relativeTo:this.route.parent});break;case u.b.RESOURCE_BLOCKED:case u.b.INVALID_CODE:let e;if(t.data&&t.data.triesLeft)switch(e=t.data.triesLeft,this.errorText=`\u0412\u044b \u0432\u0432\u0435\u043b\u0438 \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u0434. \u0423 \u0432\u0430\u0441 \u043e\u0441\u0442\u0430\u043b${1===e?"\u0430":"\u043e"}\u0441\u044c ${e}`,e%20){case 1:this.errorText+=" \u043f\u043e\u043f\u044b\u0442\u043a\u0430.";break;case 2:case 3:case 4:this.errorText+=" \u043f\u043e\u043f\u044b\u0442\u043a\u0438.";break;default:this.errorText+=" \u043f\u043e\u043f\u044b\u0442\u043e\u043a."}else this.startTimer(),this.setTab(this.authTabs.FORBIDDEN);break;case u.b.FORBIDDEN:this.startTimer(),this.setTab(this.authTabs.FORBIDDEN);break;case u.b.PHONE_TOKEN_EXPIRED:case u.b.TOKEN_EXPIRED:const i=this.modalService.open(z,{centered:!0});try{yield i.result}catch(t){}finally{this.router.navigate(["iin"],{relativeTo:this.route.parent,state:{iin:this.iin}})}break;default:this.errorText=t.description}this.codeInput.triggerHelperAnimation()}finally{this.isLoading=!1}}}))}startTimer(t=this.timerMaxValue){this.isTimerRunning=!0,this.timerValue=t,this.timer=setInterval(()=>{this.timerValue--,0===this.timerValue&&this.stopTimer()},1e3)}stopTimer(){clearInterval(this.timer),this.isTimerRunning=!1}startBlockedTimer(t){this.blockedTimerValue=Math.ceil(t/1e3),this.isBlockedTimerRunning=!0,this.blockedTimer=setInterval(()=>{this.blockedTimerValue--,0===this.blockedTimerValue&&this.stopBlockedTimer()},1e3)}stopBlockedTimer(){clearInterval(this.blockedTimer),this.isBlockedTimerRunning=!1,this.blockedTimerValue=null}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a),l.Qb(d.a),l.Qb(r.c),l.Qb(X.q))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-register-email"]],viewQuery:function(t,e){var i;1&t&&l.Vc(vt,!0),2&t&&l.Bc(i=l.jc())&&(e.codeInput=i.first)},decls:21,vars:15,consts:[["href","#","class","auth-backlink j-link",3,"click",4,"ngIf"],[3,"hidden"],["translate","",1,"auth-heading","light","mb-3","mt-0"],["translate","",1,"mb-4"],[1,"text-nowrap"],[1,"my-4",3,"formGroup","ngSubmit"],[1,"my-4",3,"autofocus","hasError","errorText","formControl"],["codeInput",""],[1,"auth-submit"],["translate","","type","submit",1,"btn","btn-static","btn-primary","btn-lg",3,"jLoading","disabled"],["translate","","type","button",1,"btn","btn-static","btn-link",3,"click"],["destinationLabel","AUTH.EMAIL.DESTINATION",3,"errorType","isLoading","destinationValue","timerValue","isTimerRunning","codeRequested",4,"ngIf"],["destinationLabel","AUTH.EMAIL.DESTINATION",3,"errorType","isLoading","destinationValue","isTimerRunning","timerValue","codeRequested",4,"ngIf"],[4,"ngIf"],["href","#",1,"auth-backlink","j-link",3,"click"],["name","arrowLeft","color","primary",1,"mr-2",3,"isStroke"],["translate",""],["destinationLabel","AUTH.EMAIL.DESTINATION",3,"errorType","isLoading","destinationValue","timerValue","isTimerRunning","codeRequested"],["destinationLabel","AUTH.EMAIL.DESTINATION",3,"errorType","isLoading","destinationValue","isTimerRunning","timerValue","codeRequested"]],template:function(t,e){1&t&&(l.Oc(0,Et,4,1,"a",0),l.Wb(1,"div",1),l.Wb(2,"h3",2),l.Qc(3,"AUTH.EMAIL.TITLE"),l.Vb(),l.Wb(4,"div",1),l.Wb(5,"p",3),l.Qc(6," AUTH.EMAIL.DESCRIPTION "),l.Wb(7,"strong",4),l.Qc(8),l.Vb(),l.Vb(),l.Wb(9,"form",5),l.ic("ngSubmit",(function(t){return e.onSubmit()})),l.Rb(10,"j-sms-input",6,7),l.Wb(12,"div",8),l.Wb(13,"button",9),l.Qc(14,"SHARED.CONTINUE"),l.Vb(),l.Wb(15,"button",10),l.ic("click",(function(t){return e.openContactModal()})),l.Qc(16,"AUTH.EMAIL.NO_CODE_RECEIVED"),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Oc(17,ft,1,5,"j-sms-error",11),l.Oc(18,Rt,1,5,"j-sms-error",11),l.Oc(19,St,1,5,"j-sms-error",12),l.Vb(),l.Oc(20,yt,1,0,"j-animated-loading",13)),2&t&&(l.rc("ngIf",e.isReady),l.Ab(1),l.rc("hidden",!e.isReady),l.Ab(3),l.rc("hidden",e.currentTab!=e.authTabs.FORM),l.Ab(4),l.Rc(e.email),l.Ab(1),l.rc("formGroup",e.emailCodeForm),l.Ab(1),l.rc("autofocus",!0)("hasError",e.hasError)("errorText",e.errorText)("formControl",e.f.emailCode),l.Ab(3),l.rc("jLoading",e.isLoading)("disabled",e.isLoading),l.Ab(4),l.rc("ngIf",e.currentTab==e.authTabs.FORBIDDEN),l.Ab(1),l.rc("ngIf",e.currentTab==e.authTabs.FORBIDDEN_BLOCKED),l.Ab(1),l.rc("ngIf",e.currentTab==e.authTabs.ERRORED),l.Ab(1),l.rc("ngIf",!e.isReady))},directives:[s.u,R.a,n.J,n.u,n.l,gt.a,n.t,n.i,I.a,W.a,Tt.a,P.a],styles:[""]}),t})();var It=i("kUBv");let Ot=(()=>{class t{constructor(t,e,i,s){this.auth=t,this.router=e,this.route=i,this.modalService=s,this.isLoading=!1,this.subs=new h.a;const r=this.route.paramMap.pipe(Object(b.a)(()=>window.history.state)).subscribe(t=>{this.phone=t.phone,this.iin=t.iin,this.iin?this.phone||this.navigateToPhone():this.navigateToIin()}),n=this.route.data.subscribe(t=>{this.authType=t.action});this.subs.add(r),this.subs.add(n)}ngOnDestroy(){this.subs.unsubscribe()}onSubmit(t){return Object(c.a)(this,void 0,void 0,(function*(){this.isLoading=!0;try{this.authType==v.a.RESTORE?yield this.auth.restore(this.phone,t.newPassword,this.iin):yield this.auth.register(this.phone,t.newPassword,this.iin),this.navigateToResult(t.newPassword)}catch(e){this.mapError(e)}finally{this.isLoading=!1}}))}mapError(t){return Object(c.a)(this,void 0,void 0,(function*(){switch(t.code){case u.b.RESOURCE_NOT_FOUND:case u.b.FORBIDDEN:case u.b.RESOURCE_EXISTS:this.navigateToPhoneNotMatch();break;case u.b.PHONE_TOKEN_EXPIRED:case u.b.TOKEN_EXPIRED:this.showExpiredModal();break;case u.b.INVALID_PHONE_FORMAT:case u.b.ARGUMENT_MISSING:this.navigateToPhone();break;default:this.errorText=t.description}}))}showExpiredModal(){return Object(c.a)(this,void 0,void 0,(function*(){const t=this.modalService.open(z,{centered:!0});try{yield t.result}catch(e){}finally{this.navigateToIin()}}))}navigateToIin(){this.router.navigate(["iin"],{relativeTo:this.route.parent,state:{iin:this.iin||""}})}navigateToPhone(){this.router.navigate(["phone"],{relativeTo:this.route.parent,state:{iin:this.iin}})}navigateToResult(t){this.router.navigate(["result"],{relativeTo:this.route.parent,state:{phone:this.phone,password:t}})}navigateToPhoneNotMatch(){this.router.navigate(["phone-not-match"],{relativeTo:this.route.parent})}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(d.a),l.Qb(r.c),l.Qb(r.a),l.Qb(X.q))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-register-password"]],decls:7,vars:2,consts:[["translate","",1,"auth-heading","light","mb-3","mt-0"],["translate","",1,"mb-4"],[1,"my-4"],[3,"isLoading","errorText","submitted"]],template:function(t,e){1&t&&(l.Wb(0,"article"),l.Wb(1,"h3",0),l.Qc(2,"AUTH.PASSWORD.TITLE"),l.Vb(),l.Wb(3,"p",1),l.Qc(4,"AUTH.PASSWORD.DESCRIPTION"),l.Vb(),l.Wb(5,"div",2),l.Wb(6,"j-new-password",3),l.ic("submitted",(function(t){return e.onSubmit(t)})),l.Vb(),l.Vb(),l.Vb()),2&t&&(l.Ab(6),l.rc("isLoading",e.isLoading)("errorText",e.errorText))},directives:[R.a,It.a],styles:[""]}),t})(),kt=(()=>{class t{constructor(t,e,i,s){this.route=t,this.router=e,this.auth=i,this.tokenService=s,this.isLoading=!1,this.authTypes=v.a,this.subs=new h.a;const r=this.route.paramMap.pipe(Object(b.a)(()=>window.history.state)).subscribe(t=>{this.phone=t.phone,this.password=t.password}),n=this.route.data.subscribe(t=>{this.authType=t.action});this.subs.add(r),this.subs.add(n)}ngOnDestroy(){this.subs.unsubscribe()}login(t){return Object(c.a)(this,void 0,void 0,(function*(){t.preventDefault(),this.isLoading=!0;try{const t=yield this.auth.requestDevice(this.phone);this.tokenService.setDeviceToken(t.signature,this.password),yield this.auth.login(this.phone,this.password),this.router.navigateByUrl("/")}catch(e){this.router.navigate(["/auth/login"],{state:{error:e.description||e}})}finally{this.isLoading=!1}}))}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a),l.Qb(r.c),l.Qb(d.a),l.Qb(p.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-register-result"]],decls:14,vars:3,consts:[[1,"auth-heading","light","mb-3","mt-0"],["translate",""],[1,"mb-4"],[1,"auth-submit"],["translate","",1,"btn","btn-static","btn-primary",3,"disabled","jLoading","click"]],template:function(t,e){1&t&&(l.Wb(0,"article"),l.Wb(1,"h3",0),l.Wb(2,"span",1),l.Qc(3,"SHARED.DONE"),l.Vb(),l.Qc(4,"! "),l.Vb(),l.Wb(5,"p",2),l.Wb(6,"span",1),l.Qc(7),l.Vb(),l.Rb(8,"br"),l.Wb(9,"span",1),l.Qc(10,"AUTH.RESULT.DESCRIPTION"),l.Vb(),l.Vb(),l.Vb(),l.Wb(11,"div",3),l.Wb(12,"button",4),l.ic("click",(function(t){return e.login(t)})),l.Qc(13,"AUTH.LOGIN"),l.Vb(),l.Vb()),2&t&&(l.Ab(7),l.Rc(e.authType==e.authTypes.REGISTER?"AUTH.RESULT.REGISTERED":"AUTH.RESULT.RESTORED"),l.Ab(5),l.rc("disabled",e.isLoading)("jLoading",e.isLoading))},directives:[R.a,I.a],styles:[""]}),t})(),Ct=(()=>{class t{constructor(t){this.navService=t,this.translateParams={tel:"7711"},this.navService.triggerRegisterError("iin",!0),this.navService.triggerRegisterError("no-account",!0)}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(tt.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-no-account"]],decls:13,vars:5,consts:[["routerLink","../iin",1,"j-link"],["name","arrowLeft","color","primary",1,"mr-2",3,"isStroke"],["translate",""],["translate","",1,"light","mb-3","mt-0"],[1,"mb-4",3,"innerHTML"],["routerLink","../iin","translate","",1,"btn","btn-static","btn-primary"],["translate","","href","https://jysanbank.kz/ru/page/contacts","target","_blank",1,"btn","btn-static","btn-link"]],template:function(t,e){1&t&&(l.Wb(0,"a",0),l.Rb(1,"j-icon",1),l.Wb(2,"span",2),l.Qc(3,"SHARED.BACK"),l.Vb(),l.Vb(),l.Wb(4,"article"),l.Wb(5,"h3",3),l.Qc(6,"AUTH.NO_ACCOUNT.TITLE"),l.Vb(),l.Rb(7,"p",4),l.mc(8,"translate"),l.Wb(9,"a",5),l.Qc(10,"AUTH.NO_ACCOUNT.LINK"),l.Vb(),l.Wb(11,"a",6),l.Qc(12,"AUTH.NO_ACCOUNT.CONTACTS"),l.Vb(),l.Vb()),2&t&&(l.Ab(1),l.rc("isStroke",!0),l.Ab(6),l.rc("innerHTML",l.oc(8,2,"AUTH.NO_ACCOUNT.DESCRIPTION",e.translateParams),l.Gc))},directives:[r.f,W.a,R.a],pipes:[R.d],styles:[""]}),t})(),wt=(()=>{class t{constructor(t){this.navService=t,this.navService.triggerRegisterError("iin",!0),this.navService.triggerRegisterError("no-email",!0)}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(tt.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-no-email"]],decls:11,vars:4,consts:[["routerLink","../phone",1,"j-link"],["name","arrowLeft","color","primary",1,"mr-2",3,"isStroke"],["translate",""],["translate","",1,"light","mb-3","mt-0"],[1,"mb-4",3,"innerHTML"],["translate","","href","https://jysanbank.kz/ru/page/contacts","target","_blank",1,"btn","btn-static","btn-primary"]],template:function(t,e){1&t&&(l.Wb(0,"a",0),l.Rb(1,"j-icon",1),l.Wb(2,"span",2),l.Qc(3,"SHARED.PHONE"),l.Vb(),l.Vb(),l.Wb(4,"article"),l.Wb(5,"h3",3),l.Qc(6,"AUTH.NO_EMAIL.TITLE"),l.Vb(),l.Rb(7,"p",4),l.mc(8,"translate"),l.Wb(9,"a",5),l.Qc(10,"AUTH.NO_EMAIL.LINK"),l.Vb(),l.Vb()),2&t&&(l.Ab(1),l.rc("isStroke",!0),l.Ab(6),l.rc("innerHTML",l.nc(8,2,"AUTH.NO_EMAIL.DESCRIPTION"),l.Gc))},directives:[r.f,W.a,R.a],pipes:[R.d],styles:[""]}),t})(),Vt=(()=>{class t{constructor(t){this.navService=t,this.translateParams={tel:"7711"},this.navService.triggerRegisterError("iin",!0),this.navService.triggerRegisterError("user-blocked",!0)}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(tt.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-user-blocked"]],decls:9,vars:5,consts:[["routerLink","../iin",1,"j-link"],["name","arrowLeft","color","primary",1,"mr-2",3,"isStroke"],["translate",""],["translate","",1,"light","mb-3","mt-0"],[1,"mb-4",3,"innerHTML"]],template:function(t,e){1&t&&(l.Wb(0,"a",0),l.Rb(1,"j-icon",1),l.Wb(2,"span",2),l.Qc(3,"SHARED.IIN"),l.Vb(),l.Vb(),l.Wb(4,"article"),l.Wb(5,"h3",3),l.Qc(6,"AUTH.USER_BLOCKED.TITLE"),l.Vb(),l.Rb(7,"p",4),l.mc(8,"translate"),l.Vb()),2&t&&(l.Ab(1),l.rc("isStroke",!0),l.Ab(6),l.rc("innerHTML",l.oc(8,2,"AUTH.USER_BLOCKED.DESCRIPTION",e.translateParams),l.Gc))},directives:[r.f,W.a,R.a],pipes:[R.d],styles:[""]}),t})(),Lt=(()=>{class t{constructor(t,e,i){this.router=t,this.route=e,this.navService=i,this.subscription=new h.a,this.navService.triggerRegisterError("phone",!0),this.navService.triggerRegisterError("phone-not-match",!0),this.subscription.add(this.route.paramMap.pipe(Object(b.a)(()=>window.history.state)).subscribe(t=>{this.phone=t.phone,this.iin=t.iin}))}ngOnDestroy(){this.subscription.unsubscribe()}navigateToPhone(t=null){var e;null===(e=t)||void 0===e||e.preventDefault(),this.router.navigate(["phone"],{relativeTo:this.route.parent,state:{iin:this.iin,phone:this.phone}})}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.c),l.Qb(r.a),l.Qb(tt.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-phone-not-match"]],decls:11,vars:4,consts:[["href","#",1,"j-link",3,"click"],["name","arrowLeft","color","primary",1,"mr-2",3,"isStroke"],["translate",""],["translate","",1,"light","mb-3","mt-0"],[1,"mb-4",3,"innerHTML"],["href","#","translate","",1,"btn","btn-static","btn-primary",3,"click"]],template:function(t,e){1&t&&(l.Wb(0,"a",0),l.ic("click",(function(t){return e.navigateToPhone(t)})),l.Rb(1,"j-icon",1),l.Wb(2,"span",2),l.Qc(3,"SHARED.PHONE"),l.Vb(),l.Vb(),l.Wb(4,"article"),l.Wb(5,"h3",3),l.Qc(6,"AUTH.PHONE_NOT_MATCH.TITLE"),l.Vb(),l.Rb(7,"p",4),l.mc(8,"translate"),l.Wb(9,"a",5),l.ic("click",(function(t){return e.navigateToPhone(t)})),l.Qc(10,"AUTH.PHONE_NOT_MATCH.LINK"),l.Vb(),l.Vb()),2&t&&(l.Ab(1),l.rc("isStroke",!0),l.Ab(6),l.rc("innerHTML",l.nc(8,2,"AUTH.PHONE_NOT_MATCH.DESCRIPTION"),l.Gc))},directives:[W.a,R.a],pipes:[R.d],styles:[""]}),t})(),Nt=(()=>{class t{constructor(t){this.route=t,this.subscription=new h.a;const e=this.route.data.subscribe(t=>{this.authType=t.action}),i=this.route.paramMap.pipe(Object(b.a)(()=>window.history.state)).subscribe(t=>{this.error=t.error,this.iin=t.iin});this.subscription.add(i),this.subscription.add(e)}get description(){return this.authType===v.a.REGISTER?"AUTH.ERROR.DESCRIPTION_REGISTER":"AUTH.ERROR.DESCRIPTION_RESTORE"}get state(){return{iin:this.iin}}ngOnDestroy(){this.subscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["j-register-error"]],decls:12,vars:9,consts:[["routerLink","../iin",1,"j-link",3,"state"],["name","arrowLeft","color","primary",1,"mr-2",3,"isStroke"],["translate",""],["translate","",1,"light","mb-3","mt-0"],[1,"mb-4",3,"innerHTML"],["routerLink","../iin",1,"btn","btn-primary",3,"state"]],template:function(t,e){1&t&&(l.Wb(0,"a",0),l.Rb(1,"j-icon",1),l.Wb(2,"span",2),l.Qc(3,"SHARED.IIN"),l.Vb(),l.Vb(),l.Wb(4,"article"),l.Wb(5,"h3",3),l.Qc(6,"AUTH.ERROR.TITLE"),l.Vb(),l.Rb(7,"p",4),l.mc(8,"translate"),l.Wb(9,"a",5),l.Qc(10),l.mc(11,"translate"),l.Vb(),l.Vb()),2&t&&(l.rc("state",e.state),l.Ab(1),l.rc("isStroke",!0),l.Ab(6),l.rc("innerHTML",l.nc(8,5,e.description),l.Gc),l.Ab(2),l.rc("state",e.state),l.Ab(1),l.Sc(" ",l.nc(11,7,"SHARED.BACK")," "))},directives:[r.f,W.a,R.a],pipes:[R.d],styles:[""]}),t})();const Dt=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:x},{path:"register",component:q,children:[{path:"",redirectTo:"iin"},{path:"iin",component:ot,data:{title:"AUTH.REGISTER_TITLE",action:v.a.REGISTER}},{path:"no-account",component:Ct},{path:"no-email",component:wt},{path:"user-blocked",component:Vt},{path:"phone",component:ht,data:{title:"SHARED.PHONE",action:v.a.REGISTER}},{path:"sms",component:pt,data:{action:v.a.REGISTER}},{path:"phone-not-match",component:Lt},{path:"email",component:At},{path:"password",component:Ot,data:{action:v.a.REGISTER}},{path:"error",component:Nt,data:{action:v.a.REGISTER}},{path:"result",component:kt,data:{action:v.a.REGISTER}}]},{path:"restore",component:q,children:[{path:"",redirectTo:"iin"},{path:"iin",component:ot,data:{title:"AUTH.RESTORE",action:v.a.RESTORE}},{path:"no-account",component:Ct},{path:"no-email",component:wt},{path:"user-blocked",component:Vt},{path:"phone",component:ht,data:{title:"SHARED.PHONE",action:v.a.RESTORE}},{path:"sms",component:pt,data:{action:v.a.RESTORE}},{path:"phone-not-match",component:Lt},{path:"email",component:At},{path:"password",component:Ot,data:{action:v.a.RESTORE}},{path:"error",component:Nt,data:{action:v.a.RESTORE}},{path:"result",component:kt,data:{action:v.a.RESTORE}}]}];let Wt=(()=>{class t{}return t.\u0275mod=l.Ob({type:t}),t.\u0275inj=l.Nb({factory:function(e){return new(e||t)},imports:[[r.g.forChild(Dt)],r.g]}),t})();i.d(e,"AuthModule",(function(){return Pt}));let Pt=(()=>{class t{}return t.\u0275mod=l.Ob({type:t}),t.\u0275inj=l.Nb({factory:function(e){return new(e||t)},providers:[{provide:o.b,useClass:o.b}],imports:[[s.c,Wt,n.n,r.g,n.D,a.a,o.c]]}),t})()}}]);