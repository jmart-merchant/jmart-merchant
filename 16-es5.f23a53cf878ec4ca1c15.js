function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],o=!0,i=!1,r=void 0;try{for(var c,a=t[Symbol.iterator]();!(o=(c=a.next()).done)&&(n.push(c.value),!e||n.length!==e);o=!0);}catch(l){i=!0,r=l}finally{try{o||null==a.return||a.return()}finally{if(i)throw r}}return n}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{KlkT:function(t,e,n){"use strict";n.r(e);var o=n("PCNd"),i=n("tyNb"),r=n("mrSG"),c=n("2Vo4"),a=n("XNiG"),l=function(){function t(e){_classCallCheck(this,t),this.removing$=new c.a(void 0),this.destroy$=new a.a,this.id=e.id,this.data=e}return _createClass(t,[{key:"destroy",value:function(){this.destroy$.next(Date.now()),this.destroy$.complete(),this.removing$.complete(),this.cancelRemove$&&this.cancelRemove$.complete(),this.deleteWith=void 0}}]),t}(),s=n("3Pt+"),b=n("+/Tu"),u=n("eEJz"),p=n("SMdK"),d=n("YMfE"),m=n("quSY"),f=n("LRne"),h=n("EY2u"),v=n("Kj3r"),y=n("eIep"),g=n("1G5W"),k=n("fXoL"),E=n("1kSV"),R=n("B1Ao"),j=n("mR7B"),x=n("Eajh"),S=n("0mgW"),O=n("sYmb"),w=n("e8Ap"),C=n("ofXK"),A=n("4oqK"),T=n("QfCG"),V=n("2aJj"),W=n("13E/"),P=n("tmjD"),_=n("SfXN"),I=n("M6pS"),D=n("jRXw"),$=n("zN9f"),M=n("oa9T"),Y=n("zOyH"),L=n("jMpN"),G=n("Ya7Z"),F=n("Kx0l"),Q=n("ScFe"),N=["formDirective"];function B(t,e){if(1&t){var n=k.Xb();k.Wb(0,"button",27),k.ic("click",(function(t){return k.Hc(n),k.mc().onDelete()})),k.Rb(1,"i",28),k.nc(2,"svgPath"),k.Vb()}2&t&&(k.Ab(1),k.tc("inlineSVG",k.oc(2,1,"bucket")))}function U(t,e){if(1&t){var n=k.Xb();k.Wb(0,"div",35),k.Wb(1,"button",36),k.ic("click",(function(t){k.Hc(n);var e=k.mc().index;return k.mc().deleteAccount(e)})),k.Rb(2,"i",28),k.nc(3,"svgPath"),k.Vb(),k.Vb()}2&t&&(k.Ab(2),k.tc("inlineSVG",k.oc(3,1,"bucket")))}function H(t,e){if(1&t&&(k.Wb(0,"div",29),k.Wb(1,"div",30),k.Wb(2,"div",31),k.Wb(3,"j-form-field"),k.Rb(4,"j-entity-logo",32),k.nc(5,"bankFromAccount"),k.Wb(6,"j-label"),k.Sc(7,"\u0421\u0447\u0435\u0442"),k.Vb(),k.Rb(8,"input",33),k.Rb(9,"j-error",13),k.Vb(),k.Vb(),k.Qc(10,U,4,3,"div",34),k.Vb(),k.Vb()),2&t){var n=e.index,o=k.mc();k.Ab(4),k.tc("name",k.oc(5,8,"KZ"+o.fGroup.get("accounts").controls[n].value)),k.Ab(4),k.tc("jShadow",o.masks.bankAccount.shadow)("dropSpecialCharacters",!0)("mask",o.masks.bankAccount.mask)("formControl",o.fGroup.get("accounts").controls[n]),k.Ab(1),k.tc("control",o.fGroup.get("accounts").controls[n])("errorMessages",o.errors.bankAccount),k.Ab(1),k.tc("ngIf",n)}}function X(t,e){if(1&t&&(k.Wb(0,"div",37),k.Sc(1),k.Vb()),2&t){var n=k.mc();k.Ab(1),k.Uc(" ",n.errorText," ")}}function K(t,e){1&t&&k.Rb(0,"j-kbe-info")}var q,z,J,Z=function(t){return t.create="create",t.delete="delete",t.update="update",t}({}),tt=((q=function(){function t(e,n,o,i,r,a){_classCallCheck(this,t),this.modal=e,this.recipients=n,this.maskService=o,this.fb=i,this.bankFromAccount=r,this.paymentsService=a,this.checkingCounterParty$=new c.a(void 0),this.updateInProgress$=new c.a(void 0),this.masks={},this.errors=p.b,this.subs=new m.a}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;if(this.getMaskConfig(),this.fGroup=this.createForm(this.item),!this.editMode){var e=this.fGroup.controls.iinOrBin;this.subs.add(e.valueChanges.pipe(Object(v.a)(200),Object(y.a)((function(n){return e.valid?(t.checkingCounterParty$.next(n),Object(f.a)(t.recipients.checkCounterParty(n)).pipe(Object(g.a)(e.valueChanges))):(t.checkingCounterParty$.next(null),h.a)}))).subscribe((function(e){e&&t.checkingCounterParty$.getValue()===e.bin&&(t.fGroup.patchValue({name:e.name}),t.checkingCounterParty$.next(null)),t.checkingCounterParty$.next(null)})))}}},{key:"createForm",value:function(t){var e,n,o,i,r,c=this;return this.fb.group({iinOrBin:[{value:(null===(e=t)||void 0===e?void 0:e.iinOrBin)||"",disabled:this.editMode},[s.H.required,s.H.minLength(12)]],kbeCode:[null===(o=null===(n=t)||void 0===n?void 0:n.kbe)||void 0===o?void 0:o.code,[s.H.required,p.a.kbe]],name:[(null===(i=t)||void 0===i?void 0:i.name)||"",[s.H.required,s.H.maxLength(250)]],accounts:this.fb.array(((null===(r=t)||void 0===r?void 0:r.accounts)||[{iban:""}]).map((function(t){return c.getAccountControlConfig(t)})))})}},{key:"addAccount",value:function(){this.updateInProgress$.getValue()||this.fGroup.controls.accounts.push(this.fb.control("",this.getAccountControlConfig()[1]))}},{key:"deleteAccount",value:function(t){this.updateInProgress$.getValue()||this.fGroup.controls.accounts.removeAt(t)}},{key:"onCancel",value:function(){this.updateInProgress$.getValue()||this.modal.close()}},{key:"onSubmit",value:function(){if(!this.updateInProgress$.getValue())if(this.fGroup.invalid)this.emulateSubmit();else{var t=this.prepareBody();this.processRequest(t)}}},{key:"onDelete",value:function(){this.modal.close({payload:this.item,type:Z.delete})}},{key:"getAccountControlConfig",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[e.iban,[s.H.required,function(e){return t.paymentsService.bankExist(Object(d.ibanPrefix)(e.value||"",b.a.KZT))}]]}},{key:"getMaskConfig",value:function(){var t=this;Object.entries({iinOrBin:"iin",bankAccount:"tengeAccount",kbeCode:"kbe"}).forEach((function(e){var n=_slicedToArray(e,2),o=n[0],i=n[1];return t.masks[o]=t.maskService.getConfig(i)}))}},{key:"emulateSubmit",value:function(){this.form.submitted=!0,this.form.ngSubmit.emit(),this.fGroup.markAllAsTouched()}},{key:"prepareBody",value:function(){var t=this,e={},n=this.fGroup.controls.accounts.value,o=Object(d.getGroupRawValue)(this.fGroup);o.kbe={code:o.kbeCode,name:""},delete o.kbeCode,this.editMode&&(e=this.item.accounts.reduce((function(t,e){return t[e.iban]=e,t}),{}),o=Object.assign(Object.assign({},this.item),o));var i=n.map((function(n){var o=Object(d.ibanPrefix)(n,b.a.KZT),i=e[o];return i||(i={bic:t.bankFromAccount.transform(o),iban:o}),i}));return o.accounts=i,o}},{key:"processRequest",value:function(t){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.updateInProgress$.next(!0),!this.editMode){e.next=9;break}return e.next=5,this.recipients.updateRecipient(t);case 5:n=e.sent,o=Z.update,e.next=13;break;case 9:return e.next=11,this.recipients.createRecipient(t);case 11:n=e.sent,o=Z.create;case 13:this.modal.close({payload:n,type:o}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),this.updateInProgress$.next(!1),this.errorText=e.t0&&e.t0.description||JSON.stringify(e.t0);case 19:case"end":return e.stop()}}),e,this,[[0,16]])})))}},{key:"editMode",get:function(){var t;return null===(t=this.item)||void 0===t?void 0:t.id}}]),t}()).\u0275fac=function(t){return new(t||q)(k.Qb(E.a),k.Qb(R.a),k.Qb(j.a),k.Qb(d.FormBuilderTypeSafe),k.Qb(x.a),k.Qb(S.c))},q.\u0275cmp=k.Kb({type:q,selectors:[["j-edit-counterparty"]],viewQuery:function(t,e){var n;1&t&&k.Xc(N,!0),2&t&&k.Dc(n=k.jc())&&(e.form=n.first)},inputs:{item:"item"},features:[k.zb([{provide:u.a,useClass:u.b}])],decls:52,vars:52,consts:[[1,"modal-header"],["translate",""],["type","button",1,"modal-back","mr-3","btn","btn-outline-primary","btn-sm","p-0",3,"click"],[3,"inlineSVG"],["class","edit-counterparty--delete btn btn-link btn-link-light-gray btn-as-text float-right mt-2",3,"click",4,"ngIf"],[1,"modal-body"],[1,"scrolled"],[1,"scrolled--content",3,"formGroup"],["formDirective","ngForm"],[1,"form-group"],["clearable","true"],["type","text","jFormInput","",1,"form-control",3,"dropSpecialCharacters","jShadow","mask","formControl"],["jSuffix","",1,"counterParty","p3",3,"jLoading","jLoadingInverted"],[3,"control","errorMessages"],[1,"row"],[1,"form-group","col-8","pr-2"],["type","text","jFormInput","",1,"form-control",3,"formControl"],[1,"form-group","col-4","pl-2"],["type","text","jFormInput","",1,"form-control",3,"mask","jShadow","dropSpecialCharacters","formControl"],["type","button","jSuffix","","tooltipClass","tooltip-light tooltip-large","container","body",1,"btn-link-gray","btn","btn-link","btn-as-text",3,"ngbTooltip","inlineSVG"],["formArrayName","accounts",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-link","text-info","p-0","ml-auto",3,"disabled","click"],["class","alert alert-danger","translate","",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"disabled","click"],["type","submit",1,"btn","btn-primary",3,"disabled","jLoading","click"],["kbeInfo",""],[1,"edit-counterparty--delete","btn","btn-link","btn-link-light-gray","btn-as-text","float-right","mt-2",3,"click"],[1,"d-inline",3,"inlineSVG"],["formArrayName","accounts"],[1,"row","form-group"],[1,"col"],["jPrefix","","hideEmpty","true",3,"name"],["type","text","jFormInput","","jReplaceOnPaste","KZ","jDynamicPrefix","KZ","jUppercase","",1,"form-control",3,"jShadow","dropSpecialCharacters","mask","formControl"],["class","col d-flex flex-grow-0 text-center",4,"ngIf"],[1,"col","d-flex","flex-grow-0","text-center"],[1,"btn","btn-link","btn-link-light-gray","btn-as-text","float-right",3,"click"],["translate","",1,"alert","alert-danger"]],template:function(t,e){if(1&t&&(k.Wb(0,"div",0),k.Wb(1,"h4",1),k.Wb(2,"button",2),k.ic("click",(function(t){return e.onCancel()})),k.Rb(3,"i",3),k.nc(4,"svgPath"),k.Vb(),k.Sc(5),k.Vb(),k.Qc(6,B,3,3,"button",4),k.Vb(),k.Wb(7,"div",5),k.Wb(8,"div",6),k.Wb(9,"form",7,8),k.Wb(11,"div",9),k.Wb(12,"j-form-field",10),k.Wb(13,"j-label"),k.Sc(14,"\u0411\u0418\u041d/\u0418\u0418\u041d"),k.Vb(),k.Rb(15,"input",11),k.Rb(16,"div",12),k.nc(17,"async"),k.Rb(18,"j-error",13),k.Vb(),k.Vb(),k.Wb(19,"div",14),k.Wb(20,"div",15),k.Wb(21,"j-form-field",10),k.Wb(22,"j-label"),k.Sc(23,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),k.Vb(),k.Rb(24,"input",16),k.Rb(25,"div",12),k.nc(26,"async"),k.Vb(),k.Vb(),k.Wb(27,"div",17),k.Wb(28,"j-form-field",10),k.Wb(29,"j-label"),k.Sc(30,"\u041a\u0411\u0435"),k.Vb(),k.Rb(31,"input",18),k.Rb(32,"button",19),k.Rb(33,"j-error",13),k.Vb(),k.Vb(),k.Vb(),k.Qc(34,H,11,10,"div",20),k.Vb(),k.Vb(),k.Wb(35,"button",21),k.ic("click",(function(t){return e.addAccount()})),k.nc(36,"async"),k.Sc(37),k.nc(38,"translate"),k.Vb(),k.Qc(39,X,2,1,"div",22),k.Vb(),k.Wb(40,"div",23),k.Wb(41,"button",24),k.ic("click",(function(t){return e.onCancel()})),k.nc(42,"async"),k.Sc(43),k.nc(44,"translate"),k.Vb(),k.Wb(45,"button",25),k.ic("click",(function(t){return e.onSubmit()})),k.nc(46,"async"),k.nc(47,"async"),k.Sc(48),k.nc(49,"translate"),k.Vb(),k.Vb(),k.Qc(50,K,1,0,"ng-template",null,26,k.Rc)),2&t){var n=k.Ec(51);k.Ab(3),k.tc("inlineSVG",k.oc(4,32,"chevron-left")),k.Ab(2),k.Tc("COUNTERPARTY."+(e.editMode?"EDIT_COUNTERPARTY":"ADD_COUNTERPARTY")),k.Ab(1),k.tc("ngIf",e.editMode),k.Ab(3),k.tc("formGroup",e.fGroup),k.Ab(6),k.tc("dropSpecialCharacters",!0)("jShadow",e.masks.iinOrBin.shadow)("mask",e.masks.iinOrBin.mask)("formControl",e.fGroup.controls.iinOrBin),k.Ab(1),k.tc("jLoading",k.oc(17,34,e.checkingCounterParty$))("jLoadingInverted",!0),k.Ab(2),k.tc("control",e.fGroup.controls.iinOrBin)("errorMessages",e.errors.iinOrBin),k.Ab(6),k.tc("formControl",e.fGroup.controls.name),k.Ab(1),k.tc("jLoading",k.oc(26,36,e.checkingCounterParty$))("jLoadingInverted",!0),k.Ab(6),k.tc("mask",e.masks.kbeCode.mask)("jShadow",e.masks.kbeCode.shadow)("dropSpecialCharacters",!0)("formControl",e.fGroup.controls.kbeCode),k.Ab(1),k.tc("ngbTooltip",n)("inlineSVG","./assets/icons/payments/question.svg"),k.Ab(1),k.tc("control",e.fGroup.controls.kbeCode)("errorMessages",e.errors.kbeCode),k.Ab(1),k.tc("ngForOf",e.fGroup.get("accounts").controls),k.Ab(1),k.tc("disabled",k.oc(36,38,e.updateInProgress$)),k.Ab(2),k.Uc("+ ",k.oc(38,40,"COUNTERPARTY.ADD_ACCOUNT"),""),k.Ab(2),k.tc("ngIf",e.errorText),k.Ab(2),k.tc("disabled",k.oc(42,42,e.updateInProgress$)),k.Ab(2),k.Tc(k.oc(44,44,"SHARED.CANCEL")),k.Ab(2),k.tc("disabled",k.oc(46,46,e.updateInProgress$))("jLoading",k.oc(47,48,e.updateInProgress$)),k.Ab(3),k.Tc(k.oc(49,50,"SHARED.SAVE"))}},directives:[O.a,w.a,C.u,s.J,s.u,s.l,A.a,T.a,V.a,s.c,W.a,P.a,s.t,s.i,_.a,I.a,D.a,E.E,C.t,s.f,$.a,M.a,Y.a,L.a,G.a,F.a],pipes:[Q.a,C.b,O.d,x.a],styles:[".modal-body[_ngcontent-%COMP%]{padding:.25rem 1.5rem .5rem;-webkit-box-flex:1;flex-grow:1}.modal-body[_ngcontent-%COMP%]   .counterParty[_ngcontent-%COMP%]{width:3em;position:relative}.modal-footer[_ngcontent-%COMP%]{padding:.25rem 1.5rem 1rem;flex-shrink:0}.modal-header[_ngcontent-%COMP%]{padding:1.5rem 1.5rem 1rem;flex-shrink:0}.scrolled[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;max-height:calc(100vh - 280px)}j-edit-counterparty[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;max-height:calc(100vh - 80px)}"]}),q),et=n("itXk"),nt=n("l5mm"),ot=n("3E0/"),it=n("zP0r"),rt=n("pLZG"),ct=n("lJxs"),at=n("/uUt"),lt=n("vkgz"),st=n("JX91"),bt=n("IzEk"),ut=n("VnnJ"),pt=n("VO+5"),dt=n("ZF+8"),mt=n("3M96"),ft=((J=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,null))}return _inherits(e,t),_createClass(e,[{key:"activate",value:function(t){this.next(t)}},{key:"clearAll",value:function(){this.next(null)}}]),e}(c.a)).\u0275fac=function(t){return new(t||J)},J.\u0275prov=k.Mb({token:J,factory:J.\u0275fac,providedIn:"root"}),J),ht=((z=function(){function t(e,n){_classCallCheck(this,t),this.teleport=e,this.template=n}return _createClass(t,[{key:"ngOnChanges",value:function(t){var e=t.target;e&&(e.previousValue&&this.teleport.activate(_defineProperty({},e.previousValue,null)),e.currentValue&&this.teleport.activate(_defineProperty({},e.currentValue,this.template)))}},{key:"ngOnDestroy",value:function(){this.target&&this.teleport.activate(_defineProperty({},this.target,null))}}]),t}()).\u0275fac=function(t){return new(t||z)(k.Qb(ft),k.Qb(k.L))},z.\u0275dir=k.Lb({type:z,selectors:[["ng-template","jPortalledTpl",""]],inputs:{target:["jPortalledTpl","target"]},features:[k.yb()]}),z),vt=n("C6g9"),yt=n("zdqJ"),gt=n("tepA");function kt(t,e){if(1&t&&(k.Wb(0,"p",17),k.Rb(1,"j-entity-logo",18),k.nc(2,"bankFromAccount"),k.Sc(3),k.nc(4,"bankFromAccount"),k.Vb()),2&t){var n=e.$implicit;k.Ab(1),k.tc("name",k.oc(2,2,n.iban)),k.Ab(2),k.Uc(" ",k.oc(4,4,n.iban)," ")}}function Et(t,e){if(1&t&&(k.Wb(0,"p"),k.Sc(1),k.nc(2,"formatIban"),k.Vb()),2&t){var n=e.$implicit;k.Ab(1),k.Uc(" ",k.oc(2,1,n.iban)," ")}}function Rt(t,e){if(1&t&&(k.Wb(0,"div",19),k.Sb(1,20),k.Vb()),2&t){k.mc(2);var n=k.Ec(2);k.Ab(1),k.tc("ngTemplateOutlet",n)}}function jt(t,e){if(1&t&&(k.Wb(0,"div",21),k.Sb(1,20),k.Vb()),2&t){k.mc(2);var n=k.Ec(2);k.Ab(1),k.tc("ngTemplateOutlet",n)}}function xt(t,e){if(1&t&&(k.Ub(0),k.Wb(1,"div",3),k.Wb(2,"div",4),k.Rb(3,"input",5),k.Rb(4,"label",6),k.Vb(),k.Vb(),k.Wb(5,"div",7),k.Wb(6,"p",8),k.Sc(7),k.Vb(),k.Vb(),k.Wb(8,"div",9),k.Wb(9,"p",8),k.Sc(10),k.Vb(),k.Vb(),k.Wb(11,"div",10),k.Wb(12,"p",8),k.Sc(13),k.Vb(),k.Vb(),k.Wb(14,"div",11),k.Qc(15,kt,5,6,"p",12),k.Vb(),k.Wb(16,"div",13),k.Qc(17,Et,3,3,"p",14),k.Vb(),k.Qc(18,Rt,2,1,"div",15),k.Qc(19,jt,2,1,"div",16),k.Tb()),2&t){var n=k.mc();k.Ab(3),k.tc("jSelectionRow",n.item.id),k.Bb("id",n.item.id),k.Ab(1),k.Bb("for",n.item.id),k.Ab(3),k.Tc(n.item.iinOrBin),k.Ab(3),k.Tc(n.item.name),k.Ab(3),k.Tc(n.item.kbe.code),k.Ab(2),k.tc("ngForOf",n.item.accounts),k.Ab(2),k.tc("ngForOf",n.item.accounts),k.Ab(1),k.tc("ngIf",n.row.hasTour),k.Ab(1),k.tc("ngIf",!n.row.hasTour)}}function St(t,e){if(1&t){var n=k.Xb();k.Wb(0,"span",22),k.Wb(1,"button",23),k.ic("click",(function(t){return k.Hc(n),k.mc().onEdit()})),k.nc(2,"translate"),k.Rb(3,"i",24),k.nc(4,"svgPath"),k.Vb(),k.Vb(),k.Wb(5,"span"),k.Wb(6,"button",25),k.ic("click",(function(t){return k.Hc(n),k.mc().onRemove()})),k.nc(7,"translate"),k.Rb(8,"i",24),k.nc(9,"svgPath"),k.Vb(),k.Vb()}2&t&&(k.Ab(1),k.tc("ngbTooltip",k.oc(2,4,"COUNTERPARTY.EDIT_COUNTERPARTY")),k.Ab(2),k.tc("inlineSVG",k.oc(4,6,"edit")),k.Ab(3),k.tc("ngbTooltip",k.oc(7,8,"COUNTERPARTY.DELETE_COUNTERPARTY")),k.Ab(2),k.tc("inlineSVG",k.oc(9,10,"bucket")))}function Ot(t,e){if(1&t){var n=k.Xb();k.Wb(0,"div",26),k.Wb(1,"span",27),k.Sc(2),k.nc(3,"translate"),k.Vb(),k.Wb(4,"button",28),k.ic("click",(function(t){return k.Hc(n),k.mc().onCancelRemove()})),k.Rb(5,"i",24),k.nc(6,"svgPath"),k.Wb(7,"small",29),k.Sc(8),k.nc(9,"translate"),k.Vb(),k.Vb(),k.Vb()}if(2&t){var o=k.mc();k.Ab(2),k.Tc(k.oc(3,4,o.row.deleteWith?"COUNTERPARTY.DELETED_COUNTERPARTIES":"COUNTERPARTY.DELETED_COUNTERPARTY")),k.Ab(3),k.tc("inlineSVG",k.oc(6,6,"arrow-loop-left")),k.Ab(3),k.Vc("",k.oc(9,8,"SHARED.RETURN")," ",o.removing,"")}}var wt,Ct=((wt=function(){function t(){_classCallCheck(this,t),this.remove=new k.n,this.cancelRemove=new k.n,this.edit=new k.n}return _createClass(t,[{key:"ngOnInit",value:function(){}},{key:"onEdit",value:function(){this.edit.emit(this.row)}},{key:"onRemove",value:function(){this.remove.emit(this.row)}},{key:"onCancelRemove",value:function(){this.cancelRemove.emit(this.row)}}]),t}()).\u0275fac=function(t){return new(t||wt)},wt.\u0275cmp=k.Kb({type:wt,selectors:[["j-counterparty-row"]],hostAttrs:[1,"j-table--row"],inputs:{item:"item",row:"row",removing:"removing"},outputs:{remove:"remove",cancelRemove:"cancelRemove",edit:"edit"},decls:5,vars:2,consts:[[4,"ngIf","ngIfElse"],["actionsTpl",""],["removingTpl",""],[1,"counterparty-list--select","p3","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"jSelectionRow"],[1,"custom-control-label"],[1,"counterparty-list--iin","p3","j-table--cell","j-table--cell_static"],[1,"m-0"],[1,"counterparty-list--name","p3","j-table--cell"],[1,"counterparty-list--kbe","p3","j-table--cell","j-table--cell_static"],[1,"counterparty-list--bank","p3","j-table--cell","j-table--cell_static"],["class","d-flex align-items-center",4,"ngFor","ngForOf"],[1,"counterparty-list--account","p3","j-table--cell","j-table--cell_static"],[4,"ngFor","ngForOf"],["jTour","DIRECTORY.ACTIONS","jTourPosition","bottom","class","counterparty-list--tools p3 j-table--cell",4,"ngIf"],["class","counterparty-list--tools p3 j-table--cell",4,"ngIf"],[1,"d-flex","align-items-center"],["size","sm",1,"mr-1",3,"name"],["jTour","DIRECTORY.ACTIONS","jTourPosition","bottom",1,"counterparty-list--tools","p3","j-table--cell"],[3,"ngTemplateOutlet"],[1,"counterparty-list--tools","p3","j-table--cell"],[1,"mr-2"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray","ml-auto",3,"ngbTooltip","click"],[3,"inlineSVG"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[1,"p3","j-table--cell","counterparty-list--removing","d-flex"],[1,"text-muted"],["type","button",1,"ml-auto","btn","btn-link","text-info","p-0",3,"click"],[1,"ml-1"]],template:function(t,e){if(1&t&&(k.Qc(0,xt,20,10,"ng-container",0),k.Qc(1,St,10,12,"ng-template",null,1,k.Rc),k.Qc(3,Ot,10,10,"ng-template",null,2,k.Rc)),2&t){var n=k.Ec(4);k.tc("ngIf",!e.removing)("ngIfElse",n)}},directives:[C.u,vt.a,C.t,$.a,yt.a,C.B,E.E,w.a],pipes:[x.a,gt.a,O.d,Q.a],styles:[""],changeDetection:0}),wt),At=n("4cI0"),Tt=n("xJkR"),Vt=n("DHcY"),Wt=["contentBody"],Pt=["emptyBody"],_t=["errorBody"];function It(t,e){1&t&&k.Sb(0)}function Dt(t,e){1&t&&k.Sb(0)}function $t(t,e){if(1&t&&(k.Wb(0,"div",13),k.Qc(1,It,1,0,"ng-container",14),k.Qc(2,Dt,1,0,"ng-container",14),k.Vb()),2&t){var n=k.mc(),o=k.Ec(10);k.Ab(1),k.tc("ngTemplateOutlet",o),k.Ab(1),k.tc("ngTemplateOutlet",n.contentTpl)}}function Mt(t,e){if(1&t){var n=k.Xb();k.Wb(0,"button",29),k.ic("click",(function(t){return k.Hc(n),k.mc(2).onRemoveSelected()})),k.nc(1,"translate"),k.Rb(2,"i",30),k.nc(3,"svgPath"),k.Vb()}2&t&&(k.tc("ngbTooltip",k.oc(1,2,"COUNTERPARTY.DELETE_COUNTERPARTIES")),k.Ab(2),k.tc("inlineSVG",k.oc(3,4,"bucket")))}function Yt(t,e){if(1&t&&(k.Wb(0,"div",15),k.Wb(1,"div",16),k.Wb(2,"div",17),k.Wb(3,"div",18),k.Rb(4,"input",19),k.Rb(5,"label",20),k.Vb(),k.Vb(),k.Wb(6,"div",21),k.Sc(7,"\u0411\u0418\u041d/\u0418\u0418\u041d"),k.Vb(),k.Wb(8,"div",22),k.Sc(9,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),k.Vb(),k.Wb(10,"div",23),k.Sc(11,"\u041a\u0411\u0435"),k.Vb(),k.Wb(12,"div",24),k.Sc(13,"\u0411\u0430\u043d\u043a"),k.Vb(),k.Wb(14,"div",25),k.Sc(15,"\u2116 \u0441\u0447\u0435\u0442\u0430"),k.Vb(),k.Wb(16,"div",26),k.Wb(17,"span",27),k.Qc(18,Mt,4,6,"button",28),k.Vb(),k.Vb(),k.Vb(),k.Vb()),2&t){var n=k.mc();k.Ab(4),k.tc("masterSelect",!0),k.Ab(14),k.tc("ngIf",n.selectionModel.value.length)}}function Lt(t,e){if(1&t){var n=k.Xb();k.Wb(0,"j-counterparty-row",33),k.ic("edit",(function(t){k.Hc(n);var o=e.$implicit;return k.mc(2).onEdit(o)}))("remove",(function(t){k.Hc(n);var o=e.$implicit;return k.mc(2).onRemove(o)}))("cancelRemove",(function(t){k.Hc(n);var o=e.$implicit;return k.mc(2).onCancelRemove(o)})),k.nc(1,"async"),k.Vb()}if(2&t){var o=e.$implicit;k.tc("hidden",o.hidden)("row",o)("item",o.data)("removing",k.oc(1,4,o.removing$))}}function Gt(t,e){if(1&t&&(k.Wb(0,"div",31),k.Qc(1,Lt,2,6,"ng-template",32),k.nc(2,"async"),k.nc(3,"trackByProperty"),k.Vb()),2&t){var n=k.mc();k.Ab(1),k.tc("ngForOf",k.oc(2,2,n.composedRows$))("ngForTrackBy",k.oc(3,4,"id"))}}function Ft(t,e){1&t&&k.Rb(0,"j-empty-placeholder",34)}function Qt(t,e){if(1&t){var n=k.Xb();k.Wb(0,"div",35),k.Wb(1,"p",36),k.Sc(2,"SHARED.LIST_LOADING_ERR_REFRESH"),k.Vb(),k.Wb(3,"button",37),k.ic("click",(function(t){return k.Hc(n),k.mc().onRefresh()})),k.Sc(4,"SHARED.REFRESH"),k.Vb(),k.Vb()}}function Nt(t,e){if(1&t){var n=k.Xb();k.Wb(0,"button",38),k.ic("click",(function(t){return k.Hc(n),k.mc().onEdit()})),k.Sc(1),k.nc(2,"translate"),k.Vb()}2&t&&(k.Ab(1),k.Uc("+ ",k.oc(2,1,"COUNTERPARTY.ADD_COUNTERPARTY"),""))}function Bt(t,e){1&t&&k.Sb(0)}function Ut(t,e){1&t&&k.Sb(0)}function Ht(t,e){if(1&t&&(k.Wb(0,"div",39),k.Qc(1,Bt,1,0,"ng-container",14),k.Qc(2,Ut,1,0,"ng-container",14),k.Vb()),2&t){k.mc();var n=k.Ec(21);k.Ab(1),k.tc("ngTemplateOutlet",n),k.Ab(1),k.tc("ngTemplateOutlet",n)}}var Xt=function(){return{width:"200px",height:"25px","background-color":"#ECEEF1"}},Kt=function(){return{height:"115px","background-color":"#ECEEF1"}};function qt(t,e){1&t&&(k.Rb(0,"ngx-skeleton-loader",40),k.Rb(1,"ngx-skeleton-loader",40),k.Rb(2,"ngx-skeleton-loader",40)),2&t&&(k.tc("theme",k.xc(3,Xt)),k.Ab(1),k.tc("theme",k.xc(4,Kt)),k.Ab(1),k.tc("theme",k.xc(5,Kt)))}var zt,Jt=((zt=function(){function t(e,n,o,i,r,a){_classCallCheck(this,t),this.company=e,this.recipients=n,this.modalService=o,this.notifierService=i,this.translateService=r,this.tourService=a,this.search=new s.h(""),this.rows$=new c.a([]),this.composedRows$=new c.a([]),this.loadingErrors$=new c.a(void 0),this.selectionModel=new s.h([]),this.subs=new m.a,this.isTourShown=!1}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.store=this.recipients.store,this.subs.add(this.company.currentCompany$.pipe(Object(ot.a)(0),Object(it.a)(1)).subscribe((function(e){t.selectionModel.patchValue([]),t.rows$.getValue().forEach((function(t){t.cancelRemove$&&t.cancelRemove$.next(Date.now())}))}))),this.combineFilter(),this.watchForBodyTpl(),this.watchForItems(),this.onRefresh()}},{key:"selectAll",value:function(){}},{key:"ngOnDestroy",value:function(){this.subs.unsubscribe()}},{key:"onEdit",value:function(t){var e,n=this,o=this.modalService.open(tt,{backdropClass:"backdrop_light",windowClass:"modal_light modal-adaptive_sm modal_max-height modal-adaptive",centered:!0,backdrop:"static"});o.componentInstance.item=null===(e=t)||void 0===e?void 0:e.data,o.result.then((function(e){return n.handleEditResult(e,t)}))}},{key:"onRemoveSelected",value:function(){var t=this.selectionModel.value;t=t[t.length-1];var e=this.rows$.getValue().find((function(e){return e.data.id===t}));e&&this.startDeleteProcess(e,!0)}},{key:"onRemove",value:function(t,e){this.startDeleteProcess(t,e)}},{key:"onCancelRemove",value:function(t){t.cancelRemove$&&t.cancelRemove$.next(Date.now())}},{key:"onRefresh",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.recipients.getRecipients("",!0);case 3:this.selectionModel.patchValue([]),this.loadingErrors$.next(null),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),this.rows$.next([]),this.selectionModel.patchValue([]),this.loadingErrors$.next(t.t0);case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"handleEditResult",value:function(t,e){t&&([Z.create,Z.update].some((function(e){return e===t.type}))?(this.notifierService.notify("success",this.translateService.instant("COUNTERPARTY."+(Z.create===t.type?"CREATED_COUNTERPARTY":"UPDATED_COUNTERPARTY"))),this.store.upsertItem(t.payload)):this.startDeleteProcess(e))}},{key:"watchForItems",value:function(){var t=this;this.subs.add(Object(et.a)([this.store.items$,this.store.fetching$,this.store.fetched$]).pipe(Object(rt.a)((function(t){var e=_slicedToArray(t,3),n=(e[0],e[1]),o=e[2];return!n&&o})),Object(ct.a)((function(t){return t[0]})),Object(at.a)(),Object(lt.a)((function(e){return t.selectionModel.patchValue([])})),Object(ct.a)((function(t){return t.map((function(t){return new l(t)}))}))).subscribe((function(e){t.rows$.next(e)})))}},{key:"combineFilter",value:function(){var t=this;this.subs.add(Object(et.a)([this.rows$,this.search.valueChanges.pipe(Object(st.a)(""))]).pipe(Object(ct.a)((function(e){var n=_slicedToArray(e,2),o=n[0],i=n[1],r=o.filter((function(e){return!e.hidden&&t.recipients.filterRecipient(e.data,i)}));return r.length>0&&(r[0].hasTour=!0),r}))).subscribe(this.composedRows$))}},{key:"watchForBodyTpl",value:function(){var t=this;this.subs.add(Object(et.a)([this.store.fetched$,this.search.valueChanges.pipe(Object(st.a)("")),this.loadingErrors$,this.composedRows$]).pipe(Object(ot.a)(0),Object(ct.a)((function(e){var n=_slicedToArray(e,4),o=n[0],i=(n[1],n[2]),r=n[3];return i?t.errorBody:o&&!r.length?t.emptyBody:t.contentBody})),Object(at.a)()).subscribe((function(e){return t.contentTpl=e})))}},{key:"startDeleteProcess",value:function(t,e){var n,o=this;if(e){var i=this.selectionModel.value.reduce((function(t,e){return t[e]=!0,t}),{});delete i[t.data.id],n=this.rows$.getValue().filter((function(t){return i[t.data.id]})),t.deleteWith=n,n.forEach((function(t){return t.hidden=!0}))}t.cancelRemove$=new a.a,t.removing$.next("5"),this.rows$.next(_toConsumableArray(this.rows$.getValue()));var r=Object(nt.a)(1e3).pipe(Object(g.a)(t.cancelRemove$.pipe(Object(lt.a)((function(){t.removing$.next(""),t.deleteWith&&(t.deleteWith.forEach((function(t){return t.hidden=!1})),t.deleteWith=null),t.cancelRemove$=null})))),Object(lt.a)((function(e){t.removing$.next((+t.removing$.getValue()-1).toString())})),Object(bt.a)(5)).subscribe({next:function(e){4===e&&o.finishRemove(t,n)},complete:function(){return r.unsubscribe()},error:function(){return r.unsubscribe()}})}},{key:"finishRemove",value:function(t,e){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return!t.destroy$.closed&&t.removing$.next(null),o=[],o=e?e.map((function(t){return t.data.id})).concat(t.data.id):[t.data.id],this.store.removeItems(o),i=o.reduce((function(t,e){return t[e]=!0,t}),{}),this.selectionModel.patchValue(this.selectionModel.value.filter((function(t){return!i[t]}))),[t].concat(_toConsumableArray(e||[])).forEach((function(t){return t.destroy()})),n.prev=5,n.next=8,this.recipients.deleteRecipient(o);case 8:this.notifierService.notify("success",this.translateService.instant("COUNTERPARTY."+(o.length>1?"DELETED_COUNTERPARTIES":"DELETED_COUNTERPARTY"))),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(5),this.notifierService.notify("error",n.t0);case 14:case"end":return n.stop()}}),n,this,[[5,11]])})))}}]),t}()).\u0275fac=function(t){return new(t||zt)(k.Qb(ut.a),k.Qb(R.a),k.Qb(E.q),k.Qb(pt.c),k.Qb(O.e),k.Qb(dt.g))},zt.\u0275cmp=k.Kb({type:zt,selectors:[["j-counterparties"]],viewQuery:function(t,e){var n;1&t&&(k.Xc(Wt,!0),k.Xc(Pt,!0),k.Xc(_t,!0)),2&t&&(k.Dc(n=k.jc())&&(e.contentBody=n.first),k.Dc(n=k.jc())&&(e.emptyBody=n.first),k.Dc(n=k.jc())&&(e.errorBody=n.first))},decls:22,vars:12,consts:[[1,"list-page--content","list-page--content_counterparties",3,"jSelectionContainer","rows"],[1,"list-page--filter"],["clearable","true"],["jPrefix","","inlineSVG","./assets/icons/search.svg",1,"text-primary","d-block","mt-n1"],["type","text","jFormInput","","autocomplete","off",1,"form-control",3,"placeholder","formControl"],["class","counterparty-list j-table",4,"ngIf","ngIfElse"],["tableHead",""],["contentBody",""],["emptyBody",""],["errorBody",""],["jPortalledTpl","DIRECTORY_TITLE"],["loading",""],["loaderPart",""],[1,"counterparty-list","j-table"],[4,"ngTemplateOutlet"],[1,"j-table--head"],[1,"j-table--row"],[1,"counterparty-list--select","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox","id","checkboxAll","jSelectionRow","",1,"custom-control-input",3,"masterSelect"],["for","checkboxAll",1,"custom-control-label"],[1,"counterparty-list--iin","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--name","j-table--cell","p4"],[1,"counterparty-list--kbe","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--bank","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--account","j-table--cell","j-table--cell_static","p4"],[1,"counterparty-list--tools","j-table--cell"],[1,"ml-auto"],["type","button","tooltipClass","tooltip-light","placement","top","class","btn btn-link btn-as-text btn-link-light-gray",3,"ngbTooltip","click",4,"ngIf"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[3,"inlineSVG"],[1,"j-table--body"],["ngFor","",3,"ngForOf","ngForTrackBy"],[3,"hidden","row","item","removing","edit","remove","cancelRemove"],["label","COUNTERPARTY.NO_COUNTERPARTIES"],[1,"text-center","pt-5"],["translate","",1,"text-gray","text-gray"],["translate","","ng-disabled","store.fetching$ | async",1,"btn","btn-link","p-1",3,"click"],["jTour","DIRECTORY.NEW","jTourPosition","bottom",1,"mt-n3","btn","btn-link","p-0",3,"click"],[1,"p-4"],[3,"theme"]],template:function(t,e){if(1&t&&(k.Wb(0,"div",0),k.nc(1,"async"),k.Wb(2,"div",1),k.Wb(3,"j-form-field",2),k.Rb(4,"span",3),k.Rb(5,"input",4),k.nc(6,"translate"),k.Vb(),k.Vb(),k.Qc(7,$t,3,2,"div",5),k.nc(8,"async"),k.Qc(9,Yt,19,2,"ng-template",null,6,k.Rc),k.Qc(11,Gt,4,6,"ng-template",null,7,k.Rc),k.Vb(),k.Qc(13,Ft,1,0,"ng-template",null,8,k.Rc),k.Qc(15,Qt,5,0,"ng-template",null,9,k.Rc),k.Qc(17,Nt,3,3,"ng-template",10),k.Qc(18,Ht,3,2,"ng-template",null,11,k.Rc),k.Qc(20,qt,3,6,"ng-template",null,12,k.Rc)),2&t){var n=k.Ec(19);k.tc("jSelectionContainer",e.selectionModel)("rows",k.oc(1,6,e.composedRows$)),k.Ab(5),k.uc("placeholder",k.oc(6,8,"FILTER.SEARCH.COUNTERPARTY")),k.tc("formControl",e.search),k.Ab(2),k.tc("ngIf",k.oc(8,10,e.store.fetched$))("ngIfElse",n)}},directives:[mt.a,A.a,M.a,w.a,V.a,s.c,s.t,s.i,C.u,ht,C.B,vt.a,E.E,C.t,Ct,At.a,O.a,yt.a,Tt.a],pipes:[C.b,O.d,Q.a,Vt.a],styles:[".counterparty-list{min-height:200px;overflow:auto}.counterparty-list .j-table--head{min-width:760px;position:-webkit-sticky;position:sticky;top:0}.counterparty-list .j-table--body{min-width:760px}.counterparty-list .counterparty-list--select{position:-webkit-sticky;position:sticky;left:0;background:#fff}.counterparty-list--select{flex-basis:50px;max-width:50px}.counterparty-list--name{flex-basis:140px}.counterparty-list--iin{flex-basis:110px}.counterparty-list--bank{flex-basis:125px}.counterparty-list--bank>p{line-height:2em;margin-bottom:0}.counterparty-list--bank>p+p{margin-top:1em}.counterparty-list--account{flex-basis:210px}.counterparty-list--account>p{margin-bottom:0;line-height:2em}.counterparty-list--account>p+p{margin-top:1em}.counterparty-list--kbe{flex-basis:40px}.counterparty-list--tools{flex-basis:64px;margin-left:auto;text-align:right;padding-top:18px;padding-bottom:18px}.counterparty-list--tools .btn+.btn{margin-left:1em}.counterparty-list--removing{background-color:#f6f7f8}@media(min-width:960px){.counterparty-list--bank{flex-basis:150px}.counterparty-list{overflow:initial}.counterparty-list .counterparty-list--select{position:static}.counterparty-list .j-table--head{min-width:none;position:static}.counterparty-list .j-table--body{min-width:none}}"],encapsulation:2}),zt),Zt=n("kAiJ"),te=n("927x"),ee=n("Cfvw"),ne=n("JIr8"),oe=n("bqZY"),ie=n("ebvF"),re=n("7rOj"),ce=n("CVrE"),ae=n("TaxS"),le=n("B+58"),se=n("Cg+c"),be=["formDirective"];function ue(t,e){if(1&t){var n=k.Xb();k.Wb(0,"button",24),k.ic("click",(function(t){return k.Hc(n),k.mc().onDelete()})),k.Rb(1,"i",25),k.nc(2,"svgPath"),k.Vb()}2&t&&(k.Ab(1),k.tc("inlineSVG",k.oc(2,1,"bucket")))}function pe(t,e){if(1&t&&(k.Wb(0,"div",26),k.Sc(1),k.Vb()),2&t){var n=k.mc();k.Ab(1),k.Uc(" ",n.errorText," ")}}var de,me=function(t){return t.create="create",t.delete="delete",t.update="update",t}({}),fe=((de=function(){function t(e,n,o,i,r,a,l){_classCallCheck(this,t),this.modal=e,this.employeesService=n,this.maskService=o,this.fb=i,this.bankFromAccount=r,this.paymentsService=a,this.translate=l,this.autocomplete$=new c.a(void 0),this.updateInProgress$=new c.a(void 0),this.masks={},this.errors=p.b,this.minDate=new Date(1900,0,0),this.maxDate=new Date,this.minAmount=.01,this.maxAmount=212500,this.socialSumErr=[{error:"max",message:"".concat(this.translate.instant("ERRORS.MAX_SUM")," ").concat(this.maxAmount)}],this.lockChildFields=["iin","fio","birthDate"],this.subs=new m.a}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;if(this.getMaskConfig(),this.fGroup=this.createForm(this.item),!this.editMode){var e=this.fGroup.controls.iin;this.subs.add(e.valueChanges.pipe(Object(rt.a)((function(t){return e.valid})),Object(v.a)(200),Object(y.a)((function(n){return e.valid?(t.autocomplete$.next(n),Object(ee.a)(t.employeesService.getNameByIin(n)).pipe(Object(ct.a)((function(t){return{fullName:t,bin:n}})),Object(g.a)(e.valueChanges),Object(ne.a)((function(){return Object(f.a)(null)})))):(t.autocomplete$.next(null),h.a)}))).subscribe((function(e){e&&t.autocomplete$.getValue()===e.bin&&t.fGroup.patchValue({fio:e.fullName}),t.autocomplete$.next(null)})))}}},{key:"createForm",value:function(){var t,e,n,o,i=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=p.a.SafeMaxAmount(this.maxAmount),a=p.a.SafeMinAmount(this.minAmount);return this.fb.group({iin:[{value:r.iin||"",disabled:this.editMode},[s.H.required,s.H.minLength(12)]],fio:[r.fio||"",[s.H.required]],birthDate:[r.birthDate&&Object(Zt.i)(r.birthDate)||"",[s.H.required]],iban:[r.iban||"",[function(t){return i.paymentsService.bankExist(Object(te.d)(t.value||"",b.a.KZT))}]],ocmcSum:[null===(t=r.ocmcSum)||void 0===t?void 0:t.amount,[a,c]],pensionSum:[null===(e=r.pensionSum)||void 0===e?void 0:e.amount,[a,c]],salarySum:[null===(n=r.salarySum)||void 0===n?void 0:n.amount,[a]],socialSum:[null===(o=r.socialSum)||void 0===o?void 0:o.amount,[a,c]]})}},{key:"onCancel",value:function(){this.updateInProgress$.getValue()||this.modal.close()}},{key:"onSubmit",value:function(){if(!this.updateInProgress$.getValue())if(this.fGroup.invalid)this.emulateSubmit();else{var t=this.prepareBody();this.processRequest(t)}}},{key:"onDelete",value:function(){this.modal.close({payload:this.item,type:me.delete})}},{key:"getMaskConfig",value:function(){var t=this;Object.entries({iin:"iin",iban:"tengeAccount"}).forEach((function(e){var n=_slicedToArray(e,2),o=n[0],i=n[1];return t.masks[o]=t.maskService.getConfig(i)}))}},{key:"emulateSubmit",value:function(){this.form.submitted=!0,this.form.ngSubmit.emit(),this.fGroup.markAllAsTouched()}},{key:"prepareBody",value:function(){var t=Object(te.c)(this.fGroup);return["ocmcSum","pensionSum","salarySum","socialSum"].forEach((function(e){var n=Object(te.g)(t[e]);t[e]=n?{amount:n,currency:b.a.KZT}:null})),t.birthDate=Object(Zt.m)(t.birthDate),t.iban=t.iban&&Object(te.d)(t.iban,b.a.KZT)||null,t}},{key:"processRequest",value:function(t){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.updateInProgress$.next(!0),!this.editMode){e.next=9;break}return e.next=5,this.employeesService.editEmployee(t);case 5:n=e.sent,o=me.update,e.next=13;break;case 9:return e.next=11,this.employeesService.createEmployee(t);case 11:n=e.sent,o=me.create;case 13:this.modal.close({payload:n,type:o}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),this.updateInProgress$.next(!1),this.errorText=e.t0&&e.t0.description||JSON.stringify(e.t0);case 19:case"end":return e.stop()}}),e,this,[[0,16]])})))}},{key:"isSubmitted",get:function(){return this.form.submitted}},{key:"editMode",get:function(){var t;return null===(t=this.item)||void 0===t?void 0:t.id}}]),t}()).\u0275fac=function(t){return new(t||de)(k.Qb(E.a),k.Qb(oe.b),k.Qb(j.a),k.Qb(ie.a),k.Qb(re.b),k.Qb(ce.g),k.Qb(O.e))},de.\u0275cmp=k.Kb({type:de,selectors:[["j-directory-edit-employee"]],viewQuery:function(t,e){var n;1&t&&k.Nc(be,!0),2&t&&k.Dc(n=k.jc())&&(e.form=n.first)},inputs:{item:"item"},features:[k.zb([{provide:u.a,useClass:u.b}])],decls:72,vars:68,consts:[[1,"modal-header"],["translate",""],["type","button",1,"modal-back","mr-3","btn","btn-outline-primary","btn-sm","p-0",3,"click"],[3,"inlineSVG"],["class","edit-counterparty--delete btn btn-link btn-link-light-gray btn-as-text float-right mt-2",3,"click",4,"ngIf"],[1,"modal-body"],[1,"scrolled"],[1,"scrolled--content",3,"formGroup"],["formDirective","ngForm"],[1,"form-group"],["clearable","true"],["type","text","jFormInput","",1,"form-control",3,"dropSpecialCharacters","jShadow","mask","formControl"],["jSuffix","",1,"p3",3,"jLoading","jLoadingInverted"],[3,"control","errorMessages"],["type","text","jFormInput","",1,"form-control",3,"formControl"],[3,"isCalendarShown","label","hasError","formControl","minDate","maxDate"],["jPrefix","","hideEmpty","true",3,"name"],["type","text","jFormInput","","jReplaceOnPaste","KZ","jDynamicPrefix","KZ","jUppercase","",1,"form-control",3,"dropSpecialCharacters","mask","jShadow","formControl"],["accountInput","jFormInput"],["type","text","jFormInput","","jCursorBound","","jReplaceDot","","suffix"," \u20b8","mask","separator.2","thousandSeparator"," ",1,"form-control",3,"dropSpecialCharacters","formControl"],["class","alert alert-danger","translate","",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary",3,"disabled","click"],["type","submit",1,"btn","btn-primary",3,"disabled","jLoading","click"],[1,"edit-counterparty--delete","btn","btn-link","btn-link-light-gray","btn-as-text","float-right","mt-2",3,"click"],[1,"d-inline",3,"inlineSVG"],["translate","",1,"alert","alert-danger"]],template:function(t,e){1&t&&(k.Wb(0,"div",0),k.Wb(1,"h4",1),k.Wb(2,"button",2),k.ic("click",(function(t){return e.onCancel()})),k.Rb(3,"i",3),k.nc(4,"svgPath"),k.Vb(),k.Sc(5),k.Vb(),k.Qc(6,ue,3,3,"button",4),k.Vb(),k.Wb(7,"div",5),k.Wb(8,"div",6),k.Wb(9,"form",7,8),k.Wb(11,"div",9),k.Wb(12,"j-form-field",10),k.Wb(13,"j-label",1),k.Sc(14,"DIRECTORY.EMPLOYEES.IIN"),k.Vb(),k.Rb(15,"input",11),k.Rb(16,"div",12),k.nc(17,"async"),k.Rb(18,"j-error",13),k.Vb(),k.Vb(),k.Wb(19,"div",9),k.Wb(20,"j-form-field",10),k.Wb(21,"j-label",1),k.Sc(22,"DIRECTORY.EMPLOYEES.FIO"),k.Vb(),k.Rb(23,"input",14),k.Rb(24,"div",12),k.nc(25,"async"),k.Vb(),k.Vb(),k.Wb(26,"div",9),k.Rb(27,"j-date-input",15),k.nc(28,"translate"),k.Vb(),k.Wb(29,"div",9),k.Wb(30,"j-form-field",10),k.Wb(31,"j-label",1),k.Sc(32,"DIRECTORY.EMPLOYEES.ACCOUNT_SALARY"),k.Vb(),k.Rb(33,"j-entity-logo",16),k.nc(34,"bankFromAccount"),k.Rb(35,"input",17,18),k.Rb(37,"j-error",13),k.Vb(),k.Vb(),k.Wb(38,"div",9),k.Wb(39,"j-form-field",10),k.Wb(40,"j-label",1),k.Sc(41,"DIRECTORY.EMPLOYEES.SUM_SALARY"),k.Vb(),k.Rb(42,"input",19),k.Vb(),k.Vb(),k.Wb(43,"div",9),k.Wb(44,"j-form-field",10),k.Wb(45,"j-label",1),k.Sc(46,"DIRECTORY.EMPLOYEES.SUM_PENSION"),k.Vb(),k.Rb(47,"input",19),k.Rb(48,"j-error",13),k.Vb(),k.Vb(),k.Wb(49,"div",9),k.Wb(50,"j-form-field",10),k.Wb(51,"j-label",1),k.Sc(52,"DIRECTORY.EMPLOYEES.SUM_SOCIAL"),k.Vb(),k.Rb(53,"input",19),k.Rb(54,"j-error",13),k.Vb(),k.Vb(),k.Wb(55,"div",9),k.Wb(56,"j-form-field",10),k.Wb(57,"j-label",1),k.Sc(58,"DIRECTORY.EMPLOYEES.SUM_MEDICAL"),k.Vb(),k.Rb(59,"input",19),k.Rb(60,"j-error",13),k.Vb(),k.Vb(),k.Vb(),k.Vb(),k.Qc(61,pe,2,1,"div",20),k.Vb(),k.Wb(62,"div",21),k.Wb(63,"button",22),k.ic("click",(function(t){return e.onCancel()})),k.nc(64,"async"),k.Sc(65),k.nc(66,"translate"),k.Vb(),k.Wb(67,"button",23),k.ic("click",(function(t){return e.onSubmit()})),k.nc(68,"async"),k.nc(69,"async"),k.Sc(70),k.nc(71,"translate"),k.Vb(),k.Vb()),2&t&&(k.Ab(3),k.tc("inlineSVG",k.oc(4,48,"chevron-left")),k.Ab(2),k.Uc(" ","DIRECTORY.EMPLOYEES."+(e.editMode?"EDIT_EMPLOYEE":"ADD_EMPLOYEE")," "),k.Ab(1),k.tc("ngIf",e.editMode),k.Ab(3),k.tc("formGroup",e.fGroup),k.Ab(6),k.tc("dropSpecialCharacters",!0)("jShadow",e.masks.iin.shadow)("mask",e.masks.iin.mask)("formControl",e.fGroup.controls.iin),k.Ab(1),k.tc("jLoading",k.oc(17,50,e.autocomplete$))("jLoadingInverted",!0),k.Ab(2),k.tc("control",e.fGroup.controls.iin)("errorMessages",e.errors.iinOrBin),k.Ab(5),k.tc("formControl",e.fGroup.controls.fio),k.Ab(1),k.tc("jLoading",k.oc(25,52,e.autocomplete$))("jLoadingInverted",!0),k.Ab(3),k.tc("isCalendarShown",!1)("label",k.oc(28,54,"DIRECTORY.EMPLOYEES.BIRTH_DATE"))("hasError",e.fGroup.controls.birthDate.errors&&e.isSubmitted)("formControl",e.fGroup.controls.birthDate)("minDate",e.minDate)("maxDate",e.maxDate),k.Ab(6),k.tc("name",k.oc(34,56,"KZ"+e.fGroup.controls.iban.value)),k.Ab(2),k.tc("dropSpecialCharacters",!0)("mask",e.masks.iban.mask)("jShadow",e.masks.iban.shadow)("formControl",e.fGroup.controls.iban),k.Ab(2),k.tc("control",e.fGroup.controls.iban)("errorMessages",e.errors.bankAccount),k.Ab(5),k.tc("dropSpecialCharacters",!0)("formControl",e.fGroup.controls.salarySum),k.Ab(5),k.tc("dropSpecialCharacters",!0)("formControl",e.fGroup.controls.pensionSum),k.Ab(1),k.tc("control",e.fGroup.controls.pensionSum)("errorMessages",e.socialSumErr),k.Ab(5),k.tc("dropSpecialCharacters",!0)("formControl",e.fGroup.controls.socialSum),k.Ab(1),k.tc("control",e.fGroup.controls.socialSum)("errorMessages",e.socialSumErr),k.Ab(5),k.tc("dropSpecialCharacters",!0)("formControl",e.fGroup.controls.ocmcSum),k.Ab(1),k.tc("control",e.fGroup.controls.ocmcSum)("errorMessages",e.socialSumErr),k.Ab(1),k.tc("ngIf",e.errorText),k.Ab(2),k.tc("disabled",k.oc(64,58,e.updateInProgress$)),k.Ab(2),k.Tc(k.oc(66,60,"SHARED.CANCEL")),k.Ab(2),k.tc("disabled",k.oc(68,62,e.updateInProgress$))("jLoading",k.oc(69,64,e.updateInProgress$)),k.Ab(3),k.Tc(k.oc(71,66,"SHARED.SAVE")))},directives:[O.a,w.a,C.u,s.J,s.u,s.l,A.a,T.a,V.a,s.c,W.a,P.a,s.t,s.i,_.a,I.a,D.a,ae.a,$.a,M.a,Y.a,L.a,G.a,le.a,se.a],pipes:[Q.a,C.b,O.d,x.a],styles:[".modal-body[_ngcontent-%COMP%]{padding:.25rem 1.5rem .5rem;-webkit-box-flex:1;flex-grow:1}.modal-body[_ngcontent-%COMP%]   .counterParty[_ngcontent-%COMP%]{width:3em;position:relative}.modal-footer[_ngcontent-%COMP%]{padding:.25rem 1.5rem 1rem;flex-shrink:0}.modal-header[_ngcontent-%COMP%]{padding:1.5rem 1.5rem 1rem;flex-shrink:0}.scrolled[_ngcontent-%COMP%]{overflow-y:auto;overflow-x:hidden;max-height:calc(100vh - 280px)}j-directory-edit-employee[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;max-height:calc(100vh - 80px)}.j-form-field[_ngcontent-%COMP%]   .is-loading[_ngcontent-%COMP%]{width:40px;position:relative}"]}),de),he=n("Nq+r"),ve=n("Kx/q"),ye=n("7Fmj"),ge=n("wY9W");function ke(t,e){if(1&t&&(k.Ub(0),k.Wb(1,"span",7),k.Sc(2),k.Vb(),k.Tb()),2&t){var n=e.$implicit;k.Ab(2),k.Uc("",n," ")}}function Ee(t,e){if(1&t){var n=k.Xb();k.Ub(0),k.Wb(1,"div",2),k.Wb(2,"div",3),k.Rb(3,"input",4),k.Rb(4,"label",5),k.Vb(),k.Vb(),k.Wb(5,"div",6),k.Wb(6,"p",7),k.Sc(7),k.Rb(8,"br"),k.Wb(9,"span",8),k.Sc(10),k.nc(11,"date"),k.Vb(),k.Vb(),k.Vb(),k.Wb(12,"div",9),k.Wb(13,"p",10),k.Qc(14,ke,3,1,"ng-container",11),k.nc(15,"pipeFunction"),k.Vb(),k.Vb(),k.Wb(16,"div",12),k.Wb(17,"p",7),k.Sc(18),k.nc(19,"maskIban"),k.Vb(),k.Vb(),k.Wb(20,"div",13),k.Wb(21,"p",7),k.Rb(22,"j-money",14),k.Vb(),k.Vb(),k.Wb(23,"div",15),k.Wb(24,"p",7),k.Rb(25,"j-money",14),k.Vb(),k.Vb(),k.Wb(26,"div",15),k.Wb(27,"p",7),k.Rb(28,"j-money",14),k.Vb(),k.Vb(),k.Wb(29,"div",15),k.Wb(30,"p",7),k.Rb(31,"j-money",14),k.Vb(),k.Vb(),k.Wb(32,"div",16),k.Wb(33,"span",17),k.Wb(34,"button",18),k.ic("click",(function(t){return k.Hc(n),k.mc().onEdit()})),k.nc(35,"translate"),k.Rb(36,"i",19),k.nc(37,"svgPath"),k.Vb(),k.Vb(),k.Wb(38,"span"),k.Wb(39,"button",20),k.ic("click",(function(t){return k.Hc(n),k.mc().onRemove()})),k.nc(40,"translate"),k.Rb(41,"i",19),k.nc(42,"svgPath"),k.Vb(),k.Vb(),k.Vb(),k.Tb()}if(2&t){var o=k.mc();k.Ab(3),k.tc("jSelectionRow",o.item.id),k.Bb("id",o.item.id),k.Ab(1),k.Bb("for",o.item.id),k.Ab(3),k.Tc(o.item.iin),k.Ab(3),k.Tc(k.pc(11,15,o.item.birthDate,"dd.MM.yyyy")),k.Ab(4),k.tc("ngForOf",k.pc(15,18,o.item.fio,o.splitName)),k.Ab(4),k.Tc(k.oc(19,21,o.item.iban)),k.Ab(4),k.tc("money",o.item.salarySum),k.Ab(3),k.tc("money",o.item.pensionSum),k.Ab(3),k.tc("money",o.item.socialSum),k.Ab(3),k.tc("money",o.item.ocmcSum),k.Ab(3),k.tc("ngbTooltip",k.oc(35,23,"DIRECTORY.EMPLOYEES.EDIT")),k.Ab(2),k.tc("inlineSVG",k.oc(37,25,"edit")),k.Ab(3),k.tc("ngbTooltip",k.oc(40,27,"DIRECTORY.EMPLOYEES.DELETE")),k.Ab(2),k.tc("inlineSVG",k.oc(42,29,"bucket"))}}var Re=function(t){return{num:t}};function je(t,e){if(1&t){var n=k.Xb();k.Wb(0,"div",21),k.Wb(1,"span",22),k.Sc(2),k.Vb(),k.Wb(3,"button",23),k.ic("click",(function(t){return k.Hc(n),k.mc().onCancelRemove()})),k.Rb(4,"i",19),k.nc(5,"svgPath"),k.Wb(6,"small",24),k.Sc(7),k.nc(8,"translate"),k.Vb(),k.Vb(),k.Vb()}if(2&t){var o=k.mc();k.Ab(1),k.tc("translateParams",o.row.deleteWith?k.yc(9,Re,o.row.deleteWith.length+1):null),k.Ab(1),k.Tc(o.row.deleteWith?"DIRECTORY.EMPLOYEES.EMPLOYEES_DELETED":"DIRECTORY.EMPLOYEES.EMPLOYEE_DELETED"),k.Ab(2),k.tc("inlineSVG",k.oc(5,5,"arrow-loop-left")),k.Ab(3),k.Vc("",k.oc(8,7,"SHARED.RETURN")," ",o.removing,"")}}var xe,Se=((xe=function(){function t(){_classCallCheck(this,t),this.remove=new k.n,this.cancelRemove=new k.n,this.edit=new k.n}return _createClass(t,[{key:"ngOnInit",value:function(){}},{key:"onEdit",value:function(){this.edit.emit(this.row)}},{key:"onRemove",value:function(){this.remove.emit(this.row)}},{key:"onCancelRemove",value:function(){this.cancelRemove.emit(this.row)}},{key:"splitName",value:function(t){return t?t.split(" "):[]}}]),t}()).\u0275fac=function(t){return new(t||xe)},xe.\u0275cmp=k.Kb({type:xe,selectors:[["j-directory-employee-row"]],hostAttrs:[1,"j-table--row"],inputs:{item:"item",row:"row",removing:"removing"},outputs:{remove:"remove",cancelRemove:"cancelRemove",edit:"edit"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["removingTpl",""],[1,"directory-employees-list--select","p3","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"jSelectionRow"],[1,"custom-control-label"],[1,"directory-employees-list--iin","p3","j-table--cell","j-table--cell_static"],[1,"m-0"],[1,"text-gray"],[1,"directory-employees-list--name","p3","j-table--cell"],[1,"directory-employees-list--name-helper","m-0"],[4,"ngFor","ngForOf"],[1,"directory-employees-list--number","p3","j-table--cell","j-table--cell_static"],[1,"directory-employees-list--salary","p3","j-table--cell"],[3,"money"],[1,"directory-employees-list--payment","p3","j-table--cell","j-table--cell_static"],[1,"directory-employees-list--tools","p3","j-table--cell"],[1,"mr-2"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray","ml-auto",3,"ngbTooltip","click"],[3,"inlineSVG"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[1,"p3","j-table--cell","directory-employees-list--removing","d-flex"],["translate","",1,"text-muted",3,"translateParams"],["type","button",1,"ml-auto","btn","btn-link","text-info","p-0",3,"click"],[1,"ml-1"]],template:function(t,e){if(1&t&&(k.Qc(0,Ee,43,31,"ng-container",0),k.Qc(1,je,9,11,"ng-template",null,1,k.Rc)),2&t){var n=k.Ec(2);k.tc("ngIf",!e.removing)("ngIfElse",n)}},directives:[C.u,vt.a,C.t,ve.a,E.E,w.a,O.a],pipes:[C.f,ye.a,ge.a,O.d,Q.a],styles:[".directory-employees-list--name-helper[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;max-width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding-right:.2em}"]}),xe),Oe=["contentBody"],we=["emptyBody"],Ce=["errorBody"];function Ae(t,e){1&t&&k.Sb(0)}function Te(t,e){1&t&&k.Sb(0)}function Ve(t,e){if(1&t&&(k.Wb(0,"div",13),k.Qc(1,Ae,1,0,"ng-container",14),k.Qc(2,Te,1,0,"ng-container",14),k.Vb()),2&t){var n=k.mc(),o=k.Ec(9);k.Ab(1),k.tc("ngTemplateOutlet",o),k.Ab(1),k.tc("ngTemplateOutlet",n.contentTpl)}}function We(t,e){if(1&t){var n=k.Xb();k.Wb(0,"button",29),k.ic("click",(function(t){return k.Hc(n),k.mc(2).onRemoveSelected()})),k.nc(1,"translate"),k.Rb(2,"i",30),k.nc(3,"svgPath"),k.Vb()}2&t&&(k.tc("ngbTooltip",k.oc(1,2,"DIRECTORY.EMPLOYEES.DELETE_MULTY")),k.Ab(2),k.tc("inlineSVG",k.oc(3,4,"bucket")))}function Pe(t,e){if(1&t&&(k.Wb(0,"div",15),k.Wb(1,"div",16),k.Wb(2,"div",17),k.Wb(3,"div",18),k.Rb(4,"input",19),k.Rb(5,"label",20),k.Vb(),k.Vb(),k.Wb(6,"div",21),k.Sc(7,"DIRECTORY.EMPLOYEES.IIN_BIRTH"),k.Vb(),k.Wb(8,"div",22),k.Sc(9,"DIRECTORY.EMPLOYEES.FIO"),k.Vb(),k.Wb(10,"div",23),k.Sc(11,"DIRECTORY.EMPLOYEES.ACCOUNT_N"),k.Vb(),k.Wb(12,"div",24),k.Sc(13,"DIRECTORY.EMPLOYEES.SUM_SAL"),k.Vb(),k.Wb(14,"div",25),k.Sc(15,"DIRECTORY.EMPLOYEES.SUM_PENS"),k.Vb(),k.Wb(16,"div",25),k.Sc(17,"DIRECTORY.EMPLOYEES.SUM_SOC"),k.Vb(),k.Wb(18,"div",25),k.Sc(19,"DIRECTORY.EMPLOYEES.SUM_MEDICAL"),k.Vb(),k.Wb(20,"div",26),k.Wb(21,"span",27),k.Qc(22,We,4,6,"button",28),k.Vb(),k.Vb(),k.Vb(),k.Vb()),2&t){var n=k.mc();k.Ab(4),k.tc("masterSelect",!0),k.Ab(18),k.tc("ngIf",n.selectionModel.value.length)}}function _e(t,e){if(1&t){var n=k.Xb();k.Wb(0,"j-directory-employee-row",33),k.ic("edit",(function(t){k.Hc(n);var o=e.$implicit;return k.mc(2).onEdit(o)}))("remove",(function(t){k.Hc(n);var o=e.$implicit;return k.mc(2).onRemove(o)}))("cancelRemove",(function(t){k.Hc(n);var o=e.$implicit;return k.mc(2).onCancelRemove(o)})),k.nc(1,"async"),k.Vb()}if(2&t){var o=e.$implicit;k.tc("hidden",o.hidden)("row",o)("item",o.data)("removing",k.oc(1,4,o.removing$))}}function Ie(t,e){if(1&t&&(k.Wb(0,"div",31),k.Qc(1,_e,2,6,"ng-template",32),k.nc(2,"async"),k.nc(3,"trackByProperty"),k.Vb()),2&t){var n=k.mc();k.Ab(1),k.tc("ngForOf",k.oc(2,2,n.composedRows$))("ngForTrackBy",k.oc(3,4,"id"))}}function De(t,e){if(1&t&&k.Rb(0,"j-empty-placeholder",34),2&t){var n=k.mc();k.tc("label",n.search.value?"DIRECTORY.EMPLOYEES.NOT_FOUND_CHANGE_PARAMS":"PAYMENTS.EMPLOYEES.EMPTY")}}function $e(t,e){if(1&t){var n=k.Xb();k.Wb(0,"div",35),k.Wb(1,"p",36),k.Sc(2,"SHARED.LIST_LOADING_ERR_REFRESH"),k.Vb(),k.Wb(3,"button",37),k.ic("click",(function(t){return k.Hc(n),k.mc().onRefresh()})),k.Sc(4,"SHARED.REFRESH"),k.Vb(),k.Vb()}}function Me(t,e){if(1&t){var n=k.Xb();k.Wb(0,"button",38),k.ic("click",(function(t){return k.Hc(n),k.mc().onEdit()})),k.Sc(1),k.nc(2,"translate"),k.Vb()}2&t&&(k.Ab(1),k.Uc("+ ",k.oc(2,1,"DIRECTORY.EMPLOYEES.ADD_EMPLOYEE"),""))}function Ye(t,e){1&t&&k.Sb(0)}function Le(t,e){1&t&&k.Sb(0)}function Ge(t,e){if(1&t&&(k.Wb(0,"div",39),k.Qc(1,Ye,1,0,"ng-container",14),k.Qc(2,Le,1,0,"ng-container",14),k.Vb()),2&t){k.mc();var n=k.Ec(20);k.Ab(1),k.tc("ngTemplateOutlet",n),k.Ab(1),k.tc("ngTemplateOutlet",n)}}var Fe=function(){return{width:"200px",height:"25px","background-color":"#ECEEF1"}},Qe=function(){return{height:"115px","background-color":"#ECEEF1"}};function Ne(t,e){1&t&&(k.Rb(0,"ngx-skeleton-loader",40),k.Rb(1,"ngx-skeleton-loader",40),k.Rb(2,"ngx-skeleton-loader",40)),2&t&&(k.tc("theme",k.xc(3,Fe)),k.Ab(1),k.tc("theme",k.xc(4,Qe)),k.Ab(1),k.tc("theme",k.xc(5,Qe)))}var Be,Ue=((Be=function(){function t(e,n,o,i,r){_classCallCheck(this,t),this.company=e,this.employeeService=n,this.modalService=o,this.notifierService=i,this.translateService=r,this.search=new s.h(""),this.rows$=new c.a([]),this.composedRows$=new c.a([]),this.loadingErrors$=new c.a(void 0),this.selectionModel=new s.h([]),this.subs=new m.a,this.store=new he.a([])}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.subs.add(this.company.currentCompany$.pipe(Object(ot.a)(0),Object(it.a)(1)).subscribe((function(e){t.selectionModel.patchValue([]),t.onRefresh(),t.rows$.getValue().forEach((function(t){t.cancelRemove$&&t.cancelRemove$.next(Date.now())}))}))),this.combineFilter(),this.watchForBodyTpl(),this.watchForItems(),this.onRefresh()}},{key:"onEdit",value:function(t){var e,n=this,o=this.modalService.open(fe,{backdropClass:"backdrop_light",windowClass:"modal_light modal-adaptive_sm modal_max-height modal-adaptive",centered:!0,backdrop:"static"});o.componentInstance.item=null===(e=t)||void 0===e?void 0:e.data,o.result.then((function(e){return n.handleEditResult(e,t)}))}},{key:"onRemoveSelected",value:function(){var t=this.selectionModel.value;t=t[t.length-1];var e=this.rows$.getValue().find((function(e){return e.data.id===t}));e&&this.startDeleteProcess(e,!0)}},{key:"onRemove",value:function(t,e){this.startDeleteProcess(t,e)}},{key:"onCancelRemove",value:function(t){t.cancelRemove$&&t.cancelRemove$.next(Date.now())}},{key:"onRefresh",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.fetchEmployees();case 3:this.selectionModel.patchValue([]),this.loadingErrors$.next(null),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),this.rows$.next([]),this.selectionModel.patchValue([]),this.loadingErrors$.next(t.t0);case 10:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"combineFilter",value:function(){var t=this;this.subs.add(Object(et.a)([this.rows$,this.search.valueChanges.pipe(Object(st.a)(""))]).pipe(Object(ct.a)((function(e){var n=_slicedToArray(e,2),o=n[0],i=n[1].toLocaleLowerCase();return o.filter((function(e){return!e.hidden&&t.employeeService.filterEmployee(e.data,i)}))}))).subscribe(this.composedRows$))}},{key:"fetchEmployees",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.store.fetching=!0,t.prev=1,t.next=4,this.employeeService.getEmployees();case 4:e=t.sent,this.store.setState(e),this.store.fetching=!1,!this.store.fetched&&(this.store.fetched=!0),t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(1),this.store.setState([]),!this.store.fetched&&(this.store.fetched=!0),this.store.fetching=!1,t.t0;case 11:case"end":return t.stop()}}),t,this,[[1,8]])})))}},{key:"handleEditResult",value:function(t,e){t&&([me.create,me.update].some((function(e){return e===t.type}))?(this.notifierService.notify("success",this.translateService.instant("DIRECTORY.EMPLOYEES."+(me.create===t.type?"EMPLOYEE_ADDED":"EMPLOYEE_EDITED"))),this.store.upsertItem(t.payload)):this.startDeleteProcess(e))}},{key:"watchForItems",value:function(){var t=this;this.subs.add(Object(et.a)([this.store.items$,this.store.fetching$,this.store.fetched$]).pipe(Object(rt.a)((function(t){var e=_slicedToArray(t,3),n=(e[0],e[1]),o=e[2];return!n&&o})),Object(ct.a)((function(t){return t[0]})),Object(at.a)(),Object(lt.a)((function(e){return t.selectionModel.patchValue([])})),Object(ct.a)((function(t){return t.map((function(t){return new l(t)}))}))).subscribe((function(e){t.rows$.next(e)})))}},{key:"watchForBodyTpl",value:function(){var t=this;this.subs.add(Object(et.a)([this.store.fetched$,this.search.valueChanges.pipe(Object(st.a)("")),this.loadingErrors$,this.composedRows$]).pipe(Object(ot.a)(0),Object(ct.a)((function(e){var n=_slicedToArray(e,4),o=n[0],i=(n[1],n[2]),r=n[3];return i?t.errorBody:o&&!r.length?t.emptyBody:t.contentBody})),Object(at.a)()).subscribe((function(e){return t.contentTpl=e})))}},{key:"startDeleteProcess",value:function(t,e){var n,o=this;if(e){var i=this.selectionModel.value.reduce((function(t,e){return t[e]=!0,t}),{});delete i[t.data.id],n=this.rows$.getValue().filter((function(t){return i[t.data.id]})),t.deleteWith=n,n.forEach((function(t){return t.hidden=!0}))}t.cancelRemove$=new a.a,t.removing$.next("5"),this.rows$.next(_toConsumableArray(this.rows$.getValue()));var r=Object(nt.a)(1e3).pipe(Object(g.a)(t.cancelRemove$.pipe(Object(lt.a)((function(){t.removing$.next(""),t.deleteWith&&(t.deleteWith.forEach((function(t){return t.hidden=!1})),t.deleteWith=null),t.cancelRemove$=null})))),Object(lt.a)((function(e){t.removing$.next((+t.removing$.getValue()-1).toString())})),Object(bt.a)(5)).subscribe({next:function(e){4===e&&o.finishRemove(t,n)},complete:function(){return r.unsubscribe()},error:function(){return r.unsubscribe()}})}},{key:"finishRemove",value:function(t,e){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o,i,r,c=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return!t.destroy$.closed&&t.removing$.next(null),o=[],o=e?e.map((function(t){return t.data.id})).concat(t.data.id):[t.data.id],i=o.map((function(t){return c.store.entities[t]})).map((function(t){return t&&t.iin})),this.store.removeItems(o),r=o.reduce((function(t,e){return t[e]=!0,t}),{}),this.selectionModel.patchValue(this.selectionModel.value.filter((function(t){return!r[t]}))),[t].concat(_toConsumableArray(e||[])).forEach((function(t){return t.destroy()})),n.prev=7,n.next=10,this.employeeService.deleteEmployee(i);case 10:this.notifierService.notify("success",this.translateService.instant("DIRECTORY.EMPLOYEES."+(o.length>1?"EMPLOYEES_DELETED":"EMPLOYEE_DELETED"),{num:o.length})),n.next=16;break;case 13:n.prev=13,n.t0=n.catch(7),this.notifierService.notify("error",n.t0);case 16:case"end":return n.stop()}}),n,this,[[7,13]])})))}}]),t}()).\u0275fac=function(t){return new(t||Be)(k.Qb(ut.a),k.Qb(oe.b),k.Qb(E.q),k.Qb(pt.c),k.Qb(O.e))},Be.\u0275cmp=k.Kb({type:Be,selectors:[["app-directory-employees"]],viewQuery:function(t,e){var n;1&t&&(k.Xc(Oe,!0),k.Xc(we,!0),k.Xc(Ce,!0)),2&t&&(k.Dc(n=k.jc())&&(e.contentBody=n.first),k.Dc(n=k.jc())&&(e.emptyBody=n.first),k.Dc(n=k.jc())&&(e.errorBody=n.first))},decls:21,vars:9,consts:[[1,"list-page--content","list-page--content_counterparties",3,"jSelectionContainer","rows"],[1,"list-page--filter"],["clearable","true"],["jPrefix","","inlineSVG","./assets/icons/search.svg",1,"text-primary","d-block","mt-n1"],["type","text","jFormInput","","placeholder","\u041f\u043e\u0438\u0441\u043a","autocomplete","off",1,"form-control",3,"formControl"],["class","directory-employee--list j-table",4,"ngIf","ngIfElse"],["tableHead",""],["contentBody",""],["emptyBody",""],["errorBody",""],["jPortalledTpl","DIRECTORY_TITLE"],["loading",""],["loaderPart",""],[1,"directory-employee--list","j-table"],[4,"ngTemplateOutlet"],[1,"j-table--head"],[1,"j-table--row"],[1,"directory-employees-list--select","j-table--cell","j-table--cell_static"],[1,"custom-control","custom-checkbox"],["type","checkbox","id","checkboxAll","jSelectionRow","",1,"custom-control-input",3,"masterSelect"],["for","checkboxAll",1,"custom-control-label"],["translate","",1,"directory-employees-list--iin","j-table--cell","j-table--cell_static","p4"],["translate","",1,"directory-employees-list--name","j-table--cell","p4"],["translate","",1,"directory-employees-list--number","j-table--cell","j-table--cell_static","p4"],["translate","",1,"directory-employees-list--salary","j-table--cell","p4"],["translate","",1,"directory-employees-list--payment","j-table--cell","j-table--cell_static","p4"],[1,"directory-employees-list--tools","j-table--cell"],[1,"ml-auto"],["type","button","tooltipClass","tooltip-light","placement","top","class","btn btn-link btn-as-text btn-link-light-gray",3,"ngbTooltip","click",4,"ngIf"],["type","button","tooltipClass","tooltip-light","placement","top",1,"btn","btn-link","btn-as-text","btn-link-light-gray",3,"ngbTooltip","click"],[3,"inlineSVG"],[1,"j-table--body"],["ngFor","",3,"ngForOf","ngForTrackBy"],[3,"hidden","row","item","removing","edit","remove","cancelRemove"],[3,"label"],[1,"text-center","pt-5"],["translate","",1,"text-gray","text-gray"],["translate","","ng-disabled","store.fetching$ | async",1,"btn","btn-link","p-1",3,"click"],[1,"mt-n3","btn","btn-link","p-0",3,"click"],[1,"p-4"],[3,"theme"]],template:function(t,e){if(1&t&&(k.Wb(0,"div",0),k.nc(1,"async"),k.Wb(2,"div",1),k.Wb(3,"j-form-field",2),k.Rb(4,"span",3),k.Rb(5,"input",4),k.Vb(),k.Vb(),k.Qc(6,Ve,3,2,"div",5),k.nc(7,"async"),k.Qc(8,Pe,23,2,"ng-template",null,6,k.Rc),k.Qc(10,Ie,4,6,"ng-template",null,7,k.Rc),k.Vb(),k.Qc(12,De,1,1,"ng-template",null,8,k.Rc),k.Qc(14,$e,5,0,"ng-template",null,9,k.Rc),k.Qc(16,Me,3,3,"ng-template",10),k.Qc(17,Ge,3,2,"ng-template",null,11,k.Rc),k.Qc(19,Ne,3,6,"ng-template",null,12,k.Rc)),2&t){var n=k.Ec(18);k.tc("jSelectionContainer",e.selectionModel)("rows",k.oc(1,5,e.composedRows$)),k.Ab(5),k.tc("formControl",e.search),k.Ab(1),k.tc("ngIf",k.oc(7,7,e.store.fetched$))("ngIfElse",n)}},directives:[mt.a,A.a,M.a,w.a,V.a,s.c,s.t,s.i,C.u,ht,C.B,vt.a,O.a,E.E,C.t,Se,At.a,Tt.a],pipes:[C.b,O.d,Q.a,Vt.a],styles:[".directory-employee--list{min-height:200px;overflow:auto}.directory-employee--list .j-table--head{min-width:760px;position:-webkit-sticky;position:sticky;top:0}.directory-employee--list .j-table--body{min-width:760px}.directory-employee--list .directory-employees-list--select{position:-webkit-sticky;position:sticky;left:0;background:#fff}.directory-employee--list--select{flex-basis:50px;max-width:50px}.directory-employees-list--iin{flex-basis:120px}.directory-employees-list--name{flex-basis:140px;max-width:170px;flex-wrap:wrap}.directory-employees-list--number{flex-basis:100px}.directory-employees-list--salary{flex-basis:120px}.directory-employees-list--payment{flex-basis:80px;max-width:100px}.directory-employees-list--tools{flex-basis:64px;margin-left:auto;text-align:right;padding-top:18px;padding-bottom:18px;min-width:86px}.directory-employees-list--tools .btn+.btn{margin-left:1em}.directory-employees-list--removing{background-color:#f6f7f8}@media(min-width:960px){.directory-employee--list{overflow:initial;min-width:none}.directory-employee--list .j-table--head{min-width:none;position:static}.directory-employee--list .directory-employees-list--select{position:static;background:none}.directory-employee--list .j-table--body{min-width:none}}"],encapsulation:2}),Be),He=n("paXB"),Xe=n("7/bn"),Ke=n("oMXN"),qe=n("EiG8");function ze(t,e){1&t&&k.Sb(0)}var Je,Ze,tn,en,nn,on=((Je=function t(e,n){_classCallCheck(this,t),this.portal=n,this.template$=n.pipe(Object(rt.a)((function(t){return!t||e in t})),Object(ct.a)((function(t){return t&&t[e]})))}).\u0275fac=function(t){return new(t||Je)(k.fc("name"),k.Qb(ft))},Je.\u0275cmp=k.Kb({type:Je,selectors:[["j-portal-host"]],inputs:{context:"context"},decls:2,vars:4,consts:[[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(t,e){1&t&&(k.Qc(0,ze,1,0,"ng-container",0),k.nc(1,"async")),2&t&&k.tc("ngTemplateOutlet",k.oc(1,2,e.template$))("ngTemplateOutletContext",e.context)},directives:[C.B],pipes:[C.b],styles:[""]}),Je),rn=function(){return["counterparties"]},cn=function(){return["employees"]},an=["*"],ln=((Ze=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"ngOnInit",value:function(){}}]),t}()).\u0275fac=function(t){return new(t||Ze)},Ze.\u0275cmp=k.Kb({type:Ze,selectors:[["j-directory-tabs"]],ngContentSelectors:an,decls:8,vars:4,consts:[[1,"list-page--nav"],["jTour","DIRECTORY.NAV","jTourPosition","bottom"],[1,"page-tabs"],["routerLinkActive","active","translate","",3,"routerLink"]],template:function(t,e){1&t&&(k.sc(),k.Wb(0,"div",0),k.Wb(1,"nav",1),k.Wb(2,"div",2),k.Wb(3,"a",3),k.Sc(4,"DIRECTORY.COUNTERPARTIES.TITLE"),k.Vb(),k.Wb(5,"a",3),k.Sc(6,"DIRECTORY.EMPLOYEES.TITLE"),k.Vb(),k.Vb(),k.Vb(),k.rc(7),k.Vb()),2&t&&(k.Ab(3),k.tc("routerLink",k.xc(2,rn)),k.Ab(2),k.tc("routerLink",k.xc(3,cn)))},directives:[yt.a,i.f,i.e,O.a],styles:[""]}),Ze),sn=[{path:"",component:(tn=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"ngOnInit",value:function(){}}]),t}(),tn.\u0275fac=function(t){return new(t||tn)},tn.\u0275cmp=k.Kb({type:tn,selectors:[["j-directory"]],decls:17,vars:3,consts:[[1,"row"],[1,"col-lg-10","offset-lg-1","col-xl-8","offset-xl-2"],[1,"directory__title","header-title"],[1,"directory--actions","d-md-none"],["name","DIRECTORY_TITLE"],[1,"list-page"],[1,"directory--actions","d-none","d-md-block"]],template:function(t,e){1&t&&(k.Wb(0,"j-layout-home"),k.Wb(1,"j-aside"),k.Rb(2,"j-nav-main"),k.Vb(),k.Wb(3,"j-main"),k.Wb(4,"div",0),k.Wb(5,"div",1),k.Wb(6,"section"),k.Wb(7,"h2",2),k.Sc(8),k.nc(9,"translate"),k.Wb(10,"div",3),k.Rb(11,"j-portal-host",4),k.Vb(),k.Vb(),k.Wb(12,"div",5),k.Wb(13,"j-directory-tabs"),k.Wb(14,"div",6),k.Rb(15,"j-portal-host",4),k.Vb(),k.Vb(),k.Rb(16,"router-outlet"),k.Vb(),k.Vb(),k.Vb(),k.Vb(),k.Vb(),k.Vb()),2&t&&(k.Ab(8),k.Uc("",k.oc(9,1,"DIRECTORY.TITLE")," "))},directives:[He.a,Xe.a,Ke.a,qe.a,on,ln,i.h],pipes:[O.d],styles:[".directory__title{margin-top:40px;margin-bottom:40px}.list-page{background:#fff;box-shadow:0 4px 8px rgba(0,0,0,.04),0 0 2px rgba(0,0,0,.06),0 0 1px rgba(0,0,0,.04);border-radius:12px}.list-page--nav{padding:1rem 1.5rem 0;display:-webkit-box;display:flex;width:100%;-webkit-box-align:center;align-items:center}.list-page--filter{padding:1rem;background:#f6f7f8}.page-tabs{display:-webkit-box;display:flex;min-width:100%}.page-tabs>a{white-space:nowrap;background:none;display:block;padding:12px 0;color:#666c72;margin-right:2.5rem;font-size:1.125rem}.page-tabs>a.active{color:#1a1c1f;font-weight:500;border-bottom:2px solid #ef5630}.page-tabs>a[disabled]{cursor:not-allowed;opacity:.5}.j-table--row{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;width:100%;box-shadow:0 0 0 rgba(0,0,0,.04);-webkit-transition:box-shadow .3s ease-in-out;transition:box-shadow .3s ease-in-out;will-change:box-shadow}.j-table--row+.j-table--row{border-top:1px solid #eceef1}.j-table--head .j-table--row{border-bottom:1px solid #eceef1;-webkit-box-align:center;align-items:center}.j-table--body .j-table--row:not(.j-table--row_delete):hover{box-shadow:0 10px 20px rgba(0,0,0,.04),0 2px 6px rgba(0,0,0,.04),0 0 1px rgba(0,0,0,.04)}.j-table--cell{-webkit-box-flex:1;flex-grow:1;flex-shrink:1;flex-basis:auto;padding:20px 8px}.j-table--cell:first-child{padding-left:16px}.j-table--cell:last-child{padding-right:16px}.j-table--cell_static{-webkit-box-flex:0;flex-grow:0;flex-shrink:0}.header-title .directory--actions{margin-top:.2em;float:right;margin-left:15px}.directory--actions{margin-left:auto}"],encapsulation:2}),tn),data:{title:"DIRECTORY.TITLE"},children:[{path:"counterparties",component:Jt},{path:"employees",component:Ue},{path:"**",redirectTo:"counterparties"}]},{path:"**",redirectTo:""}],bn=((nn=function t(){_classCallCheck(this,t)}).\u0275mod=k.Ob({type:nn}),nn.\u0275inj=k.Nb({factory:function(t){return new(t||nn)},imports:[[i.g.forChild(sn)],i.g]}),nn),un=((en=function t(){_classCallCheck(this,t)}).\u0275mod=k.Ob({type:en}),en.\u0275inj=k.Nb({factory:function(t){return new(t||en)},imports:[[C.c]]}),en);n.d(e,"DirectoryModule",(function(){return dn}));var pn,dn=((pn=function t(){_classCallCheck(this,t)}).\u0275mod=k.Ob({type:pn}),pn.\u0275inj=k.Nb({factory:function(t){return new(t||pn)},providers:[d.FormBuilderTypeSafe],imports:[[C.c,o.a,bn,Tt.b,s.n,s.D,P.c.forChild(),un]]}),pn)}}]);